{% comment %}
Tech-Pack Step 3: Garment Specifications Section
{% endcomment %}

<link rel="stylesheet" href="{{ 'techpack-unified-styles.css' | asset_url }}?v={{ 'now' | date: '%s' }}">

<section id="techpack-step-3" class="techpack-step" data-step="3" style="display: none;">
  <div class="techpack-container">
    <div class="techpack-progress">
      <div class="techpack-progress__bar">
        <div class="techpack-progress__fill" style="width: 75%"></div>
      </div>
      <div class="techpack-progress__steps">
        <div class="techpack-progress__step techpack-progress__step--completed">
          <div class="techpack-progress__step-circle techpack-progress__step-circle--completed">‚úì</div>
          <div class="techpack-progress__step-label">Client Info</div>
        </div>
        <div class="techpack-progress__step techpack-progress__step--completed">
          <div class="techpack-progress__step-circle techpack-progress__step-circle--completed">‚úì</div>
          <div class="techpack-progress__step-label">File Upload</div>
        </div>
        <div class="techpack-progress__step techpack-progress__step--active">
          <div class="techpack-progress__step-circle techpack-progress__step-circle--active">3</div>
          <div class="techpack-progress__step-label">Garment Details</div>
        </div>
        <div class="techpack-progress__step">
          <div class="techpack-progress__step-circle">4</div>
          <div class="techpack-progress__step-label">Review</div>
        </div>
      </div>
    </div>

    <div class="techpack-content">
      <div class="techpack-header-with-help">
        <div class="techpack-header-content">
          <h2 class="techpack-title">Garment Specifications</h2>
          <p class="techpack-subtitle" id="step-3-subtitle">Define your garment details and quantity requirements</p>
        </div>
        <button type="button" class="techpack-help-btn" id="step-3-help-btn" aria-label="How does this step work?">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
            <circle cx="12" cy="17" r="1"/>
          </svg>
          <span>How does this work?</span>
        </button>
      </div>

      <div class="techpack-quantity-tracker">
        <div class="techpack-quantity-tracker__content">
          <span class="techpack-quantity-tracker__label">Total Quantity:</span>
          <span class="techpack-quantity-tracker__value" id="total-quantity">0</span>
          <span class="techpack-quantity-tracker__minimum">
            / <span id="min-text">75 minimum</span>
          </span>
        </div>
        <div class="techpack-quantity-tracker__bar">
          <div class="techpack-quantity-tracker__fill" id="quantity-progress" style="width: 0%"></div>
        </div>
      </div>

      <div class="techpack-garments" id="garments-container">
        <!-- Garments will be dynamically added here -->
      </div>

      <button type="button" class="techpack-btn techpack-btn--secondary techpack-btn--add-garment" id="add-garment">
        <svg class="techpack-btn__icon" width="16" height="16" viewBox="0 0 16 16">
          <path d="M8 2v12m-6-6h12" stroke="currentColor" stroke-width="2"/>
        </svg>
        Add Garment
      </button>

      <!-- Global Lab Dip Management Section -->
      <div class="techpack-global-lab-dips">
        <div class="techpack-section-header">
          <h3 class="techpack-section-title">Lab Dip Swatches</h3>
          <span class="techpack-section-badge">‚Ç¨25 each ¬∑ Optional</span>
        </div>
        <p class="techpack-section-description">Create color swatches that can be assigned to any garment or received as separate fabric samples for accuracy confirmation.</p>
        
        <!-- Compact Dual-Mode Input System -->
        <div class="techpack-lab-dip-input-system">
          <div class="techpack-input-mode-toggle">
            <button type="button" class="techpack-mode-btn techpack-mode-btn--active" data-mode="color-picker" id="color-picker-mode">
              <svg width="16" height="16" viewBox="0 0 16 16">
                <path d="M12.83 2.17a4 4 0 0 0-5.66 0L4.2 5.14a1 1 0 0 0-.29.71v4.29a1 1 0 0 0 1 1h4.29a1 1 0 0 0 .71-.29l2.97-2.97a4 4 0 0 0 0-5.66z"/>
                <path d="M8.5 12.5L15 6l-3-3-6.5 6.5"/>
              </svg>
              Color Picker
            </button>
            <button type="button" class="techpack-mode-btn" data-mode="manual-entry" id="manual-entry-mode">
              <svg width="16" height="16" viewBox="0 0 16 16">
                <path d="M1 4h14M1 8h14M1 12h8"/>
              </svg>
              Manual Code
            </button>
          </div>
          
          <!-- Color Picker Mode -->
          <div class="techpack-input-mode techpack-input-mode--active" id="color-picker-input">
            <div class="techpack-color-picker-group">
              <div class="techpack-color-preview-wrapper">
                <input type="color" id="lab-dip-color-picker" class="techpack-color-picker" value="#000000">
                <div class="techpack-color-preview" id="lab-dip-color-preview"></div>
              </div>
              <div class="techpack-color-info">
                <div class="techpack-color-code" id="suggested-pantone-code">Select a color</div>
                <div class="techpack-color-note">Closest Pantone TCX match</div>
              </div>
              <button type="button" id="add-lab-dip-color" class="techpack-btn techpack-btn--primary">
                <svg width="14" height="14" viewBox="0 0 16 16">
                  <path d="M8 2v12m-6-6h12" stroke="currentColor" stroke-width="2"/>
                </svg>
                Add
              </button>
            </div>
          </div>
          
          <!-- Manual Entry Mode -->
          <div class="techpack-input-mode" id="manual-entry-input">
            <div class="techpack-manual-entry-group">
              <input type="text" id="manual-pantone-code" class="techpack-form__input techpack-form__input--compact" placeholder="Enter Pantone code (e.g., 18-1664 TPX or 18-1664 TCX)">
              <button type="button" id="add-lab-dip-manual" class="techpack-btn techpack-btn--primary">
                <svg width="14" height="14" viewBox="0 0 16 16">
                  <path d="M8 2v12m-6-6h12" stroke="currentColor" stroke-width="2"/>
                </svg>
                Add
              </button>
            </div>
          </div>
        </div>
        
        <!-- Global Lab Dip List with Smart Categorization -->
        <div class="techpack-lab-dip-global-list" id="lab-dip-global-list">
          <!-- Assignment Summary Dashboard -->
          <div class="techpack-lab-dip-assignment-summary" id="assignment-summary" style="display: none;">
            <div class="techpack-assignment-summary__header">Assignment Overview</div>
            <div class="techpack-assignment-summary__stats">
              <div class="techpack-assignment-stat">
                <svg class="techpack-assignment-stat__icon" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M8 12l-4-4 4-4h4v8H8z"/>
                </svg>
                <div>
                  <div class="techpack-assignment-stat__text">Assigned to Garments</div>
                  <div class="techpack-assignment-stat__value" id="assigned-count">0</div>
                </div>
              </div>
              <div class="techpack-assignment-stat">
                <svg class="techpack-assignment-stat__icon" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M2 3a1 1 0 011-1h10a1 1 0 011 1v10a1 1 0 01-1 1H3a1 1 0 01-1-1V3z"/>
                </svg>
                <div>
                  <div class="techpack-assignment-stat__text">Fabric Swatches</div>
                  <div class="techpack-assignment-stat__value" id="fabric-swatch-count">0</div>
                </div>
              </div>
              <div class="techpack-assignment-stat">
                <svg class="techpack-assignment-stat__icon" viewBox="0 0 16 16" fill="currentColor">
                  <circle cx="8" cy="8" r="6"/>
                </svg>
                <div>
                  <div class="techpack-assignment-stat__text">Unassigned</div>
                  <div class="techpack-assignment-stat__value" id="unassigned-count">0</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Categorized Lab Dip Sections -->
          <div class="techpack-lab-dip-categories" id="lab-dip-categories">
            <!-- Assigned Lab Dips Section -->
            <div class="techpack-lab-dip-category" id="assigned-category" style="display: none;">
              <div class="techpack-category-header">
                <h4 class="techpack-category-title">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M8 12l-4-4 4-4h4v8H8z"/>
                  </svg>
                  Assigned to Garments
                </h4>
                <span class="techpack-category-count" id="assigned-category-count">0</span>
              </div>
              <div class="techpack-category-list" id="assigned-list"></div>
            </div>

            <!-- Fabric Swatches Only Section -->
            <div class="techpack-lab-dip-category" id="fabric-swatch-category" style="display: none;">
              <div class="techpack-category-header">
                <h4 class="techpack-category-title">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M2 3a1 1 0 011-1h10a1 1 0 011 1v10a1 1 0 01-1 1H3a1 1 0 01-1-1V3z"/>
                  </svg>
                  Fabric Swatches Only
                </h4>
                <span class="techpack-category-count" id="fabric-swatch-category-count">0</span>
              </div>
              <div class="techpack-category-list" id="fabric-swatch-list"></div>
            </div>

            <!-- Unassigned Lab Dips Section -->
            <div class="techpack-lab-dip-category" id="unassigned-category" style="display: none;">
              <div class="techpack-category-header">
                <h4 class="techpack-category-title">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <circle cx="8" cy="8" r="6"/>
                  </svg>
                  Unassigned Lab Dips
                </h4>
                <span class="techpack-category-count" id="unassigned-category-count">0</span>
              </div>
              <div class="techpack-category-list" id="unassigned-list"></div>
            </div>
          </div>

          <!-- Empty State -->
          <div class="techpack-lab-dip-empty" id="lab-dip-empty">
            <div class="techpack-empty-state">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="3"/>
                <path d="M12 1v6m0 6v6"/>
              </svg>
              <span>No lab dips added yet</span>
            </div>
          </div>
        </div>
      </div>

      <div class="techpack-form__actions">
        <button type="button" class="techpack-btn techpack-btn--ghost" id="step-3-prev">
          <svg class="techpack-btn__icon techpack-btn__icon--left" width="16" height="16" viewBox="0 0 16 16">
            <path d="M10 4L6 8l4 4" stroke="currentColor" stroke-width="2" fill="none"/>
          </svg>
          Previous
        </button>
        <button type="button" class="techpack-btn techpack-btn--primary" id="step-3-next" disabled>
          Next Step
          <svg class="techpack-btn__icon" width="16" height="16" viewBox="0 0 16 16">
            <path d="M6 12l4-4-4-4" stroke="currentColor" stroke-width="2" fill="none"/>
          </svg>
        </button>
      </div>
    </div>
  </div>
</section>

<!-- Garment Template -->
<template id="garment-template">
  <div class="techpack-garment" data-garment-id="">
    <div class="techpack-garment__header">
      <h3 class="techpack-garment__title">Garment <span class="techpack-garment__number"></span></h3>
      <button type="button" class="techpack-garment__remove" aria-label="Remove garment">
        <svg width="16" height="16" viewBox="0 0 16 16">
          <path d="M12 4L4 12m0-8l8 8" stroke="currentColor" stroke-width="2"/>
        </svg>
      </button>
    </div>

    <div class="techpack-garment__content">
      <div class="techpack-form__row">
        <div class="techpack-form__group techpack-form__group--required">
          <label class="techpack-form__label">Garment Type</label>
          <select class="techpack-form__select" name="garmentType" required>
            <option value="">Select garment type...</option>
            <option value="Zip-Up Hoodie">Zip-Up Hoodie</option>
            <option value="Hoodie">Hoodie</option>
            <option value="T-Shirt">T-Shirt</option>
            <option value="Sweatshirt">Sweatshirt</option>
            <option value="Sweatpants">Sweatpants</option>
            <option value="Shorts">Shorts</option>
            <option value="Long Sleeve T-Shirt">Long Sleeve T-Shirt</option>
            <option value="Shirt">Shirt</option>
            <option value="Polo Shirt">Polo Shirt</option>
            <option value="Tank Top">Tank Top</option>
            <option value="Hat/Cap">Hat/Cap</option>
            <option value="Beanie">Beanie</option>
            <option value="Other">Other (Specify in Notes)</option>
          </select>
          <div class="techpack-form__error" role="alert"></div>
        </div>

        <div class="techpack-form__group techpack-form__group--required">
          <label class="techpack-form__label">Fabric Type</label>
          <select class="techpack-form__select" name="fabricType" required>
            <option value="" selected>Select fabric type...</option>
            <!-- Fabric options will be populated dynamically based on garment type -->
          </select>
          <div class="techpack-form__error" role="alert"></div>
        </div>
      </div>

      <div class="techpack-form__group techpack-form__group--required">
        <label class="techpack-form__label">Printing Methods (Select at least one) *</label>
        <div class="techpack-form__checkboxes techpack-form__checkboxes--compact">
          <label class="techpack-form__checkbox">
            <input type="checkbox" name="printingMethods[]" value="None">
            <span class="techpack-form__checkbox-mark"></span>
            None
          </label>
          <label class="techpack-form__checkbox">
            <input type="checkbox" name="printingMethods[]" value="Embroidery">
            <span class="techpack-form__checkbox-mark"></span>
            Embroidery
          </label>
          <label class="techpack-form__checkbox">
            <input type="checkbox" name="printingMethods[]" value="Screen Print">
            <span class="techpack-form__checkbox-mark"></span>
            Screen Print
          </label>
          <label class="techpack-form__checkbox">
            <input type="checkbox" name="printingMethods[]" value="Digital Print">
            <span class="techpack-form__checkbox-mark"></span>
            Digital Print
          </label>
          <label class="techpack-form__checkbox">
            <input type="checkbox" name="printingMethods[]" value="Other">
            <span class="techpack-form__checkbox-mark"></span>
            Other
          </label>
        </div>
        <div class="techpack-form__error" role="alert"></div>
      </div>

      <!-- Sample Options for this Garment (shown only for sample requests) -->
      <div class="techpack-garment-samples" data-sample-request-only="true" style="display: none;">
        <!-- Section A: Choose Your Sample Type -->
        <div class="techpack-sample-type-selection">
          <h4 class="techpack-section-title">Choose Your Sample Type</h4>
          
          <!-- A1: Stock Fabric Color -->
          <div class="techpack-sample-card" data-sample-type="stock">
            <div class="techpack-sample-card-header">
              <input type="radio" name="garment-sample-type" value="stock" id="sample-stock" class="techpack-sample-radio">
              <label for="sample-stock" class="techpack-sample-card-label">
                <h5 class="techpack-sample-card-title">Garment in Stock Fabric Color (Fastest)</h5>
                <div class="techpack-sample-meta">~1‚Äì2 weeks ¬∑ ‚Ç¨35</div>
                <p class="techpack-sample-description">Validate fit, sizing, stitching using in-stock colors. You'll receive the stock color garment plus separate lab dip swatches for any colors added below.</p>
                <div class="techpack-sample-subtitle" id="stock-subtitle">Choose from available stock colors for faster turnaround.</div>
              </label>
            </div>
            
            <!-- Stock color options (shown when selected) -->
            <div class="techpack-sample-options" style="display: none;">
              <div class="techpack-fabric-colors">
                <label class="techpack-fabric-color-option">
                  <input type="radio" name="stock-fabric-color" value="black" id="stock-black">
                  <span class="techpack-radio-mark"></span>
                  Black (in-stock)
                </label>
                
                <label class="techpack-fabric-color-option">
                  <input type="radio" name="stock-fabric-color" value="off-white" id="stock-off-white">
                  <span class="techpack-radio-mark"></span>
                  Off-White / Natural (in-stock)
                </label>
                
                <label class="techpack-fabric-color-option">
                  <input type="radio" name="stock-fabric-color" value="random" id="stock-random">
                  <span class="techpack-radio-mark"></span>
                  Random Stock Color (we choose)
                </label>
              </div>
              <div class="techpack-sample-note">
                <svg width="16" height="16" viewBox="0 0 16 16">
                  <circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="1.5" fill="none"/>
                  <path d="M8 5v3" stroke="currentColor" stroke-width="1.5"/>
                  <circle cx="8" cy="11" r="1" fill="currentColor"/>
                </svg>
                Best for speed. You can add Lab Dips in Section B at any time.
              </div>
            </div>
          </div>
          
          <!-- A2: Custom Color -->
          <div class="techpack-sample-card" data-sample-type="custom">
            <div class="techpack-sample-card-header">
              <input type="radio" name="garment-sample-type" value="custom" id="sample-custom" class="techpack-sample-radio">
              <label for="sample-custom" class="techpack-sample-card-label">
                <h5 class="techpack-sample-card-title">Garment in Your Custom Color (Dyed to Pantone)</h5>
                <div class="techpack-sample-meta">~3 weeks ¬∑ ‚Ç¨65</div>
                <p class="techpack-sample-description">Your garment dyed to your exact Pantone color. You'll receive the custom-dyed garment plus separate lab dip swatches for all colors added below.</p>
                <div class="techpack-sample-subtitle">Requires a Lab Dip (add in Section B below).</div>
              </label>
            </div>
            
            <!-- Custom color options (shown when selected) -->
            <div class="techpack-sample-options" style="display: none;">
              <div class="techpack-form__group">
                <label class="techpack-form__label">Assign Colors for <span class="garment-name-placeholder">this garment</span> <span class="techpack-form__required">*</span></label>
                
                <!-- Color Assignment Guidance Card -->
                <div class="techpack-color-assignment-guidance">
                  <div class="techpack-guidance-header">
                    <svg class="techpack-guidance-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                    </svg>
                    <span class="techpack-guidance-title">Use Global Color Assignment</span>
                  </div>
                  
                  <!-- Assignment Status Display -->
                  <div class="techpack-assignment-status" data-garment-assignment-status="">
                    <div class="techpack-status-unassigned">
                      <svg class="techpack-status-icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="1.5" fill="none"/>
                        <path d="M8 12l-4-4h8l-4 4z"/>
                      </svg>
                      <span class="techpack-status-text">No colors assigned yet</span>
                    </div>
                    
                    <div class="techpack-status-assigned" style="display: none;">
                      <svg class="techpack-status-icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                        <path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"/>
                      </svg>
                      <span class="techpack-status-text">
                        <span class="techpack-assigned-count">0</span> colors assigned
                      </span>
                      <div class="techpack-assigned-colors" data-assigned-colors-list></div>
                    </div>
                  </div>
                  
                  <!-- Guidance Text -->
                  <div class="techpack-guidance-content">
                    <p class="techpack-guidance-text">
                      Create and assign colors using the <strong>Lab Dip Swatches</strong> section below. 
                      You can assign multiple colors to create different variants of this garment.
                    </p>
                  </div>
                  
                  <!-- Action Button -->
                  <button type="button" class="techpack-guidance-action" data-scroll-to-lab-dips>
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                      <path d="M8 1a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L7.5 13.293V1.5A.5.5 0 0 1 8 1z"/>
                    </svg>
                    Go to Color Assignment
                  </button>
                </div>
                
                <div class="techpack-form__error" role="alert"></div>
              </div>
              
              <div class="techpack-sample-warning" id="lab-dip-warning">
                <svg width="16" height="16" viewBox="0 0 16 16">
                  <path d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" fill="currentColor"/>
                </svg>
                Requires a Lab Dip. Add one in Section B, then select it here.
              </div>
            </div>
          </div>
        </div>


        <!-- Section C: Techpack Info Check -->
        <div class="techpack-info-check">
          <h4 class="techpack-section-title">Garment Info Provided in Techpack</h4>
          <div class="techpack-checkboxes">
            <label class="techpack-checkbox-option">
              <input type="checkbox" name="colorway-in-techpack">
              <span class="techpack-checkbox-mark"></span>
              Colorway is already included in the techpack
            </label>
            
            <label class="techpack-checkbox-option">
              <input type="checkbox" name="sizing-in-techpack">
              <span class="techpack-checkbox-mark"></span>
              Sizing/custom measurements are defined in the techpack
            </label>
            
            <label class="techpack-checkbox-option">
              <input type="checkbox" name="need-sizing-help">
              <span class="techpack-checkbox-mark"></span>
              I need help with sizing or fit adjustments
            </label>
          </div>
        </div>

      </div>

      <div class="techpack-colorways">
        <div class="techpack-colorways__header">
          <h4 class="techpack-colorways__title">Colorways</h4>
          <button type="button" class="techpack-btn techpack-btn--small techpack-btn--secondary add-colorway">
            <svg class="techpack-btn__icon" width="14" height="14" viewBox="0 0 16 16">
              <path d="M8 2v12m-6-6h12" stroke="currentColor" stroke-width="2"/>
            </svg>
            Add Colorway
          </button>
        </div>
        <div class="techpack-colorways__list">
          <!-- Colorways will be added here -->
        </div>
      </div>


      <div class="techpack-garment__total" data-bulk-request-only="true" style="display: none;">
        <span class="techpack-garment__total-label">Garment Total:</span>
        <span class="techpack-garment__total-value">0</span>
      </div>
    </div>
  </div>
</template>

<!-- Colorway Template -->
<template id="colorway-template">
  <div class="techpack-colorway" data-colorway-id="">
    <!-- Perfect Single Line Layout: Color ‚Üí Sample ‚Üí Pantone ‚Üí X -->
    <div class="techpack-colorway__header-line">
      <!-- Column 1: Color Picker -->
      <div class="techpack-colorway__color">
        <label class="techpack-form__label">Color</label>
        <input type="color" class="techpack-color-picker__input" value="#000000" data-color-picker>
      </div>
      
      <!-- Column 3: Pantone Options (Takes remaining space) -->
      <div class="techpack-colorway__pantone">
        <label class="techpack-form__label">
          PANTONE Options <span class="techpack-form__required">*</span>
        </label>
        <div class="techpack-pantone-buttons" style="display: none;">
          <div class="techpack-pantone-grid">
            <button type="button" class="techpack-btn techpack-btn--pantone-compact" data-pantone-index="0" data-pantone-code="" data-pantone-hex="" style="--pantone-hex: #000000;">
              <div class="techpack-pantone-circle" style="background-color: var(--pantone-hex)"></div>
              <span class="techpack-pantone-text">Select color</span>
              <div class="techpack-pantone-radio"></div>
            </button>
            <button type="button" class="techpack-btn techpack-btn--pantone-compact" data-pantone-index="1" data-pantone-code="" data-pantone-hex="" style="--pantone-hex: #000000;">
              <div class="techpack-pantone-circle" style="background-color: var(--pantone-hex)"></div>
              <span class="techpack-pantone-text">Select color</span>
              <div class="techpack-pantone-radio"></div>
            </button>
          </div>
        </div>
        <div class="techpack-pantone-validation-message" style="display: none;"></div>
      </div>
      
      <!-- Column 4: Remove Button (Original position) -->
      <button type="button" class="techpack-colorway__remove" aria-label="Remove colorway">
        <svg width="16" height="16" viewBox="0 0 16 16">
          <path d="M12 4L4 12m0-8l8 8" stroke="currentColor" stroke-width="2"/>
        </svg>
      </button>
    </div>

    <div class="techpack-size-grid" style="display: none;" data-requires-pantone="true">
      <div class="techpack-size-grid__header">
        <div class="techpack-size-grid__label">Size</div>
        <div class="techpack-size-grid__label">XXS</div>
        <div class="techpack-size-grid__label">XS</div>
        <div class="techpack-size-grid__label">S</div>
        <div class="techpack-size-grid__label">M</div>
        <div class="techpack-size-grid__label">L</div>
        <div class="techpack-size-grid__label">XL</div>
        <div class="techpack-size-grid__label">XXL</div>
      </div>
      <div class="techpack-size-grid__row">
        <div class="techpack-size-grid__label">Qty</div>
        <input type="number" class="techpack-size-grid__input" name="qty-xxs" min="0" value="0" data-size="xxs">
        <input type="number" class="techpack-size-grid__input" name="qty-xs" min="0" value="0" data-size="xs">
        <input type="number" class="techpack-size-grid__input" name="qty-s" min="0" value="0" data-size="s">
        <input type="number" class="techpack-size-grid__input" name="qty-m" min="0" value="0" data-size="m">
        <input type="number" class="techpack-size-grid__input" name="qty-l" min="0" value="0" data-size="l">
        <input type="number" class="techpack-size-grid__input" name="qty-xl" min="0" value="0" data-size="xl">
        <input type="number" class="techpack-size-grid__input" name="qty-xxl" min="0" value="0" data-size="xxl">
      </div>
    </div>

    <div class="techpack-colorway__total">
      <span class="techpack-colorway__total-label">Colorway Total:</span>
      <span class="techpack-colorway__total-value">0</span>
    </div>
  </div>
</template>

<!-- Lab Dip Template -->
<template id="lab-dip-template">
  <div class="techpack-lab-dip-item" data-lab-dip-id="">
    <div class="techpack-lab-dip-item__visual">
      <div class="techpack-lab-dip-item__color-circle" style="display: none;"></div>
      <div class="techpack-lab-dip-item__badge" data-source="manual">TPX</div>
    </div>
    <div class="techpack-lab-dip-item__info">
      <div class="techpack-lab-dip-item__code">Loading...</div>
      <div class="techpack-lab-dip-item__source">Manual entry</div>
    </div>
    <div class="techpack-lab-dip-item__actions">
      <button type="button" class="techpack-lab-dip-item__remove" aria-label="Remove lab dip" title="Remove">
        <svg width="14" height="14" viewBox="0 0 16 16">
          <path d="M12 4L4 12M4 4l8 8" stroke="currentColor" stroke-width="1.5"/>
        </svg>
      </button>
    </div>
  </div>
</template>

<!-- Lab Dip Selection Card Template (for custom color selection) -->
<template id="lab-dip-selection-card-template">
  <div class="techpack-lab-dip-selection-card" data-lab-dip-id="">
    <div class="techpack-lab-dip-selection-card__content">
      <div class="techpack-lab-dip-selection-card__color">
        <div class="techpack-lab-dip-selection-card__color-circle" style="background-color: #000000;"></div>
      </div>
      <div class="techpack-lab-dip-selection-card__info">
        <div class="techpack-lab-dip-selection-card__pantone">PANTONE Loading...</div>
        <div class="techpack-lab-dip-selection-card__status">
          <span class="status-text">Select for <span class="garment-name-placeholder">garment</span></span>
        </div>
      </div>
      <div class="techpack-lab-dip-selection-card__action">
        <button type="button" class="techpack-lab-dip-selection-card__select-btn" data-lab-dip-select>
          <div class="techpack-lab-dip-selection-card__radio">
            <div class="techpack-lab-dip-selection-card__radio-inner"></div>
          </div>
          <span class="sr-only">Select this lab dip</span>
        </button>
      </div>
    </div>
    <div class="techpack-lab-dip-selection-card__selected-indicator">
      <svg width="20" height="20" viewBox="0 0 20 20">
        <circle cx="10" cy="10" r="8" fill="#22c55e"/>
        <path d="M7 10l2 2 4-4" stroke="white" stroke-width="2" fill="none"/>
      </svg>
    </div>
  </div>
</template>

{% schema %}
{
  "name": "Tech-Pack Step 3",
  "settings": [
    {
      "type": "header",
      "content": "Garment Specifications Step"
    },
    {
      "type": "text",
      "id": "step_title",
      "label": "Step Title",
      "default": "Garment Specifications"
    },
    {
      "type": "text",
      "id": "step_subtitle",
      "label": "Step Subtitle",
      "default": "Define your garment details and quantity requirements"
    },
    {
      "type": "number",
      "id": "minimum_quantity",
      "label": "Minimum Total Quantity",
      "default": 75
    }
  ],
  "presets": [
    {
      "name": "Tech-Pack Step 3"
    }
  ]
}
{% endschema %}

<!-- Step 3 Help Modal -->
<div class="techpack-modal techpack-modal--help" id="step-3-help-modal" style="display: none;">
  <div class="techpack-modal__backdrop"></div>
  <div class="techpack-modal__content techpack-modal__content--help">
    <div class="techpack-modal__header">
      <h3 class="techpack-modal__title">How Step 3 Works</h3>
      <button type="button" class="techpack-modal__close" id="close-help-modal">
        <svg width="20" height="20" viewBox="0 0 20 20">
          <path d="M15 5L5 15m0-10l10 10" stroke="currentColor" stroke-width="2"/>
        </svg>
      </button>
    </div>
    
    <div class="techpack-modal__body">
      <div class="techpack-help-content">
        <div class="techpack-help-section">
          <h4 class="techpack-help-section-title">üìã What This Step Does</h4>
          <p>Step 3 configures your garment specifications and determines what you'll receive based on your submission type.</p>
        </div>

        <div class="techpack-help-section">
          <h4 class="techpack-help-section-title">üéØ Sample Requests</h4>
          <p><strong>Purpose:</strong> Get physical samples to validate fit, quality, and color before bulk production.</p>
          <div class="techpack-help-options">
            <div class="techpack-help-option">
              <strong>Stock Color Sample (‚Ç¨35 ¬∑ 1-2 weeks)</strong>
              <ul>
                <li>‚úÖ Best for: Quick fit and construction validation</li>
                <li>üì¶ You receive: Stock color garment + Any lab dip swatches added</li>
                <li>‚ö° Fastest option for testing garment construction</li>
              </ul>
            </div>
            <div class="techpack-help-option">
              <strong>Custom Color Sample (‚Ç¨65 ¬∑ 3 weeks)</strong>
              <ul>
                <li>‚úÖ Best for: Final color approval and fit validation</li>
                <li>üì¶ You receive: Custom-dyed garment + All lab dip swatches</li>
                <li>üé® Perfect for confirming exact Pantone color on final garment</li>
              </ul>
            </div>
          </div>
        </div>

        <div class="techpack-help-section">
          <h4 class="techpack-help-section-title">üè≠ Bulk Order Requests</h4>
          <p><strong>Purpose:</strong> Ready for full production with specific quantities and colorways.</p>
          <ul>
            <li>üî¢ Define exact quantities per size (minimum requirements apply)</li>
            <li>üé® Specify colorways with Pantone color matching</li>
            <li>üìè Set size grading and distribution</li>
            <li>üöö Direct delivery to your location</li>
          </ul>
        </div>

        <div class="techpack-help-section">
          <h4 class="techpack-help-section-title">üé® Lab Dip System</h4>
          <p><strong>What are Lab Dips?</strong> Small fabric swatches dyed to your exact Pantone colors (‚Ç¨25 each).</p>
          <div class="techpack-help-highlight">
            <strong>Important:</strong> You receive lab dip swatches for <em>all</em> colors you add, regardless of sample type.
          </div>
          <ul>
            <li>üéØ Confirm color accuracy before production</li>
            <li>üì¶ Always delivered as separate swatches</li>
            <li>‚è±Ô∏è Made in parallel with your samples</li>
            <li>‚úÖ Can be added to any sample type</li>
          </ul>
        </div>

        <div class="techpack-help-section">
          <h4 class="techpack-help-section-title">üõ§Ô∏è Recommended Workflow</h4>
          <div class="techpack-help-workflow">
            <div class="techpack-workflow-step">
              <span class="techpack-workflow-number">1</span>
              <div class="techpack-workflow-content">
                <strong>Start with Stock Color Sample</strong>
                <p>Validate fit, sizing, and construction quickly</p>
              </div>
            </div>
            <div class="techpack-workflow-arrow">‚Üí</div>
            <div class="techpack-workflow-step">
              <span class="techpack-workflow-number">2</span>
              <div class="techpack-workflow-content">
                <strong>Add Lab Dips</strong>
                <p>Confirm your Pantone colors separately</p>
              </div>
            </div>
            <div class="techpack-workflow-arrow">‚Üí</div>
            <div class="techpack-workflow-step">
              <span class="techpack-workflow-number">3</span>
              <div class="techpack-workflow-content">
                <strong>Custom Color Sample</strong>
                <p>Final approval with exact color + fit</p>
              </div>
            </div>
            <div class="techpack-workflow-arrow">‚Üí</div>
            <div class="techpack-workflow-step">
              <span class="techpack-workflow-number">4</span>
              <div class="techpack-workflow-content">
                <strong>Bulk Production</strong>
                <p>Full quantities with confidence</p>
              </div>
            </div>
          </div>
        </div>

        <div class="techpack-help-section">
          <h4 class="techpack-help-section-title">üí° Pro Tips</h4>
          <ul>
            <li><strong>New Product:</strong> Start with stock color sample to validate fit quickly</li>
            <li><strong>Color-Critical:</strong> Always add lab dips before requesting custom color samples</li>
            <li><strong>Existing Product:</strong> Can go directly to custom color sample if fit is confirmed</li>
            <li><strong>Budget-Conscious:</strong> Stock color samples provide maximum validation for minimum cost</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Educational Tooltip for Per-Garment Samples -->
<div class="techpack-tooltips">
  <div class="techpack-tooltip" id="tooltip-garment-samples" style="display: none;">
    <div class="techpack-tooltip__content">
      <h5 class="techpack-tooltip__title">Per-Garment Sample Options</h5>
      <p>For sample requests, you can choose different sample types for each garment:</p>
      <ul>
        <li><strong>Black/Raw Sample:</strong> Quick fit and construction validation using stock fabric</li>
        <li><strong>Lab Dip:</strong> Color swatch to confirm Pantone accuracy before production</li>
        <li><strong>Custom Color Sample:</strong> Full garment in your exact color (requires lab dip first)</li>
      </ul>
      <div class="techpack-tooltip__highlight">
        <strong>üí° Pro tip:</strong> Mix and match options - get a black sample for quick fit validation while waiting for your custom color sample!
      </div>
    </div>
  </div>
</div>