{% comment %}
  TechPack V11 - Quotation Step 2: File Upload
  Purpose: Upload design files and measurement files
  For: Both new and registered clients
{% endcomment %}

{{ 'techpack-v11-base.css' | asset_url | stylesheet_tag }}
{{ 'techpack-v11-flow.css' | asset_url | stylesheet_tag }}
{{ 'techpack-v11-forms.css' | asset_url | stylesheet_tag }}
{{ 'techpack-v11-files.css' | asset_url | stylesheet_tag }}
{{ 'techpack-v11-progress.css' | asset_url | stylesheet_tag }}

<div class="techpack-v11 techpack-flow" data-section-id="{{ section.id }}" data-flow-type="quotation" data-current-step="2">

  {%- comment -%} TEST MODE BANNER {%- endcomment -%}
  <div class="test-mode-banner" id="testModeBanner" style="display: none;">
    <div class="test-mode-banner__content">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <div>
        <strong>TEST MODE ACTIVE</strong>
        <p>Simulated file uploads. No actual files needed.</p>
      </div>
    </div>
  </div>

  {%- comment -%} Progress Bar Header {%- endcomment -%}
  <div class="techpack-progress-bar">
    <div class="techpack-progress-bar__container">
      <div class="techpack-progress-bar__wrapper">
        <div class="progress-bar__labels">
          <div class="progress-bar__label progress-bar__label--complete">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M11.667 3.5L5.25 9.917L2.333 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Client Info</span>
          </div>
          <div class="progress-bar__label progress-bar__label--active">
            <div class="progress-bar__marker"></div>
            <span>Files</span>
          </div>
          <div class="progress-bar__label">
            <span>Garments</span>
          </div>
          <div class="progress-bar__label">
            <span>Review</span>
          </div>
        </div>
        <div class="progress-bar__track">
          <div class="progress-bar__fill" style="width: 33%;"></div>
        </div>
        <div class="progress-bar__percentage">Step 2 of 4 • 33% Complete</div>
      </div>
    </div>
  </div>

  {%- comment -%} Main Content {%- endcomment -%}
  <div class="techpack-content">
    <div class="techpack-content__container">

      {%- comment -%} Premium Header {%- endcomment -%}
      <header class="premium-header">
        <div class="premium-header__card">
          <div class="premium-header__icon">
            <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M26 26V6a2 2 0 00-2-2H8a2 2 0 00-2 2v20l10-6 10 6z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M12 12h8M12 16h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </div>
          <div class="premium-header__content">
            <h1 class="premium-header__title">Upload Files</h1>
            <p class="premium-header__description">
              Share your design files and measurements so we can provide accurate pricing
            </p>
          </div>
        </div>
      </header>

      {%- comment -%} Form Content {%- endcomment -%}
      <form class="step-form" id="quotationStep2Form" data-step="2" data-flow="quotation">

        {%- comment -%} Design Files Section {%- endcomment -%}
        <div class="form-section">
          <div class="section-header">
            <h3 class="section-header__title">Design Files</h3>
            <p class="section-header__description">
              Upload your garment designs, tech packs, or reference images
            </p>
          </div>

          <div class="file-upload-zone" id="designFilesZone" data-upload-type="design">
            <input
              type="file"
              id="designFiles"
              name="design_files[]"
              multiple
              accept=".jpg,.jpeg,.png,.pdf,.ai,.eps,.psd"
              data-test-files="2"
            >

            <div class="file-upload-zone__icon">
              <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M8 32v8a4 4 0 004 4h24a4 4 0 004-4v-8M32 16l-8-8-8 8M24 8v24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>

            <h4 class="file-upload-zone__title">Drop files here or click to upload</h4>
            <p class="file-upload-zone__description">
              Upload design files, sketches, or reference images
            </p>

            <button type="button" class="file-upload-zone__button" data-action="trigger-file-input" data-target="designFiles">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M10 4v12M4 10h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
              Choose Files
            </button>

            <p class="file-upload-zone__formats">
              Supported: JPG, PNG, PDF, AI, EPS, PSD • Max 10MB per file
            </p>
          </div>

          {%- comment -%} Uploaded Files List {%- endcomment -%}
          <div class="uploaded-files-list" id="designFilesList" style="display: none;">
            {%- comment -%} Dynamically populated {%- endcomment -%}
          </div>
        </div>

        {%- comment -%} Measurement Files Section {%- endcomment -%}
        <div class="form-section">
          <div class="section-header">
            <h3 class="section-header__title">Measurement Files</h3>
            <p class="section-header__description">
              Upload measurement specs, size charts, or grading details
            </p>
          </div>

          <div class="file-upload-zone" id="measurementFilesZone" data-upload-type="measurement">
            <input
              type="file"
              id="measurementFiles"
              name="measurement_files[]"
              multiple
              accept=".jpg,.jpeg,.png,.pdf,.xlsx,.xls,.csv"
              data-test-files="1"
            >

            <div class="file-upload-zone__icon">
              <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="8" y="8" width="32" height="32" rx="2" stroke="currentColor" stroke-width="2"/>
                <path d="M16 8v8M32 8v8M8 20h32M16 28h8M16 36h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </div>

            <h4 class="file-upload-zone__title">Drop measurement files here</h4>
            <p class="file-upload-zone__description">
              Upload size charts, measurement sheets, or grading specs
            </p>

            <button type="button" class="file-upload-zone__button" data-action="trigger-file-input" data-target="measurementFiles">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M10 4v12M4 10h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
              Choose Files
            </button>

            <p class="file-upload-zone__formats">
              Supported: JPG, PNG, PDF, Excel, CSV • Max 10MB per file
            </p>
          </div>

          <div class="uploaded-files-list" id="measurementFilesList" style="display: none;">
            {%- comment -%} Dynamically populated {%- endcomment -%}
          </div>
        </div>

        {%- comment -%} Measurement Validation Alert {%- endcomment -%}
        <div class="alert alert--warning" id="measurementAlert">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M10 6v4m0 4h.01M18 10a8 8 0 11-16 0 8 8 0 0116 0z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <div>
            <strong>Measurement files help us quote accurately</strong>
            <p>While optional, providing measurements helps us give you precise pricing. Without them, we'll use standard sizing and may need to follow up.</p>
          </div>
        </div>

        {%- comment -%} Info Card {%- endcomment -%}
        <div class="info-card info-card--primary">
          <div class="info-card__icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div class="info-card__content">
            <h4 class="info-card__title">Your files are secure</h4>
            <p class="info-card__text">
              All uploads are encrypted and stored securely. We only use your designs for quotation purposes and will never share them with third parties.
            </p>
          </div>
        </div>

        {%- comment -%} Form Navigation {%- endcomment -%}
        <div class="form-navigation">
          <button
            type="button"
            class="button-secondary"
            data-action="previous-step"
          >
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12.5 15L7.5 10L12.5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Back to Client Info
          </button>

          <button
            type="submit"
            class="button-primary"
            data-action="next-step"
          >
            Continue to Garments
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M7.5 15L12.5 10L7.5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>

      </form>

    </div>
  </div>

</div>

<script>
  window.TECHPACK_V11_CUSTOMER = {
    isLoggedIn: {{ customer | json }} !== null
  };
</script>

{% render 'techpack-v11-theme-switcher' %}

<script src="{{ 'techpack-v11-core.js' | asset_url }}" defer></script>
<script src="{{ 'techpack-v11-actions.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "TP V11 Quote Step 2",
  "class": "section-techpack-v11-step",
  "settings": [
    {
      "type": "range",
      "id": "max_file_size",
      "label": "Max File Size",
      "min": 5,
      "max": 50,
      "step": 5,
      "default": 10,
      "unit": "MB"
    },
    {
      "type": "range",
      "id": "max_files_per_type",
      "label": "Max Files Per Type",
      "min": 5,
      "max": 20,
      "step": 1,
      "default": 10
    }
  ],
  "presets": [
    {
      "name": "TechPack V11 - Quotation Step 2"
    }
  ]
}
{% endschema %}
