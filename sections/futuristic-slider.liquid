{{ 'portfolio-showcase.css' | asset_url | stylesheet_tag }}

<div class="portfolio-showcase" data-section-id="{{ section.id }}">
  <div class="page-width">
    
    {% comment %} Section Header {% endcomment %}
    {% if section.settings.heading != blank or section.settings.subheading != blank %}
      <div class="portfolio-showcase__header">
        {% if section.settings.heading != blank %}
          <h2 class="portfolio-showcase__title h1">{{ section.settings.heading }}</h2>
        {% endif %}
        {% if section.settings.subheading != blank %}
          <div class="portfolio-showcase__subtitle">{{ section.settings.subheading }}</div>
        {% endif %}
      </div>
    {% endif %}

    {% if section.blocks.size > 0 %}
      <div class="portfolio-showcase__wrapper">
        
        {% comment %} Main Gallery Display {% endcomment %}
        <div class="portfolio-showcase__gallery">
          <div class="portfolio-showcase__main-container">
            <div class="swiper portfolio-showcase__main-swiper">
              <div class="swiper-wrapper">
                {% for block in section.blocks %}
                  {% if block.settings.image_1 != blank %}
                    <div class="swiper-slide portfolio-showcase__slide">
                      {{ block.settings.image_1 | image_url: width: 1200 | image_tag: 
                        class: 'portfolio-showcase__image', 
                        loading: 'lazy',
                        alt: block.settings.product_name | escape
                      }}
                    </div>
                  {% endif %}
                  {% if block.settings.image_2 != blank %}
                    <div class="swiper-slide portfolio-showcase__slide">
                      {{ block.settings.image_2 | image_url: width: 1200 | image_tag: 
                        class: 'portfolio-showcase__image', 
                        loading: 'lazy',
                        alt: block.settings.product_name | escape
                      }}
                    </div>
                  {% endif %}
                  {% if block.settings.image_3 != blank %}
                    <div class="swiper-slide portfolio-showcase__slide">
                      {{ block.settings.image_3 | image_url: width: 1200 | image_tag: 
                        class: 'portfolio-showcase__image', 
                        loading: 'lazy',
                        alt: block.settings.product_name | escape
                      }}
                    </div>
                  {% endif %}
                  {% if block.settings.image_4 != blank %}
                    <div class="swiper-slide portfolio-showcase__slide">
                      {{ block.settings.image_4 | image_url: width: 1200 | image_tag: 
                        class: 'portfolio-showcase__image', 
                        loading: 'lazy',
                        alt: block.settings.product_name | escape
                      }}
                    </div>
                  {% endif %}
                  {% if block.settings.image_5 != blank %}
                    <div class="swiper-slide portfolio-showcase__slide">
                      {{ block.settings.image_5 | image_url: width: 1200 | image_tag: 
                        class: 'portfolio-showcase__image', 
                        loading: 'lazy',
                        alt: block.settings.product_name | escape
                      }}
                    </div>
                  {% endif %}
                {% endfor %}
              </div>
              
              {% if section.settings.show_navigation %}
                <div class="portfolio-showcase__navigation">
                  <button class="portfolio-showcase__nav portfolio-showcase__nav--prev swiper-button-prev">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                      <path d="M12.5 15L7.5 10L12.5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </button>
                  <button class="portfolio-showcase__nav portfolio-showcase__nav--next swiper-button-next">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                      <path d="M7.5 15L12.5 10L7.5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </button>
                </div>
              {% endif %}
              
              {% if section.settings.show_pagination %}
                <div class="portfolio-showcase__pagination swiper-pagination"></div>
              {% endif %}
            </div>
          </div>

          {% comment %} Thumbnail Navigation {% endcomment %}
          {% if section.settings.show_thumbnails %}
            <div class="portfolio-showcase__thumbnails">
              <div class="swiper portfolio-showcase__thumb-swiper">
                <div class="swiper-wrapper">
                  {% for block in section.blocks %}
                    {% if block.settings.image_1 != blank %}
                      <div class="swiper-slide portfolio-showcase__thumb-slide">
                        {{ block.settings.image_1 | image_url: width: 200 | image_tag: 
                          class: 'portfolio-showcase__thumb-image', 
                          loading: 'lazy'
                        }}
                      </div>
                    {% endif %}
                    {% if block.settings.image_2 != blank %}
                      <div class="swiper-slide portfolio-showcase__thumb-slide">
                        {{ block.settings.image_2 | image_url: width: 200 | image_tag: 
                          class: 'portfolio-showcase__thumb-image', 
                          loading: 'lazy'
                        }}
                      </div>
                    {% endif %}
                    {% if block.settings.image_3 != blank %}
                      <div class="swiper-slide portfolio-showcase__thumb-slide">
                        {{ block.settings.image_3 | image_url: width: 200 | image_tag: 
                          class: 'portfolio-showcase__thumb-image', 
                          loading: 'lazy'
                        }}
                      </div>
                    {% endif %}
                    {% if block.settings.image_4 != blank %}
                      <div class="swiper-slide portfolio-showcase__thumb-slide">
                        {{ block.settings.image_4 | image_url: width: 200 | image_tag: 
                          class: 'portfolio-showcase__thumb-image', 
                          loading: 'lazy'
                        }}
                      </div>
                    {% endif %}
                    {% if block.settings.image_5 != blank %}
                      <div class="swiper-slide portfolio-showcase__thumb-slide">
                        {{ block.settings.image_5 | image_url: width: 200 | image_tag: 
                          class: 'portfolio-showcase__thumb-image', 
                          loading: 'lazy'
                        }}
                      </div>
                    {% endif %}
                  {% endfor %}
                </div>
              </div>
            </div>
          {% endif %}
        </div>

        {% comment %} Product Information Panel {% endcomment %}
        <div class="portfolio-showcase__info">
          {% for block in section.blocks %}
            <div class="portfolio-showcase__product-info" 
                 data-product="{{ forloop.index0 }}" 
                 {% unless forloop.first %}style="display: none;"{% endunless %}>
              
              {% if block.settings.product_name != blank %}
                <h3 class="portfolio-showcase__product-title">{{ block.settings.product_name }}</h3>
              {% endif %}

              {% if block.settings.product_description != blank %}
                <div class="portfolio-showcase__description">
                  {{ block.settings.product_description }}
                </div>
              {% endif %}

              {% if block.settings.details != blank %}
                <div class="portfolio-showcase__details">
                  <h4 class="portfolio-showcase__details-title">Product Details</h4>
                  <div class="portfolio-showcase__details-content">
                    {{ block.settings.details }}
                  </div>
                </div>
              {% endif %}
            </div>
          {% endfor %}

          {% if section.blocks.size > 1 %}
            <div class="portfolio-showcase__selector">
              {% for block in section.blocks %}
                <button class="portfolio-showcase__selector-item {% if forloop.first %}active{% endif %}" 
                        data-product="{{ forloop.index0 }}">
                  <span class="portfolio-showcase__selector-number">{{ forloop.index | prepend: '0' }}</span>
                  <span class="portfolio-showcase__selector-name">{{ block.settings.product_name | default: 'Product' | truncate: 15 }}</span>
                </button>
              {% endfor %}
            </div>
          {% endif %}
        </div>
      </div>

    {% else %}
      <div class="portfolio-showcase__empty">
        <h3>No products to display</h3>
        <p>Add product blocks in the theme editor to showcase your portfolio.</p>
      </div>
    {% endif %}
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css">

<script>
document.addEventListener('DOMContentLoaded', function() {
  const sectionId = '{{ section.id }}';
  const mainSwiper = document.querySelector(`[data-section-id="${sectionId}"] .portfolio-showcase__main-swiper`);
  const thumbSwiper = document.querySelector(`[data-section-id="${sectionId}"] .portfolio-showcase__thumb-swiper`);
  
  if (!mainSwiper) return;

  let thumbSwiperInstance;
  
  if (thumbSwiper) {
    thumbSwiperInstance = new Swiper(thumbSwiper, {
      spaceBetween: 10,
      slidesPerView: 'auto',
      freeMode: true,
      watchSlidesProgress: true,
      breakpoints: {
        640: { slidesPerView: 6 },
        768: { slidesPerView: 8 },
        1024: { slidesPerView: 10 }
      }
    });
  }

  const mainSwiperInstance = new Swiper(mainSwiper, {
    spaceBetween: 0,
    effect: 'fade',
    fadeEffect: { crossFade: true },
    autoplay: {{ section.settings.autoplay | json }} ? {
      delay: {{ section.settings.autoplay_speed | times: 1000 }},
      disableOnInteraction: false,
      pauseOnMouseEnter: true
    } : false,
    navigation: {
      nextEl: `[data-section-id="${sectionId}"] .portfolio-showcase__nav--next`,
      prevEl: `[data-section-id="${sectionId}"] .portfolio-showcase__nav--prev`,
    },
    pagination: {
      el: `[data-section-id="${sectionId}"] .portfolio-showcase__pagination`,
      clickable: true,
    },
    thumbs: thumbSwiperInstance ? {
      swiper: thumbSwiperInstance,
    } : undefined,
    on: {
      slideChange: function() {
        updateProductInfo(this.activeIndex);
      }
    }
  });

  function updateProductInfo(slideIndex) {
    let productIndex = 0;
    let slideCount = 0;
    
    const blocks = {{ section.blocks | json }};
    for (let i = 0; i < blocks.length; i++) {
      let imagesInBlock = 0;
      if (blocks[i].settings.image_1) imagesInBlock++;
      if (blocks[i].settings.image_2) imagesInBlock++;
      if (blocks[i].settings.image_3) imagesInBlock++;
      if (blocks[i].settings.image_4) imagesInBlock++;
      if (blocks[i].settings.image_5) imagesInBlock++;
      
      if (slideIndex < slideCount + imagesInBlock) {
        productIndex = i;
        break;
      }
      slideCount += imagesInBlock;
    }
    
    document.querySelectorAll(`[data-section-id="${sectionId}"] .portfolio-showcase__product-info`).forEach(info => {
      info.style.display = 'none';
    });
    
    const currentInfo = document.querySelector(`[data-section-id="${sectionId}"] .portfolio-showcase__product-info[data-product="${productIndex}"]`);
    if (currentInfo) {
      currentInfo.style.display = 'block';
    }
    
    document.querySelectorAll(`[data-section-id="${sectionId}"] .portfolio-showcase__selector-item`).forEach(item => {
      item.classList.remove('active');
    });
    
    const activeSelector = document.querySelector(`[data-section-id="${sectionId}"] .portfolio-showcase__selector-item[data-product="${productIndex}"]`);
    if (activeSelector) {
      activeSelector.classList.add('active');
    }
  }

  document.querySelectorAll(`[data-section-id="${sectionId}"] .portfolio-showcase__selector-item`).forEach(item => {
    item.addEventListener('click', function() {
      const productIndex = parseInt(this.getAttribute('data-product'));
      
      let slideIndex = 0;
      const blocks = {{ section.blocks | json }};
      for (let i = 0; i < productIndex; i++) {
        if (blocks[i].settings.image_1) slideIndex++;
        if (blocks[i].settings.image_2) slideIndex++;
        if (blocks[i].settings.image_3) slideIndex++;
        if (blocks[i].settings.image_4) slideIndex++;
        if (blocks[i].settings.image_5) slideIndex++;
      }
      
      mainSwiperInstance.slideTo(slideIndex);
    });
  });
});
</script>

{% schema %}
{
  "name": "Portfolio Showcase",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Section Header"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Our Manufacturing Portfolio"
    },
    {
      "type": "richtext",
      "id": "subheading",
      "label": "Description",
      "default": "<p>Explore our previous work and see the quality craftsmanship that goes into every piece we manufacture.</p>"
    },
    {
      "type": "header",
      "content": "Display Options"
    },
    {
      "type": "checkbox",
      "id": "show_thumbnails",
      "label": "Show thumbnail navigation",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_navigation",
      "label": "Show arrow navigation",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_pagination",
      "label": "Show dot pagination",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Auto-rotate slides",
      "default": false
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "min": 3,
      "max": 10,
      "step": 1,
      "unit": "s",
      "label": "Auto-rotate speed",
      "default": 5
    }
  ],
  "blocks": [
    {
      "type": "product",
      "name": "Product",
      "limit": 10,
      "settings": [
        {
          "type": "text",
          "id": "product_name",
          "label": "Product Name",
          "default": "Premium Hoodie"
        },
        {
          "type": "richtext",
          "id": "product_description",
          "label": "Description",
          "default": "<p>High-quality hoodie manufactured with attention to detail and premium materials.</p>"
        },
        {
          "type": "richtext",
          "id": "details",
          "label": "Product Details",
          "default": "<p><strong>Material:</strong> 100% Cotton<br><strong>Weight:</strong> 280 GSM<br><strong>Sizes:</strong> XS - 3XL</p>"
        },
        {
          "type": "header",
          "content": "Product Images (up to 5)"
        },
        {
          "type": "image_picker",
          "id": "image_1",
          "label": "Image 1"
        },
        {
          "type": "image_picker",
          "id": "image_2",
          "label": "Image 2"
        },
        {
          "type": "image_picker",
          "id": "image_3",
          "label": "Image 3"
        },
        {
          "type": "image_picker",
          "id": "image_4",
          "label": "Image 4"
        },
        {
          "type": "image_picker",
          "id": "image_5",
          "label": "Image 5"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Portfolio Showcase",
      "blocks": [
        {
          "type": "product",
          "settings": {
            "product_name": "Premium Cotton Hoodie",
            "product_description": "<p>Expertly crafted hoodie featuring premium cotton blend, reinforced stitching, and superior comfort.</p>",
            "details": "<p><strong>Material:</strong> 80% Cotton, 20% Polyester<br><strong>Weight:</strong> 320 GSM<br><strong>Features:</strong> Kangaroo pocket, ribbed cuffs<br><strong>Colors:</strong> Available in 25+ colors</p>"
          }
        }
      ]
    }
  ]
}
{% endschema %}