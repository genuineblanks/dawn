{{ 'product-showcase-gallery.css' | asset_url | stylesheet_tag }}

<div class="product-showcase" data-section-id="{{ section.id }}">
  <div class="product-showcase__container">
    
    {% comment %} Section Header {% endcomment %}
    {% if section.settings.heading != blank or section.settings.subheading != blank %}
      <div class="product-showcase__header">
        {% if section.settings.heading != blank %}
          <h2 class="product-showcase__title h1">{{ section.settings.heading }}</h2>
        {% endif %}
        {% if section.settings.subheading != blank %}
          <div class="product-showcase__subtitle">{{ section.settings.subheading }}</div>
        {% endif %}
      </div>
    {% endif %}

    {% if section.blocks.size > 0 %}
      <div class="product-showcase__content">
        
        {% comment %} Main Gallery Display {% endcomment %}
        <div class="product-showcase__gallery">
          <div class="product-showcase__main-display">
            <div class="swiper product-showcase__main-swiper" data-gallery="main">
              <div class="swiper-wrapper">
                {% for block in section.blocks %}
                  {% assign product_images = block.settings.product_images | split: ',' %}
                  {% for image_handle in product_images %}
                    {% assign image_url = image_handle | strip | file_url %}
                    <div class="swiper-slide product-showcase__main-slide" data-product="{{ forloop.parentloop.index0 }}">
                      <div class="product-showcase__image-container">
                        <img src="{{ image_url }}" 
                             alt="{{ block.settings.product_name | escape }}" 
                             class="product-showcase__main-image"
                             loading="lazy">
                        <div class="product-showcase__image-overlay">
                          <button class="product-showcase__zoom-btn" data-image="{{ image_url }}">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                              <path d="M21 21L16.514 16.506M19 10.5C19 15.194 15.194 19 10.5 19S2 15.194 2 10.5 5.806 2 10.5 2 19 5.806 19 10.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                          </button>
                        </div>
                      </div>
                    </div>
                  {% endfor %}
                {% endfor %}
              </div>
              
              <div class="product-showcase__navigation">
                <button class="product-showcase__nav product-showcase__nav--prev">
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M12.5 15L7.5 10L12.5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
                <button class="product-showcase__nav product-showcase__nav--next">
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M7.5 15L12.5 10L7.5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
              </div>
            </div>
          </div>

          {% comment %} Thumbnail Grid {% endcomment %}
          <div class="product-showcase__thumbnails">
            <div class="swiper product-showcase__thumb-swiper" data-gallery="thumbs">
              <div class="swiper-wrapper">
                {% for block in section.blocks %}
                  {% assign product_images = block.settings.product_images | split: ',' %}
                  {% for image_handle in product_images %}
                    {% assign image_url = image_handle | strip | file_url %}
                    <div class="swiper-slide product-showcase__thumb-slide" data-product="{{ forloop.parentloop.index0 }}">
                      <div class="product-showcase__thumb-container">
                        <img src="{{ image_url }}" 
                             alt="{{ block.settings.product_name | escape }}" 
                             class="product-showcase__thumb-image"
                             loading="lazy">
                      </div>
                    </div>
                  {% endfor %}
                {% endfor %}
              </div>
            </div>
            
            {% comment %} Scroll Indicators {% endcomment %}
            <div class="product-showcase__thumb-nav">
              <button class="product-showcase__thumb-prev">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                  <path d="M10 12L6 8L10 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
              <button class="product-showcase__thumb-next">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                  <path d="M6 12L10 8L6 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
          </div>
        </div>

        {% comment %} Product Information Panel {% endcomment %}
        <div class="product-showcase__info">
          <div class="product-showcase__info-content">
            {% for block in section.blocks %}
              <div class="product-showcase__product-info" 
                   data-product="{{ forloop.index0 }}" 
                   {% unless forloop.first %}style="display: none;"{% endunless %}>
                
                <div class="product-showcase__product-header">
                  {% if block.settings.product_category != blank %}
                    <div class="product-showcase__category">{{ block.settings.product_category }}</div>
                  {% endif %}
                  {% if block.settings.product_name != blank %}
                    <h3 class="product-showcase__product-title">{{ block.settings.product_name }}</h3>
                  {% endif %}
                </div>

                {% if block.settings.product_description != blank %}
                  <div class="product-showcase__description">
                    {{ block.settings.product_description }}
                  </div>
                {% endif %}

                {% comment %} Specifications Grid {% endcomment %}
                <div class="product-showcase__specs">
                  {% if block.settings.material != blank %}
                    <div class="product-showcase__spec">
                      <span class="product-showcase__spec-label">Material:</span>
                      <span class="product-showcase__spec-value">{{ block.settings.material }}</span>
                    </div>
                  {% endif %}
                  {% if block.settings.gsm != blank %}
                    <div class="product-showcase__spec">
                      <span class="product-showcase__spec-label">GSM:</span>
                      <span class="product-showcase__spec-value">{{ block.settings.gsm }}</span>
                    </div>
                  {% endif %}
                  {% if block.settings.sizes != blank %}
                    <div class="product-showcase__spec">
                      <span class="product-showcase__spec-label">Sizes:</span>
                      <span class="product-showcase__spec-value">{{ block.settings.sizes }}</span>
                    </div>
                  {% endif %}
                  {% if block.settings.colors != blank %}
                    <div class="product-showcase__spec">
                      <span class="product-showcase__spec-label">Colors:</span>
                      <span class="product-showcase__spec-value">{{ block.settings.colors }}</span>
                    </div>
                  {% endif %}
                  {% if block.settings.moq != blank %}
                    <div class="product-showcase__spec">
                      <span class="product-showcase__spec-label">MOQ:</span>
                      <span class="product-showcase__spec-value">{{ block.settings.moq }}</span>
                    </div>
                  {% endif %}
                  {% if block.settings.lead_time != blank %}
                    <div class="product-showcase__spec">
                      <span class="product-showcase__spec-label">Lead Time:</span>
                      <span class="product-showcase__spec-value">{{ block.settings.lead_time }}</span>
                    </div>
                  {% endif %}
                </div>

                {% if block.settings.cta_text != blank and block.settings.cta_url != blank %}
                  <div class="product-showcase__cta">
                    <a href="{{ block.settings.cta_url }}" class="product-showcase__cta-btn btn btn--primary">
                      {{ block.settings.cta_text }}
                      <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                        <path d="M3.75 9H14.25M14.25 9L9 3.75M14.25 9L9 14.25" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </a>
                  </div>
                {% endif %}
              </div>
            {% endfor %}
          </div>

          {% comment %} Product Selector Tabs {% endcomment %}
          {% if section.blocks.size > 1 %}
            <div class="product-showcase__tabs">
              {% for block in section.blocks %}
                <button class="product-showcase__tab {% if forloop.first %}active{% endif %}" 
                        data-product="{{ forloop.index0 }}">
                  <span class="product-showcase__tab-number">{{ forloop.index | prepend: '0' }}</span>
                  <span class="product-showcase__tab-name">{{ block.settings.product_name | truncate: 20 }}</span>
                </button>
              {% endfor %}
            </div>
          {% endif %}
        </div>
      </div>

      {% comment %} Lightbox Modal {% endcomment %}
      <div class="product-showcase__lightbox" id="lightbox-{{ section.id }}">
        <div class="product-showcase__lightbox-content">
          <button class="product-showcase__lightbox-close">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
              <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          <img src="" alt="" class="product-showcase__lightbox-image">
        </div>
      </div>
    {% endif %}
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css">

<script>
document.addEventListener('DOMContentLoaded', function() {
  const sectionId = '{{ section.id }}';
  const mainSwiper = document.querySelector(`[data-section-id="${sectionId}"] .product-showcase__main-swiper`);
  const thumbSwiper = document.querySelector(`[data-section-id="${sectionId}"] .product-showcase__thumb-swiper`);
  
  if (!mainSwiper || !thumbSwiper) return;

  // Initialize thumbnail swiper
  const thumbSwiperInstance = new Swiper(thumbSwiper, {
    spaceBetween: 10,
    slidesPerView: 'auto',
    freeMode: true,
    watchSlidesProgress: true,
    navigation: {
      nextEl: `[data-section-id="${sectionId}"] .product-showcase__thumb-next`,
      prevEl: `[data-section-id="${sectionId}"] .product-showcase__thumb-prev`,
    },
    breakpoints: {
      640: {
        slidesPerView: 4,
      },
      768: {
        slidesPerView: 5,
      },
      1024: {
        slidesPerView: 6,
      }
    }
  });

  // Initialize main swiper
  const mainSwiperInstance = new Swiper(mainSwiper, {
    spaceBetween: 10,
    navigation: {
      nextEl: `[data-section-id="${sectionId}"] .product-showcase__nav--next`,
      prevEl: `[data-section-id="${sectionId}"] .product-showcase__nav--prev`,
    },
    thumbs: {
      swiper: thumbSwiperInstance,
    },
    on: {
      slideChange: function() {
        updateProductInfo(this.activeIndex);
      }
    }
  });

  // Product info switching
  function updateProductInfo(slideIndex) {
    const activeSlide = mainSwiper.querySelector(`[data-product]`);
    if (!activeSlide) return;
    
    const productIndex = activeSlide.getAttribute('data-product');
    
    // Hide all product info
    document.querySelectorAll(`[data-section-id="${sectionId}"] .product-showcase__product-info`).forEach(info => {
      info.style.display = 'none';
    });
    
    // Show current product info
    const currentInfo = document.querySelector(`[data-section-id="${sectionId}"] .product-showcase__product-info[data-product="${productIndex}"]`);
    if (currentInfo) {
      currentInfo.style.display = 'block';
    }
    
    // Update active tab
    document.querySelectorAll(`[data-section-id="${sectionId}"] .product-showcase__tab`).forEach(tab => {
      tab.classList.remove('active');
    });
    
    const activeTab = document.querySelector(`[data-section-id="${sectionId}"] .product-showcase__tab[data-product="${productIndex}"]`);
    if (activeTab) {
      activeTab.classList.add('active');
    }
  }

  // Tab switching
  document.querySelectorAll(`[data-section-id="${sectionId}"] .product-showcase__tab`).forEach(tab => {
    tab.addEventListener('click', function() {
      const productIndex = parseInt(this.getAttribute('data-product'));
      
      // Find the first slide of this product
      const targetSlide = document.querySelector(`[data-section-id="${sectionId}"] .product-showcase__main-slide[data-product="${productIndex}"]`);
      if (targetSlide) {
        const slideIndex = Array.from(targetSlide.parentNode.children).indexOf(targetSlide);
        mainSwiperInstance.slideTo(slideIndex);
      }
    });
  });

  // Lightbox functionality
  const lightbox = document.getElementById(`lightbox-${sectionId}`);
  const lightboxImage = lightbox.querySelector('.product-showcase__lightbox-image');
  const lightboxClose = lightbox.querySelector('.product-showcase__lightbox-close');

  document.querySelectorAll(`[data-section-id="${sectionId}"] .product-showcase__zoom-btn`).forEach(btn => {
    btn.addEventListener('click', function() {
      const imageUrl = this.getAttribute('data-image');
      lightboxImage.src = imageUrl;
      lightbox.classList.add('active');
      document.body.style.overflow = 'hidden';
    });
  });

  lightboxClose.addEventListener('click', function() {
    lightbox.classList.remove('active');
    document.body.style.overflow = '';
  });

  lightbox.addEventListener('click', function(e) {
    if (e.target === lightbox) {
      lightbox.classList.remove('active');
      document.body.style.overflow = '';
    }
  });
});
</script>

{% schema %}
{
  "name": "Product Showcase Gallery",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Section Header"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Our Manufacturing Showcase"
    },
    {
      "type": "richtext",
      "id": "subheading",
      "label": "Description",
      "default": "<p>Explore our premium quality products crafted with precision and attention to detail. Each piece represents our commitment to excellence in manufacturing.</p>"
    }
  ],
  "blocks": [
    {
      "type": "product",
      "name": "Product",
      "limit": 12,
      "settings": [
        {
          "type": "header",
          "content": "Product Information"
        },
        {
          "type": "text",
          "id": "product_category",
          "label": "Category",
          "default": "Premium Hoodie",
          "info": "e.g., Hoodie, T-Shirt, Sweatshirt"
        },
        {
          "type": "text",
          "id": "product_name",
          "label": "Product Name",
          "default": "Premium Cotton Hoodie"
        },
        {
          "type": "richtext",
          "id": "product_description",
          "label": "Description",
          "default": "<p>Crafted from premium cotton blend with superior stitching and attention to detail. Perfect for brands seeking high-quality blank apparel.</p>"
        },
        {
          "type": "header",
          "content": "Product Images"
        },
        {
          "type": "textarea",
          "id": "product_images",
          "label": "Image URLs",
          "info": "Enter image URLs separated by commas. Upload images to Files first, then copy URLs here.",
          "placeholder": "https://cdn.shopify.com/image1.jpg, https://cdn.shopify.com/image2.jpg"
        },
        {
          "type": "header",
          "content": "Specifications"
        },
        {
          "type": "text",
          "id": "material",
          "label": "Material",
          "default": "100% Cotton",
          "placeholder": "e.g., 100% Cotton, Cotton Blend"
        },
        {
          "type": "text",
          "id": "gsm",
          "label": "GSM/Weight",
          "default": "280 GSM",
          "placeholder": "e.g., 280 GSM, 320 GSM"
        },
        {
          "type": "text",
          "id": "sizes",
          "label": "Available Sizes",
          "default": "XS - 3XL",
          "placeholder": "e.g., XS - 3XL, S - XXL"
        },
        {
          "type": "text",
          "id": "colors",
          "label": "Available Colors",
          "default": "20+ Colors",
          "placeholder": "e.g., 20+ Colors, Custom Colors"
        },
        {
          "type": "text",
          "id": "moq",
          "label": "Minimum Order Quantity",
          "default": "50 pieces",
          "placeholder": "e.g., 50 pieces, 100 pieces"
        },
        {
          "type": "text",
          "id": "lead_time",
          "label": "Lead Time",
          "default": "2-3 weeks",
          "placeholder": "e.g., 2-3 weeks, 15-20 days"
        },
        {
          "type": "header",
          "content": "Call to Action"
        },
        {
          "type": "text",
          "id": "cta_text",
          "label": "Button Text",
          "default": "Get Quote"
        },
        {
          "type": "url",
          "id": "cta_url",
          "label": "Button Link"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Product Showcase Gallery",
      "blocks": [
        {
          "type": "product",
          "settings": {
            "product_category": "Premium Hoodie",
            "product_name": "Cotton Blend Hoodie",
            "product_description": "<p>Premium quality hoodie made from finest cotton blend. Features reinforced stitching, pre-shrunk fabric, and superior durability.</p>",
            "material": "80% Cotton, 20% Polyester",
            "gsm": "320 GSM",
            "sizes": "XS - 3XL",
            "colors": "25+ Colors Available",
            "moq": "50 pieces",
            "lead_time": "2-3 weeks",
            "cta_text": "Request Quote"
          }
        },
        {
          "type": "product",
          "settings": {
            "product_category": "Basic T-Shirt",
            "product_name": "Premium Cotton Tee",
            "product_description": "<p>Soft, comfortable basic tee perfect for printing and branding. Made from high-quality ring-spun cotton.</p>",
            "material": "100% Ring-Spun Cotton",
            "gsm": "180 GSM",
            "sizes": "XS - 2XL",
            "colors": "30+ Colors Available",
            "moq": "100 pieces",
            "lead_time": "1-2 weeks",
            "cta_text": "Get Sample"
          }
        }
      ]
    }
  ]
}
{% endschema %}