{% comment %}
  Bulk Quantity Buttons Component
  
  Renders bulk quantity selection buttons for products that support volume pricing
  
  Usage:
  {% render 'bulk-quantity-buttons', product: product, section_id: section.id %}
  
  Parameters:
  - product: The product object
  - section_id: The section ID for unique element identification
  - show_volume_table: Boolean to show/hide volume pricing table (default: true)
  - quantities: Array of quantities to display as buttons (default: [1000, 2000, 5000, 10000])
{% endcomment %}

{%- liquid
  assign show_volume_table = show_volume_table | default: true
  assign quantities = quantities | default: '1000,2000,5000,10000' | split: ','
  assign section_id = section_id | default: 'main'
  assign has_volume_pricing = false
  
  # Check if product has volume pricing configured
  if product.quantity_price_breaks_configured?
    assign has_volume_pricing = true
  endif
-%}

{%- if has_volume_pricing or true -%}
  <div class="bulk-quantity-section" id="bulk-quantity-{{ section_id }}">
    <!-- Bulk Quantity Label -->
    <div class="bulk-quantity-label">
      {{ 'products.product.bulk_quantity.label' | t | default: 'Bulk Quantity' }}
    </div>
    
    <!-- Bulk Quantity Buttons -->
    <div class="bulk-quantity-buttons">
      {%- for quantity in quantities -%}
        <button 
          type="button" 
          class="bulk-quantity-btn" 
          data-quantity="{{ quantity | strip }}"
          data-product-id="{{ product.id }}"
          data-section-id="{{ section_id }}"
          aria-label="{{ 'products.product.bulk_quantity.select_quantity' | t: quantity: quantity | default: 'Select quantity' }} {{ quantity | strip }}"
          title="{{ 'products.product.bulk_quantity.select_quantity' | t: quantity: quantity | default: 'Select quantity' }} {{ quantity | strip }}"
        >
          {{ quantity | strip | number_with_delimiter }}
        </button>
      {%- endfor -%}
    </div>
    
    <!-- Bulk Quantity Info -->
    <div class="bulk-quantity-info" id="bulk-quantity-info-{{ section_id }}">
      <div class="bulk-unit-price">
        <span class="unit-price-label">{{ 'products.product.bulk_quantity.unit_price' | t | default: 'Price per unit:' }}</span>
        <span class="unit-price-value">
          {%- if product.selected_or_first_available_variant.price -%}
            {{ product.selected_or_first_available_variant.price | money }}
          {%- else -%}
            {{ product.price | money }}
          {%- endif -%}
        </span>
      </div>
      
      <div class="bulk-total-price">
        {{ 'products.product.bulk_quantity.total_price' | t | default: 'Total:' }}
        <span class="total-price-value">
          {%- if product.selected_or_first_available_variant.price -%}
            {{ product.selected_or_first_available_variant.price | money }}
          {%- else -%}
            {{ product.price | money }}
          {%- endif -%}
        </span>
      </div>
      
      <div class="bulk-savings" id="bulk-savings-{{ section_id }}" style="display: none;">
        {{ 'products.product.bulk_quantity.savings' | t | default: 'You save:' }}
        <span class="savings-amount"></span>
      </div>
    </div>
    
    {%- if show_volume_table and product.quantity_price_breaks_configured? -%}
      <!-- Volume Pricing Table -->
      <div class="bulk-volume-pricing-container">
        <h4 class="bulk-volume-pricing-title">
          {{ 'products.product.bulk_quantity.volume_pricing' | t | default: 'Volume Pricing' }}
        </h4>
        
        <table class="bulk-volume-pricing">
          <thead>
            <tr>
              <th>{{ 'products.product.bulk_quantity.quantity_range' | t | default: 'Quantity' }}</th>
              <th>{{ 'products.product.bulk_quantity.price_per_unit' | t | default: 'Price per unit' }}</th>
              <th>{{ 'products.product.bulk_quantity.total_savings' | t | default: 'Total savings' }}</th>
            </tr>
          </thead>
          <tbody>
            {%- for variant in product.variants -%}
              {%- if variant.quantity_price_breaks.size > 0 -%}
                {%- for price_break in variant.quantity_price_breaks -%}
                  <tr class="price-break-row" data-variant-id="{{ variant.id }}" data-min-quantity="{{ price_break.minimum_quantity }}">
                    <td>
                      {%- if forloop.last -%}
                        {{ price_break.minimum_quantity }}+
                      {%- else -%}
                        {{ price_break.minimum_quantity }} - {{ variant.quantity_price_breaks[forloop.index].minimum_quantity | minus: 1 }}
                      {%- endif -%}
                    </td>
                    <td>{{ price_break.price | money }}</td>
                    <td>
                      {%- assign savings = variant.price | minus: price_break.price | times: price_break.minimum_quantity -%}
                      {%- if savings > 0 -%}
                        {{ savings | money }}
                      {%- else -%}
                        -
                      {%- endif -%}
                    </td>
                  </tr>
                {%- endfor -%}
              {%- endif -%}
            {%- endfor -%}
          </tbody>
        </table>
      </div>
    {%- endif -%}
  </div>

  <!-- Bulk Quantity Styles -->
  <style>
    .bulk-quantity-section {
      margin: 2rem 0;
      padding: 1.5rem;
      background: rgba(var(--color-foreground), 0.02);
      border: 1px solid rgba(var(--color-foreground), 0.1);
      border-radius: 0.5rem;
    }
    
    .bulk-quantity-label {
      font-size: 1.4rem;
      font-weight: 600;
      letter-spacing: 0.1rem;
      text-transform: uppercase;
      margin-bottom: 1rem;
      color: rgba(var(--color-foreground), 0.8);
    }
    
    .bulk-quantity-buttons {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      margin-bottom: 1.5rem;
    }
    
    .bulk-quantity-btn {
      background: transparent;
      border: 2px solid rgba(var(--color-foreground), 0.2);
      color: rgba(var(--color-foreground), 0.8);
      padding: 1rem 1.5rem;
      font-size: 1.4rem;
      font-weight: 600;
      letter-spacing: 0.1rem;
      text-transform: uppercase;
      cursor: pointer;
      transition: all 0.3s ease;
      border-radius: 0.5rem;
      min-width: 8rem;
      text-align: center;
    }
    
    .bulk-quantity-btn:hover {
      border-color: rgba(var(--color-foreground), 0.6);
      background: rgba(var(--color-foreground), 0.05);
      transform: translateY(-1px);
    }
    
    .bulk-quantity-btn.active {
      background: rgba(var(--color-foreground), 1);
      color: rgba(var(--color-background), 1);
      border-color: rgba(var(--color-foreground), 1);
    }
    
    .bulk-quantity-info {
      background: rgba(var(--color-foreground), 0.03);
      border: 1px solid rgba(var(--color-foreground), 0.1);
      border-radius: 0.5rem;
      padding: 1.5rem;
      margin-top: 1rem;
    }
    
    .bulk-unit-price {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 1.3rem;
      margin-bottom: 0.5rem;
    }
    
    .unit-price-label {
      color: rgba(var(--color-foreground), 0.6);
    }
    
    .unit-price-value {
      font-weight: 600;
      color: rgba(var(--color-foreground), 1);
    }
    
    .bulk-total-price {
      font-size: 1.5rem;
      font-weight: 700;
      color: rgba(var(--color-foreground), 1);
      margin-top: 0.5rem;
    }
    
    .bulk-savings {
      color: #22c55e;
      font-size: 1.2rem;
      font-weight: 600;
      margin-top: 0.5rem;
    }
    
    .bulk-volume-pricing-container {
      margin-top: 2rem;
    }
    
    .bulk-volume-pricing-title {
      font-size: 1.4rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: rgba(var(--color-foreground), 0.8);
    }
    
    .bulk-volume-pricing {
      width: 100%;
      border-collapse: collapse;
      font-size: 1.3rem;
    }
    
    .bulk-volume-pricing th,
    .bulk-volume-pricing td {
      padding: 1rem;
      text-align: left;
      border-bottom: 1px solid rgba(var(--color-foreground), 0.1);
    }
    
    .bulk-volume-pricing th {
      font-weight: 600;
      color: rgba(var(--color-foreground), 0.8);
      background: rgba(var(--color-foreground), 0.03);
    }
    
    .bulk-volume-pricing tr:nth-child(even) {
      background: rgba(var(--color-foreground), 0.02);
    }
    
    .price-break-active {
      background: rgba(var(--color-foreground), 0.1) !important;
      font-weight: 600;
    }
    
    @media screen and (max-width: 749px) {
      .bulk-quantity-buttons {
        gap: 0.5rem;
      }
      
      .bulk-quantity-btn {
        padding: 0.8rem 1.2rem;
        font-size: 1.2rem;
        min-width: 6rem;
      }
      
      .bulk-quantity-info {
        padding: 1rem;
      }
      
      .bulk-unit-price {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.2rem;
      }
    }
    
    @media screen and (max-width: 480px) {
      .bulk-quantity-buttons {
        flex-direction: column;
        gap: 0.8rem;
      }
      
      .bulk-quantity-btn {
        width: 100%;
        justify-content: center;
      }
    }
  </style>

  <!-- Initialize bulk quantity handler -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize bulk quantity functionality for this section
      const bulkSection = document.getElementById('bulk-quantity-{{ section_id }}');
      if (bulkSection && window.BulkQuantityHandler) {
        // Handler will be initialized globally
        console.log('Bulk quantity section initialized for {{ section_id }}');
      }
    });
  </script>
{%- endif -%}