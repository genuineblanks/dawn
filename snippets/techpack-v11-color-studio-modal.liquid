{% comment %}
  TechPack V11 - Pantone Color Studio Modal (90vw × 85vh)

  Large modal (NOT full-screen) for Pantone color browsing and lab dip collection
  Features: Pantone search, HSL picker, lab dip cart, cotton garment assignment
  Main page visible/blurred behind modal for context
{% endcomment %}

<div class="color-studio-modal-overlay" id="colorStudioModalOverlay" style="display: none;">

  <div class="color-studio-modal" id="colorStudioModal">

    {%- comment -%} Modal Header {%- endcomment -%}
    <div class="color-studio-modal__header">
      <h2 class="color-studio-modal__title">Pantone Color Studio</h2>
      <button type="button" class="color-studio-modal__close" data-action="close-color-studio-modal">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M6 6L18 18M6 18L18 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>

    {%- comment -%} Modal Content - 2 Column Layout {%- endcomment -%}
    <div class="color-studio-modal__content">

      {%- comment -%} LEFT: Color Selection (65%) {%- endcomment -%}
      <div class="color-studio-modal__left">

        {%- comment -%} Popular Colors Grid {%- endcomment -%}
        <div class="modal-popular">
          <h4 class="modal-popular__title">Popular Colors</h4>
          <div class="modal-popular__grid" id="modalPopularColorsGrid">
            {%- comment -%} Populated by JavaScript with 18 popular Pantone colors {%- endcomment -%}
          </div>
        </div>

        {%- comment -%} Advanced HSL Picker {%- endcomment -%}
        <div class="modal-advanced">
          <h4 class="modal-advanced__title">Advanced Color Picker</h4>
          <p class="modal-advanced__description">Pick any color to find closest Pantone match</p>

          {%- comment -%} Native HTML5 Color Picker {%- endcomment -%}
          <div class="modal-color-picker-native">
            <label for="modalColorPickerInput" class="modal-color-picker-native__label">Pick a Color:</label>
            <input
              type="color"
              id="modalColorPickerInput"
              class="modal-color-picker-native__input"
              value="#EC4899"
              data-action="modal-native-color-change"
            />
          </div>

          <div class="modal-sliders">
            <div class="modal-slider">
              <label for="modalHueSlider" class="modal-slider__label">
                Hue
                <span id="modalHueValue" class="modal-slider__value">0</span>
              </label>
              <input
                type="range"
                id="modalHueSlider"
                class="modal-slider__input"
                min="0"
                max="360"
                value="0"
                data-action="modal-update-color-picker"
              />
            </div>

            <div class="modal-slider">
              <label for="modalSaturationSlider" class="modal-slider__label">
                Saturation
                <span id="modalSaturationValue" class="modal-slider__value">100%</span>
              </label>
              <input
                type="range"
                id="modalSaturationSlider"
                class="modal-slider__input"
                min="0"
                max="100"
                value="100"
                data-action="modal-update-color-picker"
              />
            </div>

            <div class="modal-slider">
              <label for="modalLightnessSlider" class="modal-slider__label">
                Lightness
                <span id="modalLightnessValue" class="modal-slider__value">50%</span>
              </label>
              <input
                type="range"
                id="modalLightnessSlider"
                class="modal-slider__input"
                min="0"
                max="100"
                value="50"
                data-action="modal-update-color-picker"
              />
            </div>
          </div>

        </div>

      </div>

      {%- comment -%} RIGHT: Current Selection + Cart Preview (35%) {%- endcomment -%}
      <div class="color-studio-modal__right">

        {%- comment -%} Current Selection Display {%- endcomment -%}
        <div class="modal-selection-display">
          <h4 class="modal-section-title">Current Selection</h4>
          <div id="modalCurrentSelection" class="modal-current-selection">
            <div class="modal-selection-swatch" id="modalSelectionSwatch" style="background-color: #EC4899;"></div>
            <div class="modal-selection-info">
              <p class="modal-selection-name" id="modalSelectionName">Pink Lavender</p>
              <p class="modal-selection-code" id="modalSelectionCode">17-2034 TCX</p>
            </div>
          </div>
          <button type="button" class="modal-add-btn" data-action="modal-add-to-cart" id="modalAddToCartBtn">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 4V16M4 10H16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Add to Lab Dip Cart
          </button>

          {%- comment -%} Wash Technique Warning Message {%- endcomment -%}
          <div id="washTechniqueCartWarning" class="wash-technique-cart-warning" style="display: none;">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M8 1L1 14H15L8 1Z" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>
              <path d="M8 6V9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
              <circle cx="8" cy="11.5" r="0.75" fill="currentColor"/>
            </svg>
            <span>Washing techniques must be assigned directly to a garment using the dropdown below</span>
          </div>

          {%- comment -%} OR Divider {%- endcomment -%}
          <div class="modal-divider">
            <span class="modal-divider__line"></span>
            <span class="modal-divider__text">OR</span>
            <span class="modal-divider__line"></span>
          </div>

          {%- comment -%} Instant Garment Assignment (Bypasses Cart) {%- endcomment -%}
          <div class="modal-garment-assignment">
            <label for="modalGarmentSelect" class="modal-garment-assignment__label">
              Assign Directly to Garment (Bypass Cart)
            </label>
            <select id="modalGarmentSelect" class="modal-garment-assignment__select" data-action="update-assign-button-state">
              <option value="">Select a garment...</option>
              {%- comment -%} Populated by JavaScript with Pantone-eligible garments {%- endcomment -%}
            </select>
            <button type="button" class="modal-assign-btn" id="modalAssignToGarmentBtn" data-action="assign-color-to-garment" disabled>
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M5 10L8 13L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span id="modalAssignBtnText">Assign to Garment</span>
            </button>
          </div>

          {%- comment -%} Washing Techniques (Optional Advanced Feature) {%- endcomment -%}
          <div class="wash-techniques-section">
            <button type="button" class="wash-techniques-section__toggle" data-action="toggle-wash-techniques">
              <svg class="wash-techniques-section__icon" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M5 7.5L10 12.5L15 7.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span>Advanced: Washing Techniques (Optional)</span>
            </button>

            <div class="wash-techniques-section__content" id="washTechniquesContent" style="display: none;">

              {%- comment -%} 5 Visual Cards {%- endcomment -%}
              <div class="wash-technique-cards">
                <button type="button" class="wash-technique-card" data-technique="pigment-dye" data-action="select-wash-technique">
                  <div class="wash-technique-card__icon">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                      <circle cx="16" cy="16" r="12" stroke="currentColor" stroke-width="2"/>
                      <path d="M16 8v16M8 16h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                  </div>
                  <h4 class="wash-technique-card__title">Pigment Dye</h4>
                  <p class="wash-technique-card__timeline">+2 weeks</p>
                </button>

                <button type="button" class="wash-technique-card" data-technique="fade-out" data-action="select-wash-technique">
                  <div class="wash-technique-card__icon">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                      <path d="M6 16h20M6 10h20M6 22h20" stroke="currentColor" stroke-width="2" stroke-linecap="round" opacity="0.3"/>
                      <path d="M6 16h20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                  </div>
                  <h4 class="wash-technique-card__title">Fade-out Wash</h4>
                  <p class="wash-technique-card__timeline">+3 weeks</p>
                </button>

                <button type="button" class="wash-technique-card" data-technique="stone-wash" data-action="select-wash-technique">
                  <div class="wash-technique-card__icon">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                      <circle cx="16" cy="16" r="10" stroke="currentColor" stroke-width="2" stroke-dasharray="4 2"/>
                    </svg>
                  </div>
                  <h4 class="wash-technique-card__title">Stone Wash</h4>
                  <p class="wash-technique-card__timeline">+2 weeks</p>
                </button>

                <button type="button" class="wash-technique-card" data-technique="tie-dye" data-action="select-wash-technique">
                  <div class="wash-technique-card__icon">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                      <circle cx="16" cy="16" r="4" stroke="currentColor" stroke-width="2"/>
                      <circle cx="16" cy="16" r="8" stroke="currentColor" stroke-width="2" opacity="0.5"/>
                      <circle cx="16" cy="16" r="12" stroke="currentColor" stroke-width="2" opacity="0.3"/>
                    </svg>
                  </div>
                  <h4 class="wash-technique-card__title">Tie Dye</h4>
                  <p class="wash-technique-card__timeline">+4 weeks</p>
                </button>

                <button type="button" class="wash-technique-card" data-technique="ice-dye" data-action="select-wash-technique">
                  <div class="wash-technique-card__icon">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                      <path d="M16 6v20M6 16h20M10 10l12 12M10 22l12-12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                  </div>
                  <h4 class="wash-technique-card__title">Ice Dye</h4>
                  <p class="wash-technique-card__timeline">+4 weeks</p>
                </button>
              </div>

              {%- comment -%} Color Discrepancy Warning (shows for Fade-out/Tie/Ice) {%- endcomment -%}
              <div class="wash-warning" id="washColorWarning" style="display: none;">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                  <path d="M10 6v4m0 4h.01M10 18a8 8 0 100-16 8 8 0 000 16z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
                <p>This technique has <strong>10-15% color discrepancy</strong> — final color will vary slightly from the swatch</p>
              </div>

              {%- comment -%} 4-Button Guide {%- endcomment -%}
              <div class="wash-guide">
                <h4 class="wash-guide__title">Learn About Each Technique:</h4>
                <div class="wash-guide__buttons">
                  <button type="button" class="wash-guide__btn" data-guide="pigment-dye" data-action="select-wash-guide">Pigment Dye</button>
                  <button type="button" class="wash-guide__btn" data-guide="fade-out" data-action="select-wash-guide">Fade-out</button>
                  <button type="button" class="wash-guide__btn" data-guide="stone" data-action="select-wash-guide">Stone</button>
                  <button type="button" class="wash-guide__btn" data-guide="tie-ice" data-action="select-wash-guide">Tie/Ice</button>
                </div>
                <div class="wash-guide__description" id="washGuideDescription">
                  <p>Select a technique above to learn more about the process, timeline, and requirements.</p>
                </div>
              </div>

            </div>
          </div>

        </div>

        {%- comment -%} Cart Preview (syncs with main page) {%- endcomment -%}
        <div class="modal-cart-preview">
          <h3 class="modal-collection-title">Your Lab Dip Cart</h3>
          <p class="modal-collection-description">Swatches for approval (€25.00 each)</p>

          {%- comment -%} Empty State {%- endcomment -%}
          <div class="modal-cart-empty" id="modalCartEmpty" style="display: flex;">
            <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect x="12" y="12" width="24" height="24" rx="3" stroke="currentColor" stroke-width="2" fill="none"/>
              <path d="M24 18V30M18 24H30" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <p class="modal-cart-empty__text">No swatches yet</p>
            <p class="modal-cart-empty__hint">Add colors to build your swatch order</p>
          </div>

          {%- comment -%} Cart Items (populated by JS from Step3B.labDipCart) {%- endcomment -%}
          <div class="modal-cart-items" id="modalCartItems" style="display: none;">
            {%- comment -%} Populated by JavaScript {%- endcomment -%}
          </div>

          <div class="modal-cart-total" id="modalCartTotal">
            Total: 0 swatches (€0.00)
          </div>
        </div>

      </div>

    </div>

    {%- comment -%} Modal Footer {%- endcomment -%}
    <div class="color-studio-modal__footer">
      <button type="button" class="button-secondary" data-action="close-color-studio-modal">
        Cancel
      </button>
      <button type="button" class="button-primary" data-action="done-color-studio-modal" id="modalDoneButton">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M5 10L8 13L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span id="modalDoneText">Done - 0 Colors in Cart</span>
      </button>
    </div>

  </div>

</div>

<script>
  // Inject Pantone JSON URL from Liquid to JavaScript
  window.TECHPACK_V11_PANTONE_URL = "{{ 'pantone-colors.json' | asset_url }}";
</script>
