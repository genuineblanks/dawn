{% comment %}
Tech-Pack Step 3: Garment Specifications Section
{% endcomment %}

{{ 'techpack-unified-styles.css' | asset_url | stylesheet_tag }}

<section id="techpack-step-3" class="techpack-step" data-step="3" style="display: none;">
  <div class="techpack-container">
    <div class="techpack-progress">
      <div class="techpack-progress__bar">
        <div class="techpack-progress__fill" style="width: 75%"></div>
      </div>
      <div class="techpack-progress__steps">
        <div class="techpack-progress__step techpack-progress__step--completed">
          <div class="techpack-progress__step-circle techpack-progress__step-circle--completed">✓</div>
          <div class="techpack-progress__step-label">Client Info</div>
        </div>
        <div class="techpack-progress__step techpack-progress__step--completed">
          <div class="techpack-progress__step-circle techpack-progress__step-circle--completed">✓</div>
          <div class="techpack-progress__step-label">File Upload</div>
        </div>
        <div class="techpack-progress__step techpack-progress__step--active">
          <div class="techpack-progress__step-circle techpack-progress__step-circle--active">3</div>
          <div class="techpack-progress__step-label">Garment Details</div>
        </div>
        <div class="techpack-progress__step">
          <div class="techpack-progress__step-circle">4</div>
          <div class="techpack-progress__step-label">Review</div>
        </div>
      </div>
    </div>

    <div class="techpack-content">
      <h2 class="techpack-title">Garment Specifications</h2>
      <p class="techpack-subtitle" id="step-3-subtitle">Define your garment details and quantity requirements</p>

      <div class="techpack-quantity-tracker">
        <div class="techpack-quantity-tracker__content">
          <span class="techpack-quantity-tracker__label">Total Quantity:</span>
          <span class="techpack-quantity-tracker__value" id="total-quantity">0</span>
          <span class="techpack-quantity-tracker__minimum">
            / <span id="min-text">75 minimum</span>
          </span>
        </div>
        <div class="techpack-quantity-tracker__bar">
          <div class="techpack-quantity-tracker__fill" id="quantity-progress" style="width: 0%"></div>
        </div>
      </div>

      <div class="techpack-garments" id="garments-container">
        <!-- Garments will be dynamically added here -->
      </div>

      <button type="button" class="techpack-btn techpack-btn--secondary techpack-btn--add-garment" id="add-garment">
        <svg class="techpack-btn__icon" width="16" height="16" viewBox="0 0 16 16">
          <path d="M8 2v12m-6-6h12" stroke="currentColor" stroke-width="2"/>
        </svg>
        Add Garment
      </button>

      <div class="techpack-form__actions">
        <button type="button" class="techpack-btn techpack-btn--ghost" id="step-3-prev">
          <svg class="techpack-btn__icon techpack-btn__icon--left" width="16" height="16" viewBox="0 0 16 16">
            <path d="M10 4L6 8l4 4" stroke="currentColor" stroke-width="2" fill="none"/>
          </svg>
          Previous
        </button>
        <button type="button" class="techpack-btn techpack-btn--primary" id="step-3-next" disabled>
          Next Step
          <svg class="techpack-btn__icon" width="16" height="16" viewBox="0 0 16 16">
            <path d="M6 12l4-4-4-4" stroke="currentColor" stroke-width="2" fill="none"/>
          </svg>
        </button>
      </div>
    </div>
  </div>
</section>

<!-- Garment Template -->
<template id="garment-template">
  <div class="techpack-garment" data-garment-id="">
    <div class="techpack-garment__header">
      <h3 class="techpack-garment__title">Garment <span class="techpack-garment__number"></span></h3>
      <button type="button" class="techpack-garment__remove" aria-label="Remove garment">
        <svg width="16" height="16" viewBox="0 0 16 16">
          <path d="M12 4L4 12m0-8l8 8" stroke="currentColor" stroke-width="2"/>
        </svg>
      </button>
    </div>

    <div class="techpack-garment__content">
      <div class="techpack-form__row">
        <div class="techpack-form__group techpack-form__group--required">
          <label class="techpack-form__label">Garment Type</label>
          <select class="techpack-form__select" name="garmentType" required>
            <option value="">Select garment type...</option>
            <option value="Zip-Up Hoodie">Zip-Up Hoodie</option>
            <option value="Hoodie">Hoodie</option>
            <option value="T-Shirt">T-Shirt</option>
            <option value="Sweatshirt">Sweatshirt</option>
            <option value="Sweatpants">Sweatpants</option>
            <option value="Shorts">Shorts</option>
            <option value="Long Sleeve T-Shirt">Long Sleeve T-Shirt</option>
            <option value="Shirt">Shirt</option>
            <option value="Polo Shirt">Polo Shirt</option>
            <option value="Tank Top">Tank Top</option>
            <option value="Hat/Cap">Hat/Cap</option>
            <option value="Beanie">Beanie</option>
            <option value="Other">Other (Specify in Notes)</option>
          </select>
          <div class="techpack-form__error" role="alert"></div>
        </div>

        <div class="techpack-form__group techpack-form__group--required">
          <label class="techpack-form__label">Fabric Type</label>
          <select class="techpack-form__select" name="fabricType" required>
            <option value="" selected>Select fabric type...</option>
            <!-- Fabric options will be populated dynamically based on garment type -->
          </select>
          <div class="techpack-form__error" role="alert"></div>
        </div>
      </div>

      <div class="techpack-form__group techpack-form__group--required">
        <label class="techpack-form__label">Printing Methods (Select at least one) *</label>
        <div class="techpack-form__checkboxes techpack-form__checkboxes--compact">
          <label class="techpack-form__checkbox">
            <input type="checkbox" name="printingMethods[]" value="None">
            <span class="techpack-form__checkbox-mark"></span>
            None
          </label>
          <label class="techpack-form__checkbox">
            <input type="checkbox" name="printingMethods[]" value="Embroidery">
            <span class="techpack-form__checkbox-mark"></span>
            Embroidery
          </label>
          <label class="techpack-form__checkbox">
            <input type="checkbox" name="printingMethods[]" value="Screen Print">
            <span class="techpack-form__checkbox-mark"></span>
            Screen Print
          </label>
          <label class="techpack-form__checkbox">
            <input type="checkbox" name="printingMethods[]" value="Digital Print">
            <span class="techpack-form__checkbox-mark"></span>
            Digital Print
          </label>
          <label class="techpack-form__checkbox">
            <input type="checkbox" name="printingMethods[]" value="Other">
            <span class="techpack-form__checkbox-mark"></span>
            Other
          </label>
        </div>
        <div class="techpack-form__error" role="alert"></div>
      </div>

      <!-- Sample Options for this Garment (shown only for sample requests) -->
      <div class="techpack-garment-samples" data-sample-request-only="true" style="display: none;">
        <!-- Section A: Choose Your Sample Type -->
        <div class="techpack-sample-type-selection">
          <h4 class="techpack-section-title">Choose Your Sample Type</h4>
          
          <!-- A1: Stock Fabric Color -->
          <div class="techpack-sample-card" data-sample-type="stock">
            <div class="techpack-sample-card-header">
              <input type="radio" name="garment-sample-type" value="stock" id="sample-stock" class="techpack-sample-radio">
              <label for="sample-stock" class="techpack-sample-card-label">
                <h5 class="techpack-sample-card-title">Garment in Stock Fabric Color (Fastest)</h5>
                <div class="techpack-sample-meta">~1–2 weeks · €35</div>
                <p class="techpack-sample-description">Validate fit, sizing, stitching using in-stock colors.</p>
                <div class="techpack-sample-subtitle" id="stock-subtitle">Choose from available stock colors for faster turnaround.</div>
              </label>
            </div>
            
            <!-- Stock color options (shown when selected) -->
            <div class="techpack-sample-options" style="display: none;">
              <div class="techpack-fabric-colors">
                <label class="techpack-fabric-color-option">
                  <input type="radio" name="stock-fabric-color" value="black" id="stock-black">
                  <span class="techpack-radio-mark"></span>
                  Black (in-stock)
                </label>
                
                <label class="techpack-fabric-color-option">
                  <input type="radio" name="stock-fabric-color" value="off-white" id="stock-off-white">
                  <span class="techpack-radio-mark"></span>
                  Off-White / Natural (in-stock)
                </label>
                
                <label class="techpack-fabric-color-option">
                  <input type="radio" name="stock-fabric-color" value="random" id="stock-random">
                  <span class="techpack-radio-mark"></span>
                  Random Stock Color (we choose)
                </label>
              </div>
              <div class="techpack-sample-note">
                <svg width="16" height="16" viewBox="0 0 16 16">
                  <circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="1.5" fill="none"/>
                  <path d="M8 5v3" stroke="currentColor" stroke-width="1.5"/>
                  <circle cx="8" cy="11" r="1" fill="currentColor"/>
                </svg>
                Best for speed. You can add Lab Dips in Section B at any time.
              </div>
            </div>
          </div>
          
          <!-- A2: Custom Color -->
          <div class="techpack-sample-card" data-sample-type="custom">
            <div class="techpack-sample-card-header">
              <input type="radio" name="garment-sample-type" value="custom" id="sample-custom" class="techpack-sample-radio">
              <label for="sample-custom" class="techpack-sample-card-label">
                <h5 class="techpack-sample-card-title">Garment in Your Custom Color (Dyed to Pantone)</h5>
                <div class="techpack-sample-meta">~3 weeks · €65</div>
                <p class="techpack-sample-description">Your garment in your exact Pantone shade (requires a Lab Dip to be selected).</p>
                <div class="techpack-sample-subtitle">Requires a Lab Dip (select in Section B).</div>
              </label>
            </div>
            
            <!-- Custom color options (shown when selected) -->
            <div class="techpack-sample-options" style="display: none;">
              <div class="techpack-form__group">
                <label class="techpack-form__label">Select Lab Dip to Use</label>
                <select name="selected-lab-dip" id="selected-lab-dip" class="techpack-form__select" disabled>
                  <option value="">No Lab Dips available - add one below</option>
                </select>
                <div class="techpack-form__error" role="alert"></div>
              </div>
              
              <div class="techpack-sample-warning" id="lab-dip-warning">
                <svg width="16" height="16" viewBox="0 0 16 16">
                  <path d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" fill="currentColor"/>
                </svg>
                Requires a Lab Dip. Add one in Section B, then select it here.
              </div>
              
              <div class="techpack-form__group">
                <label class="techpack-form__label">Or enter Pantone to prefill a Lab Dip</label>
                <input type="text" name="pantone-prefill" id="pantone-prefill" class="techpack-form__input" placeholder="Enter Pantone TCX (e.g., 18-3949 TPX)">
              </div>
            </div>
          </div>
        </div>

        <!-- Section B: Lab Dip Swatches -->
        <div class="techpack-lab-dips-section">
          <h4 class="techpack-section-title">
            Lab Dip Swatches 
            <span class="techpack-optional">(Optional — can be added with any sample type)</span>
          </h4>
          <div class="techpack-lab-dip-meta">Made in parallel · €25 each</div>
          <p class="techpack-section-description">A small fabric swatch dyed to your Pantone to confirm color accuracy before dyeing a garment or bulk.</p>
          
          <div class="techpack-lab-dip-form">
            <div class="techpack-form__group">
              <input type="text" id="new-lab-dip-pantone" class="techpack-form__input" placeholder="Enter Pantone TCX (e.g., 18-3949 TPX)">
              <button type="button" id="add-lab-dip" class="techpack-btn techpack-btn--secondary">
                <svg width="14" height="14" viewBox="0 0 16 16">
                  <path d="M8 2v12m-6-6h12" stroke="currentColor" stroke-width="2"/>
                </svg>
                + Add Lab Dip (+€25)
              </button>
            </div>
          </div>
          
          <div class="techpack-lab-dip-list" id="lab-dip-list">
            <!-- Lab dips will be added here dynamically -->
            <div class="techpack-lab-dip-empty" id="lab-dip-empty">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                <circle cx="12" cy="12" r="3"/>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
              </svg>
              <p>No Lab Dips added yet</p>
              <span>Lab Dips help confirm your Pantone colors before production</span>
            </div>
          </div>
        </div>

        <!-- Section C: Techpack Info Check -->
        <div class="techpack-info-check">
          <h4 class="techpack-section-title">Garment Info Provided in Techpack</h4>
          <div class="techpack-checkboxes">
            <label class="techpack-checkbox-option">
              <input type="checkbox" name="colorway-in-techpack">
              <span class="techpack-checkbox-mark"></span>
              Colorway is already included in the techpack
            </label>
            
            <label class="techpack-checkbox-option">
              <input type="checkbox" name="sizing-in-techpack">
              <span class="techpack-checkbox-mark"></span>
              Sizing/custom measurements are defined in the techpack
            </label>
            
            <label class="techpack-checkbox-option">
              <input type="checkbox" name="need-sizing-help">
              <span class="techpack-checkbox-mark"></span>
              I need help with sizing or fit adjustments
            </label>
          </div>
        </div>

        <!-- Guidance Banner -->
        <div class="techpack-guidance-banner">
          <div class="techpack-guidance-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
              <circle cx="12" cy="18" r="1"/>
            </svg>
          </div>
          <div class="techpack-guidance-content">
            <h5 class="techpack-guidance-title">Recommended path:</h5>
            <p>Stock-Color Garment to check fit fast → Add Lab Dip(s) to lock your Pantone → Custom-Dyed Garment for exact final look.</p>
          </div>
        </div>
      </div>

      <div class="techpack-colorways">
        <div class="techpack-colorways__header">
          <h4 class="techpack-colorways__title">Colorways</h4>
          <button type="button" class="techpack-btn techpack-btn--small techpack-btn--secondary add-colorway">
            <svg class="techpack-btn__icon" width="14" height="14" viewBox="0 0 16 16">
              <path d="M8 2v12m-6-6h12" stroke="currentColor" stroke-width="2"/>
            </svg>
            Add Colorway
          </button>
        </div>
        <div class="techpack-colorways__list">
          <!-- Colorways will be added here -->
        </div>
      </div>


      <div class="techpack-garment__total" data-bulk-request-only="true" style="display: none;">
        <span class="techpack-garment__total-label">Garment Total:</span>
        <span class="techpack-garment__total-value">0</span>
      </div>
    </div>
  </div>
</template>

<!-- Colorway Template -->
<template id="colorway-template">
  <div class="techpack-colorway" data-colorway-id="">
    <!-- Perfect Single Line Layout: Color → Sample → Pantone → X -->
    <div class="techpack-colorway__header-line">
      <!-- Column 1: Color Picker -->
      <div class="techpack-colorway__color">
        <label class="techpack-form__label">Color</label>
        <input type="color" class="techpack-color-picker__input" value="#000000" data-color-picker>
      </div>
      
      <!-- Column 3: Pantone Options (Takes remaining space) -->
      <div class="techpack-colorway__pantone">
        <label class="techpack-form__label">
          PANTONE Options <span class="techpack-form__required">*</span>
        </label>
        <div class="techpack-pantone-buttons" style="display: none;">
          <div class="techpack-pantone-grid">
            <button type="button" class="techpack-btn techpack-btn--pantone-compact" data-pantone-index="0" data-pantone-code="" data-pantone-hex="" style="--pantone-hex: #000000;">
              <div class="techpack-pantone-circle" style="background-color: var(--pantone-hex)"></div>
              <span class="techpack-pantone-text">Select color</span>
              <div class="techpack-pantone-radio"></div>
            </button>
            <button type="button" class="techpack-btn techpack-btn--pantone-compact" data-pantone-index="1" data-pantone-code="" data-pantone-hex="" style="--pantone-hex: #000000;">
              <div class="techpack-pantone-circle" style="background-color: var(--pantone-hex)"></div>
              <span class="techpack-pantone-text">Select color</span>
              <div class="techpack-pantone-radio"></div>
            </button>
          </div>
        </div>
        <div class="techpack-pantone-validation-message" style="display: none;"></div>
      </div>
      
      <!-- Column 4: Remove Button (Original position) -->
      <button type="button" class="techpack-colorway__remove" aria-label="Remove colorway">
        <svg width="16" height="16" viewBox="0 0 16 16">
          <path d="M12 4L4 12m0-8l8 8" stroke="currentColor" stroke-width="2"/>
        </svg>
      </button>
    </div>

    <div class="techpack-size-grid" style="display: none;" data-requires-pantone="true">
      <div class="techpack-size-grid__header">
        <div class="techpack-size-grid__label">Size</div>
        <div class="techpack-size-grid__label">XXS</div>
        <div class="techpack-size-grid__label">XS</div>
        <div class="techpack-size-grid__label">S</div>
        <div class="techpack-size-grid__label">M</div>
        <div class="techpack-size-grid__label">L</div>
        <div class="techpack-size-grid__label">XL</div>
        <div class="techpack-size-grid__label">XXL</div>
      </div>
      <div class="techpack-size-grid__row">
        <div class="techpack-size-grid__label">Qty</div>
        <input type="number" class="techpack-size-grid__input" name="qty-xxs" min="0" value="0" data-size="xxs">
        <input type="number" class="techpack-size-grid__input" name="qty-xs" min="0" value="0" data-size="xs">
        <input type="number" class="techpack-size-grid__input" name="qty-s" min="0" value="0" data-size="s">
        <input type="number" class="techpack-size-grid__input" name="qty-m" min="0" value="0" data-size="m">
        <input type="number" class="techpack-size-grid__input" name="qty-l" min="0" value="0" data-size="l">
        <input type="number" class="techpack-size-grid__input" name="qty-xl" min="0" value="0" data-size="xl">
        <input type="number" class="techpack-size-grid__input" name="qty-xxl" min="0" value="0" data-size="xxl">
      </div>
    </div>

    <div class="techpack-colorway__total">
      <span class="techpack-colorway__total-label">Colorway Total:</span>
      <span class="techpack-colorway__total-value">0</span>
    </div>
  </div>
</template>

<!-- Lab Dip Template -->
<template id="lab-dip-template">
  <div class="techpack-lab-dip-item" data-lab-dip-id="">
    <div class="techpack-lab-dip-item__content">
      <div class="techpack-form__group">
        <label class="techpack-form__label">Pantone TCX Code</label>
        <input 
          type="text" 
          class="techpack-form__input techpack-lab-dip-pantone" 
          placeholder="e.g., 18-3949 TPX"
          data-validate="pantone"
        >
        <div class="techpack-form__error" role="alert"></div>
      </div>
      
      <div class="techpack-form__group">
        <label class="techpack-form__label">Color Preview</label>
        <div class="techpack-lab-dip-color-preview">
          <input type="color" class="techpack-color-picker__input techpack-lab-dip-color" value="#000000">
          <span class="techpack-lab-dip-color-text">Click to select color</span>
        </div>
      </div>
      
      <div class="techpack-lab-dip-cost">
        <span class="techpack-lab-dip-cost-label">Cost:</span>
        <span class="techpack-lab-dip-cost-value">€25</span>
      </div>
      
      <button type="button" class="techpack-lab-dip-remove" aria-label="Remove lab dip">
        <svg width="16" height="16" viewBox="0 0 16 16">
          <path d="M12 4L4 12m0-8l8 8" stroke="currentColor" stroke-width="2"/>
        </svg>
      </button>
    </div>
  </div>
</template>

{% schema %}
{
  "name": "Tech-Pack Step 3",
  "settings": [
    {
      "type": "header",
      "content": "Garment Specifications Step"
    },
    {
      "type": "text",
      "id": "step_title",
      "label": "Step Title",
      "default": "Garment Specifications"
    },
    {
      "type": "text",
      "id": "step_subtitle",
      "label": "Step Subtitle",
      "default": "Define your garment details and quantity requirements"
    },
    {
      "type": "number",
      "id": "minimum_quantity",
      "label": "Minimum Total Quantity",
      "default": 75
    }
  ],
  "presets": [
    {
      "name": "Tech-Pack Step 3"
    }
  ]
}
{% endschema %}

<!-- Educational Tooltip for Per-Garment Samples -->
<div class="techpack-tooltips">
  <div class="techpack-tooltip" id="tooltip-garment-samples" style="display: none;">
    <div class="techpack-tooltip__content">
      <h5 class="techpack-tooltip__title">Per-Garment Sample Options</h5>
      <p>For sample requests, you can choose different sample types for each garment:</p>
      <ul>
        <li><strong>Black/Raw Sample:</strong> Quick fit and construction validation using stock fabric</li>
        <li><strong>Lab Dip:</strong> Color swatch to confirm Pantone accuracy before production</li>
        <li><strong>Custom Color Sample:</strong> Full garment in your exact color (requires lab dip first)</li>
      </ul>
      <div class="techpack-tooltip__highlight">
        <strong>💡 Pro tip:</strong> Mix and match options - get a black sample for quick fit validation while waiting for your custom color sample!
      </div>
    </div>
  </div>
</div>