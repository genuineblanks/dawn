{% comment %}
  V10 Wholesale Customer Dashboard - UPGRADED
  Premium design with Orders, Files, and Email modules
{% endcomment %}

{%- assign access_code = customer.metafields.custom.access_code | default: 'PENDING' -%}
{%- assign company_name = customer.metafields.custom.company_name | default: customer.first_name -%}
{%- assign submissions_summary = customer.metafields.custom.submissions_summary -%}

{% comment %} Parse submissions summary JSON (if exists) {% endcomment %}
{%- if submissions_summary -%}
  {%- assign summary = submissions_summary -%}
{%- else -%}
  {%- assign summary = '{"total":0,"pending":0,"in_production":0,"completed":0,"recent":[]}' | parse_json -%}
{%- endif -%}

<div class="v10-wholesale-dashboard" id="v10-wholesale-dashboard" data-customer-email="{{ customer.email }}" data-customer-name="{{ customer.first_name }} {{ customer.last_name }}" data-has-submissions="{{ summary.total }}">

  <!-- Welcome Section with Access Code -->
  <div class="v10-dashboard-welcome">
    <div class="v10-welcome-content">
      <h2 class="v10-welcome-title">Welcome back, {{ company_name }}!</h2>
      <p class="v10-welcome-subtitle">Manage your garment development projects</p>
    </div>
    <div class="v10-access-code-card">
      <div class="v10-access-code-label">Your Access Code</div>
      <div class="v10-access-code-value">{{ access_code }}</div>
      <div class="v10-access-code-hint">Use this code for new submissions</div>
    </div>
  </div>

  <!-- View Navigation Tabs -->
  <div class="v10-view-tabs">
    <button class="v10-view-tab active" data-view="dashboard">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="3" width="7" height="7"></rect>
        <rect x="14" y="3" width="7" height="7"></rect>
        <rect x="14" y="14" width="7" height="7"></rect>
        <rect x="3" y="14" width="7" height="7"></rect>
      </svg>
      Dashboard
    </button>
    <button class="v10-view-tab" data-view="orders">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"></path>
        <polyline points="3.29 7 12 12 20.71 7"></polyline>
        <line x1="12" y1="22" x2="12" y2="12"></line>
      </svg>
      Orders
    </button>
    <button class="v10-view-tab" data-view="files">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
      </svg>
      Files
    </button>
    <button class="v10-view-tab" data-view="email">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="2" y="4" width="20" height="16" rx="2"></rect>
        <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path>
      </svg>
      Email
    </button>
  </div>

  <!-- DASHBOARD HOME VIEW -->
  <div class="v10-view-content" id="view-dashboard">

    <!-- Module Cards -->
    <div class="v10-module-cards">
      <button class="v10-module-card" data-navigate="orders">
        <div class="v10-module-icon">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"></path>
            <polyline points="3.29 7 12 12 20.71 7"></polyline>
            <line x1="12" y1="22" x2="12" y2="12"></line>
          </svg>
        </div>
        <h3 class="v10-module-title">ORDERS</h3>
        <p class="v10-module-description">View & manage all submissions</p>
        <span class="v10-module-cta">View All →</span>
      </button>

      <button class="v10-module-card" data-navigate="files">
        <div class="v10-module-icon">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
          </svg>
        </div>
        <h3 class="v10-module-title">FILES</h3>
        <p class="v10-module-description">Upload reworked files</p>
        <span class="v10-module-cta">Upload →</span>
      </button>

      <button class="v10-module-card" data-navigate="email">
        <div class="v10-module-icon">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="2" y="4" width="20" height="16" rx="2"></rect>
            <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path>
          </svg>
        </div>
        <h3 class="v10-module-title">EMAIL</h3>
        <p class="v10-module-description">Contact support</p>
        <span class="v10-module-cta">Send Message →</span>
      </button>
    </div>

    <!-- Recent Orders -->
    <div class="v10-recent-section">
      <h2 class="v10-section-title">YOUR RECENT ORDERS</h2>
      <div class="v10-recent-orders-grid" id="recent-orders-grid">
        <div class="v10-loading-state">
          <div class="v10-spinner"></div>
          <p>Loading recent orders...</p>
        </div>
      </div>
      <button class="v10-view-all-btn" data-navigate="orders">VIEW ALL ORDERS →</button>
    </div>

    <!-- Quick Action -->
    <div class="v10-quick-actions">
      <a href="/pages/tech-pack-submission" class="v10-action-card v10-action-primary">
        <div class="v10-action-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 5v14M5 12h14"/>
          </svg>
        </div>
        <div class="v10-action-content">
          <h3>New Submission</h3>
          <p>Start a new garment development project</p>
        </div>
        <div class="v10-action-arrow">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
        </div>
      </a>
    </div>

  </div>

  <!-- ORDERS VIEW -->
  <div class="v10-view-content" id="view-orders" style="display: none;">

    <h2 class="v10-section-title">YOUR ORDERS</h2>

    <!-- Filters Container -->
    <div class="v10-filters-container">
      <!-- Type Filters -->
      <div class="v10-type-filters" id="v10-filter-tabs">
        <button class="v10-filter-tab active" data-filter="all">
          All
          <span class="v10-tab-count" id="count-all">0</span>
        </button>
        <button class="v10-filter-tab" data-filter="quotation">
          Quotations
          <span class="v10-tab-count" id="count-quotation">0</span>
        </button>
        <button class="v10-filter-tab" data-filter="sample-request">
          Samples
          <span class="v10-tab-count" id="count-sample">0</span>
        </button>
        <button class="v10-filter-tab" data-filter="bulk-order-request">
          Bulk Orders
          <span class="v10-tab-count" id="count-bulk">0</span>
        </button>
      </div>

      <!-- Status Filters -->
      <div class="v10-status-filters">
        <button class="v10-status-filter-tab active" data-status-filter="pending">
          Pending
        </button>
        <button class="v10-status-filter-tab" data-status-filter="in_progress">
          In Progress
        </button>
        <button class="v10-status-filter-tab" data-status-filter="completed">
          Completed
        </button>
      </div>
    </div>

    <!-- Loading State -->
    <div class="v10-loading-state" id="v10-loading-state">
      <div class="v10-spinner"></div>
      <p>Loading your submissions...</p>
    </div>

    <!-- Empty State -->
    <div class="v10-empty-state" id="v10-empty-state" style="display: none;">
      <div class="v10-empty-icon">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
        </svg>
      </div>
      <h3>No submissions yet</h3>
      <p>Start your first garment development project by creating a new submission</p>
      <a href="/pages/tech-pack-submission" class="v10-btn-primary">
        Create First Submission
      </a>
    </div>

    <!-- Submissions Grid -->
    <div class="v10-submissions-grid" id="v10-submissions-grid">
      <!-- Submissions will be loaded here via JavaScript -->
    </div>

  </div>

  <!-- FILES VIEW -->
  <div class="v10-view-content" id="view-files" style="display: none;">

    <h2 class="v10-section-title">FILE MANAGER</h2>
    <p class="v10-section-subtitle">Upload new or reworked files to existing orders</p>

    <div class="v10-files-container">

      <!-- Order Selection -->
      <div class="v10-form-group">
        <label class="v10-form-label">SELECT ORDER</label>
        <select id="file-order-select" class="v10-form-select">
          <option value="">Loading orders...</option>
        </select>
      </div>

      <!-- Current Files -->
      <div class="v10-form-group">
        <label class="v10-form-label">CURRENT FILES</label>
        <div id="current-files-list" class="v10-files-list">
          <p class="v10-placeholder-text">Select an order to view files</p>
        </div>
      </div>

      <!-- Upload Zone -->
      <div class="v10-form-group">
        <label class="v10-form-label">UPLOAD NEW FILE</label>
        <div id="upload-zone" class="v10-upload-zone">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="17 8 12 3 7 8"></polyline>
            <line x1="12" y1="3" x2="12" y2="15"></line>
          </svg>
          <p class="v10-upload-text">Click to upload or drag and drop</p>
          <p class="v10-upload-subtext">PDF, JPG, PNG up to 10MB</p>
          <input type="file" id="file-input" accept=".pdf,.jpg,.jpeg,.png" style="display: none;">
        </div>
      </div>

      <!-- File Preview -->
      <div id="file-preview-section" class="v10-form-group" style="display: none;">
        <label class="v10-form-label">FILE PREVIEW</label>
        <div class="v10-file-preview">
          <p class="v10-preview-label">Original filename:</p>
          <p class="v10-preview-value" id="preview-original"></p>
          <p class="v10-preview-label">New filename (with versioning):</p>
          <p class="v10-preview-value v10-preview-new" id="preview-new"></p>
          <div class="v10-button-group">
            <button id="upload-file-btn" class="v10-btn-primary">UPLOAD FILE</button>
            <button id="cancel-upload-btn" class="v10-btn-secondary">CANCEL</button>
          </div>
        </div>
      </div>

      <!-- Upload Status -->
      <div id="upload-status" class="v10-status-message" style="display: none;"></div>

    </div>

  </div>

  <!-- EMAIL VIEW -->
  <div class="v10-view-content" id="view-email" style="display: none;">

    <h2 class="v10-section-title">CONTACT SUPPORT</h2>
    <p class="v10-section-subtitle">Send a message about your orders</p>

    <div class="v10-email-container">

      <!-- Order Selection -->
      <div class="v10-form-group">
        <label class="v10-form-label">SELECT ORDER (OPTIONAL)</label>
        <select id="email-order-select" class="v10-form-select">
          <option value="">Loading orders...</option>
        </select>
        <p class="v10-form-hint">Select an order to include its details in your message</p>
      </div>

      <!-- Template Selection -->
      <div class="v10-form-group">
        <label class="v10-form-label">MESSAGE TEMPLATE</label>
        <select id="email-template-select" class="v10-form-select">
          <option value="">Select a template (optional)</option>
          <option value="help">General Help</option>
          <option value="changes">Request Changes</option>
          <option value="delivery">Delivery Question</option>
          <option value="custom">Custom Message</option>
        </select>
      </div>

      <!-- Message -->
      <div class="v10-form-group">
        <label class="v10-form-label">YOUR MESSAGE</label>
        <textarea id="email-message" class="v10-form-textarea" rows="10" placeholder="Write your message here..."></textarea>
        <p class="v10-form-hint">Your email ({{ customer.email }}) will be included for replies</p>
      </div>

      <!-- Actions -->
      <div class="v10-button-group">
        <button id="send-email-btn" class="v10-btn-primary">SEND MESSAGE</button>
        <button class="v10-btn-secondary" data-navigate="dashboard">CANCEL</button>
      </div>

      <!-- Email Status -->
      <div id="email-status" class="v10-status-message" style="display: none;"></div>

      <!-- Contact Info -->
      <div class="v10-contact-info">
        <h3 class="v10-contact-title">OTHER WAYS TO REACH US</h3>
        <div class="v10-contact-grid">
          <div class="v10-contact-item">
            <strong>Email:</strong> office@genuineblanks.com
          </div>
          <div class="v10-contact-item">
            <strong>Phone:</strong> Available on request
          </div>
          <div class="v10-contact-item">
            <strong>Hours:</strong> Monday - Friday, 9:00 AM - 6:00 PM CET
          </div>
        </div>
      </div>

    </div>

  </div>

</div>

<!-- Submission Details Modal -->
<div class="v10-modal-overlay" id="v10-submission-modal" style="display: none;">
  <div class="v10-modal-container v10-modal-large">
    <div class="v10-modal-header">
      <div>
        <h2 class="v10-modal-title" id="modal-title">Submission Details</h2>
        <p class="v10-modal-subtitle" id="modal-subtitle"></p>
      </div>
      <button type="button" class="v10-modal-close" id="modal-close">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 6L6 18M6 6l12 12"/>
        </svg>
      </button>
    </div>
    <div class="v10-modal-body" id="modal-body">
      <!-- Content will be loaded dynamically -->
    </div>
  </div>
</div>

{% comment %} CSS and JS are loaded in sections/main-account.liquid (lines 9-10) to avoid duplicate loading {% endcomment %}
