{% comment %}
  TechPack V11 - Quotation Step 3: Garment Builder
  Purpose: Add individual garments with detailed specifications
  For: Both new and registered clients
{% endcomment %}

{{ 'techpack-v11-base.css' | asset_url | stylesheet_tag }}
{{ 'techpack-v11-flow.css' | asset_url | stylesheet_tag }}
{{ 'techpack-v11-forms.css' | asset_url | stylesheet_tag }}

<div class="techpack-v11 techpack-flow" data-section-id="{{ section.id }}" data-flow-type="quotation" data-current-step="3">

  {%- comment -%} TEST MODE BANNER {%- endcomment -%}
  <div class="test-mode-banner" id="testModeBanner" style="display: none;">
    <div class="test-mode-banner__content">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <div>
        <strong>TEST MODE ACTIVE</strong>
        <p>2 test garments auto-added for testing.</p>
      </div>
    </div>
  </div>

  {%- comment -%} Progress Header {%- endcomment -%}
  <div class="techpack-progress">
    <div class="techpack-progress__container">
      <button type="button" class="techpack-progress__back" data-action="previous-step">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12.5 15L7.5 10L12.5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Back</span>
      </button>

      <div class="techpack-progress__steps">
        <div class="progress-step progress-step--complete" data-step="1">
          <div class="progress-step__circle">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M13.333 4L6 11.333L2.667 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div class="progress-step__label">Client Info</div>
        </div>
        <div class="progress-step__line"></div>
        <div class="progress-step progress-step--complete" data-step="2">
          <div class="progress-step__circle">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M13.333 4L6 11.333L2.667 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div class="progress-step__label">Files</div>
        </div>
        <div class="progress-step__line"></div>
        <div class="progress-step progress-step--active" data-step="3">
          <div class="progress-step__circle">3</div>
          <div class="progress-step__label">Garments</div>
        </div>
        <div class="progress-step__line"></div>
        <div class="progress-step" data-step="4">
          <div class="progress-step__circle">4</div>
          <div class="progress-step__label">Review</div>
        </div>
      </div>

      <div class="techpack-progress__save">
        <div class="save-indicator" id="saveIndicator">
          <svg class="save-indicator__icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M13.333 4L6 11.333L2.667 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="save-indicator__text">All saved</span>
        </div>
      </div>
    </div>
  </div>

  {%- comment -%} Main Content {%- endcomment -%}
  <div class="techpack-content">
    <div class="techpack-content__container">

      {%- comment -%} Step Header {%- endcomment -%}
      <header class="step-header">
        <div class="step-header__badge">Step 3 of 4</div>
        <h1 class="step-header__title">Build Your Garment List</h1>
        <p class="step-header__description">
          Add each garment variation with its specific fabric, color, and quantity details
        </p>
      </header>

      {%- comment -%} Form Content {%- endcomment -%}
      <form class="step-form" id="quotationStep3Form" data-step="3" data-flow="quotation">

        {%- comment -%} Garment List Section {%- endcomment -%}
        <div class="form-section">
          <div class="section-header">
            <div class="section-header__title-row">
              <h3 class="section-header__title">Garments</h3>
              <span class="garment-count" id="garmentCount">0 garments</span>
            </div>
            <p class="section-header__description">
              Each garment can have unique specifications (fabric, color, quantity)
            </p>
          </div>

          {%- comment -%} Empty State (shown when no garments) {%- endcomment -%}
          <div class="empty-state" id="emptyState">
            <svg class="empty-state__icon" width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M20 26L26 20L32 26L38 20L44 26V58H20V26Z" stroke="currentColor" stroke-width="2" fill="var(--color-surface)"/>
              <path d="M26 20V26M38 20V26M20 32H44" stroke="currentColor" stroke-width="2"/>
            </svg>
            <h4 class="empty-state__title">No garments added yet</h4>
            <p class="empty-state__description">
              Click "Add Garment" to start building your quotation. You can add multiple variations with different fabrics and colors.
            </p>
          </div>

          {%- comment -%} Garment List (populated by JavaScript) {%- endcomment -%}
          <div class="garment-list" id="garmentList" style="display: none;">
            {%- comment -%} Dynamically populated by JavaScript {%- endcomment -%}
          </div>

          {%- comment -%} Add Garment Button {%- endcomment -%}
          <button
            type="button"
            class="button-secondary button-secondary--icon"
            id="addGarmentButton"
            data-action="add-garment"
          >
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 4v12M4 10h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Add Garment
          </button>

        </div>

        {%- comment -%} Garment Form (inline, shows/hides) {%- endcomment -%}
        <div class="garment-form" id="garmentForm" style="display: none;">
          <div class="garment-form__header">
            <h4 class="garment-form__title" id="garmentFormTitle">New Garment</h4>
            <button type="button" class="garment-form__close" data-action="close-garment-form" aria-label="Close form">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </button>
          </div>

          <div class="garment-form__content">

            {%- comment -%} Garment Type {%- endcomment -%}
            <div class="form-field">
              <label for="garmentType" class="form-field__label">
                Garment Type
                <span class="form-field__required">*</span>
              </label>
              <select id="garmentType" name="garment_type" class="form-field__select" required>
                <option value="">Select garment type...</option>
                <option value="T-Shirt">T-Shirt</option>
                <option value="Hoodie">Hoodie</option>
                <option value="Sweatshirt">Sweatshirt</option>
                <option value="Polo Shirt">Polo Shirt</option>
                <option value="Tank Top">Tank Top</option>
                <option value="Long Sleeve">Long Sleeve</option>
                <option value="Shorts">Shorts</option>
                <option value="Joggers">Joggers</option>
                <option value="Zip Hoodie">Zip Hoodie</option>
                <option value="Jacket">Jacket</option>
              </select>
            </div>

            {%- comment -%} Fabric Type {%- endcomment -%}
            <div class="form-field">
              <label for="fabricType" class="form-field__label">
                Fabric Type
                <span class="form-field__required">*</span>
              </label>
              <select id="fabricType" name="fabric_type" class="form-field__select" required>
                <option value="">Select fabric...</option>
                <option value="100% Cotton">100% Cotton</option>
                <option value="70/30 Cotton/Poly">70/30 Cotton/Poly</option>
                <option value="80/20 Cotton/Poly">80/20 Cotton/Poly</option>
                <option value="50/50 Cotton/Poly">50/50 Cotton/Poly</option>
                <option value="100% Organic Cotton">100% Organic Cotton</option>
                <option value="French Terry">French Terry</option>
                <option value="Fleece 320gsm">Fleece 320gsm</option>
                <option value="Brushed Fleece">Brushed Fleece</option>
                <option value="Performance Poly">Performance Poly</option>
              </select>
            </div>

            {%- comment -%} Color/Pantone {%- endcomment -%}
            <div class="form-field">
              <label for="garmentColor" class="form-field__label">
                Color / Pantone
                <span class="form-field__required">*</span>
              </label>
              <input
                type="text"
                id="garmentColor"
                name="garment_color"
                class="form-field__input"
                placeholder="e.g., Navy Blue, PANTONE 19-4052 TCX"
                required
              >
              <p class="form-field__help">
                Enter color name or Pantone code (we'll match it during production)
              </p>
            </div>

            {%- comment -%} Estimated Quantity (Optional) {%- endcomment -%}
            <div class="form-field">
              <label for="garmentQuantity" class="form-field__label">
                Estimated Quantity
                <span class="form-field__optional">(Optional)</span>
              </label>
              <input
                type="number"
                id="garmentQuantity"
                name="garment_quantity"
                class="form-field__input"
                placeholder="e.g., 500"
                min="0"
                step="1"
              >
              <p class="form-field__help">
                Approximate quantity for this specific garment/color combination
              </p>
            </div>

            {%- comment -%} Additional Notes (Optional) {%- endcomment -%}
            <div class="form-field">
              <label for="garmentNotes" class="form-field__label">
                Additional Notes
                <span class="form-field__optional">(Optional)</span>
              </label>
              <textarea
                id="garmentNotes"
                name="garment_notes"
                class="form-field__textarea"
                placeholder="Any special requirements or notes for this garment..."
                rows="3"
              ></textarea>
            </div>

          </div>

          <div class="garment-form__actions">
            <button type="button" class="button-secondary" data-action="close-garment-form">
              Cancel
            </button>
            <button type="button" class="button-primary" id="saveGarmentButton" data-action="save-garment">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M16.667 5L7.5 14.167L3.333 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Save Garment
            </button>
          </div>
        </div>

        {%- comment -%} Info Card {%- endcomment -%}
        <div class="info-card info-card--primary">
          <div class="info-card__icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5"/>
              <path d="M12 16v-4m0-4h.01" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
          </div>
          <div class="info-card__content">
            <h4 class="info-card__title">Multiple variations?</h4>
            <p class="info-card__text">
              Need the same hoodie in different colors? Or same t-shirt in different fabrics? Add each variation as a separate garment. You can use the "Duplicate" button to speed this up!
            </p>
          </div>
        </div>

        {%- comment -%} Form Navigation {%- endcomment -%}
        <div class="form-navigation">
          <button
            type="button"
            class="button-secondary"
            data-action="previous-step"
          >
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12.5 15L7.5 10L12.5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Back to Files
          </button>

          <button
            type="submit"
            class="button-primary"
            data-action="next-step"
            id="continueToReviewButton"
          >
            Continue to Review
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M7.5 15L12.5 10L7.5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>

      </form>

    </div>
  </div>

</div>

<script>
  window.TECHPACK_V11_CUSTOMER = {
    isLoggedIn: {{ customer | json }} !== null
  };
</script>

{% render 'techpack-v11-theme-switcher' %}

<script src="{{ 'techpack-v11-core.js' | asset_url }}" defer></script>
<script src="{{ 'techpack-v11-actions.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "TP V11 Quote Step 3",
  "class": "section-techpack-v11-step",
  "settings": [
    {
      "type": "header",
      "content": "Garment Settings"
    },
    {
      "type": "checkbox",
      "id": "allow_duplicate",
      "label": "Enable Duplicate Button",
      "default": true,
      "info": "Allow users to duplicate garments to speed up adding similar items"
    }
  ],
  "presets": [
    {
      "name": "TechPack V11 - Quotation Step 3"
    }
  ]
}
{% endschema %}
