{% comment %}
  Section: know-my-factory.liquid
  Place this file in the sections folder
  File path: sections/know-my-factory.liquid
{% endcomment %}

<style>
  .factory-section-{{ section.id }} {
    min-height: 100vh;
    position: relative;
    font-family: var(--font-body-family), Arial, sans-serif;
    margin: 0;
    padding: 0;
    background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 50%, #2d2d2d 100%);
    overflow: hidden;
    opacity: 0;
    animation: sectionFadeIn-{{ section.id }} 1.5s ease-out 0.3s forwards;
  }
  
  .factory-section-{{ section.id }}::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(circle at 30% 40%, rgba(255,255,255,0.03) 0%, transparent 50%),
                radial-gradient(circle at 70% 80%, rgba(255,255,255,0.02) 0%, transparent 50%);
    pointer-events: none;
    z-index: 1;
  }
  
  @keyframes sectionFadeIn-{{ section.id }} {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  /* Main Content Wrapper */
  .factory-main-{{ section.id }} {
    position: relative;
    z-index: 2;
    background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%);
  }
  
  /* Filter Navigation */
  .factory-filter-{{ section.id }} {
    padding: 4rem 0 2rem;
    display: flex;
    justify-content: center;
    position: sticky;
    top: 0;
    z-index: 100;
    background: rgba(15, 15, 15, 0.95);
    backdrop-filter: blur(25px);
    -webkit-backdrop-filter: blur(25px);
    border-bottom: 1px solid rgba(255,255,255,0.1);
    opacity: 0;
    animation: filterSlideDown-{{ section.id }} 1s ease-out 0.8s forwards;
  }
  
  @keyframes filterSlideDown-{{ section.id }} {
    from {
      opacity: 0;
      transform: translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .factory-filter-tabs-{{ section.id }} {
    display: flex;
    background: rgba(255, 255, 255, 0.08);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-radius: 8px;
    padding: 8px;
    gap: 8px;
    border: 1px solid rgba(255, 255, 255, 0.15);
    box-shadow: 0 20px 50px rgba(0,0,0,0.5);
  }
  
  .factory-filter-tab-{{ section.id }} {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px 32px;
    background: transparent;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    color: rgba(255, 255, 255, 0.7);
    font-weight: 400;
    font-size: 1rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    position: relative;
    overflow: hidden;
  }
  
  .factory-filter-tab-{{ section.id }}::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
    transition: left 0.6s ease;
  }
  
  .factory-filter-tab-{{ section.id }}:hover::before {
    left: 100%;
  }
  
  .factory-filter-tab-{{ section.id }}.active {
    background: rgba(255, 255, 255, 0.15);
    color: white;
    box-shadow: 0 10px 30px rgba(255,255,255,0.1);
    backdrop-filter: blur(30px);
    -webkit-backdrop-filter: blur(30px);
  }
  
  .factory-filter-tab-{{ section.id }}:hover {
    background: rgba(255, 255, 255, 0.12);
    color: rgba(255, 255, 255, 0.9);
    transform: translateY(-2px);
  }
  
  .factory-filter-icon-{{ section.id }} {
    transition: transform 0.3s ease;
  }
  
  .factory-filter-tab-{{ section.id }}:hover .factory-filter-icon-{{ section.id }} {
    transform: scale(1.1);
  }
  
  /* Gallery Section */
  .factory-gallery-{{ section.id }} {
    padding: 4rem 0;
    position: relative;
    opacity: 0;
    animation: galleryFadeIn-{{ section.id }} 1.2s ease-out 1.2s forwards;
  }
  
  @keyframes galleryFadeIn-{{ section.id }} {
    from {
      opacity: 0;
      transform: translateY(40px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .factory-gallery-wrapper-{{ section.id }} {
    display: flex;
    gap: 3rem;
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 2rem;
    align-items: stretch;
  }
  
  /* Main Image Display */
  .factory-main-display-{{ section.id }} {
    flex: 2.5;
    min-width: 0;
  }
  
  .factory-main-container-{{ section.id }} {
    position: relative;
    border-radius: 8px;
    overflow: hidden;
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(25px);
    -webkit-backdrop-filter: blur(25px);
    border: 1px solid rgba(255, 255, 255, 0.15);
    box-shadow: 0 30px 80px rgba(0,0,0,0.6);
    aspect-ratio: 4/3;
  }
  
  .factory-main-container-{{ section.id }}::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(circle at center, rgba(255,255,255,0.08) 0%, transparent 70%);
    pointer-events: none;
    z-index: 2;
  }
  
  .factory-slide-{{ section.id }} {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    transition: opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    border-radius: 8px;
    overflow: hidden;
  }
  
  .factory-slide-{{ section.id }}.active {
    opacity: 1;
  }
  
  .factory-image-{{ section.id }} {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
    border-radius: 8px;
    transition: transform 0.6s ease;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    -webkit-user-drag: none;
    -khtml-user-drag: none;
    -moz-user-drag: none;
    -o-user-drag: none;
    user-drag: none;
    pointer-events: none;
  }

  .factory-video-{{ section.id }} {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
    border-radius: 8px;
    transition: transform 0.6s ease;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    -webkit-user-drag: none;
    -khtml-user-drag: none;
    -moz-user-drag: none;
    -o-user-drag: none;
    user-drag: none;
    background: rgba(0, 0, 0, 0.1);
  }

  .factory-video-{{ section.id }}::-webkit-media-controls-panel {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-radius: 4px;
  }

  .factory-video-{{ section.id }}::-webkit-media-controls-play-button,
  .factory-video-{{ section.id }}::-webkit-media-controls-volume-slider,
  .factory-video-{{ section.id }}::-webkit-media-controls-timeline {
    filter: brightness(0) invert(1);
  }
  
  .factory-slide-{{ section.id }}:hover .factory-image-{{ section.id }},
  .factory-slide-{{ section.id }}:hover .factory-video-{{ section.id }} {
    transform: scale(1.02);
  }
  
  .factory-slide-overlay-{{ section.id }} {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(0,0,0,0) 0%, rgba(0,0,0,0.3) 100%);
    opacity: 0;
    transition: opacity 0.4s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    z-index: 5;
  }
  
  .factory-slide-{{ section.id }}:hover .factory-slide-overlay-{{ section.id }} {
    opacity: 1;
  }
  
  .factory-zoom-btn-{{ section.id }} {
    width: 60px;
    height: 60px;
    border-radius: 8px;
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 15px 40px rgba(0,0,0,0.4);
    transform: scale(0.8);
    pointer-events: auto;
  }
  
  .factory-slide-{{ section.id }}:hover .factory-zoom-btn-{{ section.id }} {
    transform: scale(1);
  }
  
  .factory-zoom-btn-{{ section.id }}:hover {
    background: rgba(255, 255, 255, 0.25);
    transform: scale(1.1);
    box-shadow: 0 20px 50px rgba(255,255,255,0.1);
  }
  
  /* Navigation */
  .factory-navigation-{{ section.id }} {
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    transform: translateY(-50%);
    z-index: 10;
    pointer-events: none;
    padding: 0 2rem;
  }
  
  .factory-nav-{{ section.id }} {
    position: absolute;
    width: 60px;
    height: 60px;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    pointer-events: auto;
    box-shadow: 0 15px 40px rgba(0,0,0,0.3);
    color: rgba(255, 255, 255, 0.8);
  }
  
  .factory-nav-{{ section.id }}:hover {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    transform: scale(1.1);
    box-shadow: 0 20px 50px rgba(255,255,255,0.1);
  }
  
  .factory-nav-prev-{{ section.id }} {
    left: 0;
  }
  
  .factory-nav-next-{{ section.id }} {
    right: 0;
  }
  
  /* Information Panel */
  .factory-info-{{ section.id }} {
    flex: 1;
    background: rgba(255, 255, 255, 0.08);
    backdrop-filter: blur(25px);
    -webkit-backdrop-filter: blur(25px);
    border-radius: 8px;
    padding: 3rem;
    border: 1px solid rgba(255, 255, 255, 0.15);
    box-shadow: 0 30px 80px rgba(0,0,0,0.4);
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    position: sticky;
    top: 8rem;
    min-height: auto;
  }
  
  .factory-info-{{ section.id }}::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    border-radius: 8px 8px 0 0;
  }
  
  .factory-item-info-{{ section.id }} {
    transition: opacity 0.4s ease, transform 0.4s ease;
    display: none;
  }
  
  .factory-item-info-{{ section.id }}.active {
    display: block;
    animation: fadeInUp-{{ section.id }} 0.6s ease-out;
  }
  
  @keyframes fadeInUp-{{ section.id }} {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .factory-item-title-{{ section.id }} {
    font-size: {{ section.settings.item_title_size }}rem;
    font-weight: 200;
    line-height: 1.3;
    color: {{ section.settings.text_color }};
    margin: 0 0 1.5rem 0;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    font-family: var(--font-heading-family);
    position: relative;
  }
  
  .factory-item-title-{{ section.id }}::after {
    content: '';
    position: absolute;
    bottom: -8px;
    left: 0;
    width: 40px;
    height: 1px;
    background: linear-gradient(90deg, rgba(255,255,255,0.6), transparent);
  }
  
  .factory-item-description-{{ section.id }} {
    margin-bottom: 2rem;
    font-size: {{ section.settings.description_text_size }}rem;
    line-height: 1.7;
    color: {{ section.settings.text_color }};
    opacity: 0.9;
    font-weight: 300;
  }
  
  .factory-item-description-{{ section.id }} p {
    margin: 0 0 1rem 0;
  }
  
  .factory-item-description-{{ section.id }} p:last-child {
    margin-bottom: 0;
  }
  
  .factory-item-details-{{ section.id }} {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    padding: 2rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
    position: relative;
    overflow: hidden;
  }
  
  .factory-item-details-{{ section.id }}::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  }
  
  .factory-details-title-{{ section.id }} {
    font-size: {{ section.settings.details_title_size }}rem;
    font-weight: 400;
    color: {{ section.settings.text_color }};
    margin: 0 0 1.5rem 0;
    letter-spacing: 0.05em;
    text-transform: uppercase;
  }
  
  .factory-details-content-{{ section.id }} {
    font-size: {{ section.settings.details_text_size }}rem;
    line-height: 1.6;
    color: {{ section.settings.text_color }};
    opacity: 0.85;
  }
  
  .factory-details-content-{{ section.id }} p {
    margin: 0 0 1rem 0;
  }
  
  .factory-details-content-{{ section.id }} p:last-child {
    margin-bottom: 0;
  }
  
  .factory-details-content-{{ section.id }} strong {
    color: {{ section.settings.text_color }};
    font-weight: 500;
    opacity: 1;
  }
  
  /* Thumbnails */
  .factory-thumbnails-{{ section.id }} {
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-radius: 8px;
    padding: 2.5rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    margin-top: 4rem;
    position: relative;
    opacity: 0;
    animation: thumbnailsSlideUp-{{ section.id }} 1s ease-out 1.6s forwards;
  }
  
  @keyframes thumbnailsSlideUp-{{ section.id }} {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .factory-thumb-navigation-{{ section.id }} {
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    transform: translateY(-50%);
    z-index: 10;
    pointer-events: none;
    padding: 0 1rem;
  }
  
  .factory-thumb-nav-{{ section.id }} {
    position: absolute;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 6px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    pointer-events: auto;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    color: rgba(255, 255, 255, 0.8);
  }
  
  .factory-thumb-nav-{{ section.id }}:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: scale(1.1);
    box-shadow: 0 15px 40px rgba(255,255,255,0.1);
    color: white;
  }
  
  .factory-thumb-prev-{{ section.id }} {
    left: 0;
  }
  
  .factory-thumb-next-{{ section.id }} {
    right: 0;
  }
  
  .factory-thumb-container-{{ section.id }} {
    display: flex;
    gap: 1rem;
    overflow-x: auto;
    padding: 0 3rem;
    scroll-behavior: smooth;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }
  
  .factory-thumb-container-{{ section.id }}::-webkit-scrollbar {
    display: none;
  }
  
  .factory-thumb-slide-{{ section.id }} {
    flex-shrink: 0;
    border-radius: 6px;
    overflow: hidden;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    border: 2px solid transparent;
    cursor: pointer;
    position: relative;
  }
  
  .factory-thumb-slide-{{ section.id }}::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.05);
    opacity: 0;
    transition: opacity 0.3s ease;
    border-radius: 4px;
    z-index: 2;
  }
  
  .factory-thumb-slide-{{ section.id }}:hover::before {
    opacity: 1;
  }
  
  .factory-thumb-image-{{ section.id }} {
    width: 100px;
    height: 75px;
    object-fit: cover;
    border-radius: 4px;
    transition: all 0.3s ease;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    -webkit-user-drag: none;
    -khtml-user-drag: none;
    -moz-user-drag: none;
    -o-user-drag: none;
    user-drag: none;
    pointer-events: none;
  }

  .factory-thumb-video-wrapper-{{ section.id }} {
    position: relative;
    width: 100px;
    height: 75px;
    border-radius: 4px;
    overflow: hidden;
  }

  .factory-thumb-video-{{ section.id }} {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 4px;
    transition: all 0.3s ease;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    -webkit-user-drag: none;
    -khtml-user-drag: none;
    -moz-user-drag: none;
    -o-user-drag: none;
    user-drag: none;
    pointer-events: none;
  }

  .factory-thumb-video-icon-{{ section.id }} {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 30px;
    height: 30px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: rgba(0, 0, 0, 0.8);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    transition: all 0.3s ease;
    pointer-events: none;
  }

  .factory-thumb-slide-{{ section.id }}:hover .factory-thumb-video-icon-{{ section.id }} {
    background: rgba(255, 255, 255, 1);
    transform: translate(-50%, -50%) scale(1.1);
  }
  
  .factory-thumb-slide-{{ section.id }}.active {
    border-color: rgba(255, 255, 255, 0.4);
    transform: scale(1.05);
    box-shadow: 0 10px 30px rgba(255,255,255,0.1);
  }
  
  .factory-thumb-slide-{{ section.id }}:hover {
    transform: translateY(-3px);
    box-shadow: 0 15px 40px rgba(0,0,0,0.4);
  }
  
  /* Lightbox */
  .factory-lightbox-{{ section.id }} {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .factory-lightbox-{{ section.id }}.active {
    opacity: 1;
    visibility: visible;
  }
  
  .factory-lightbox-backdrop-{{ section.id }} {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
  }
  
  .factory-lightbox-content-{{ section.id }} {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.8);
    max-width: 90vw;
    max-height: 90vh;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 50px 120px rgba(0, 0, 0, 0.6);
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .factory-lightbox-{{ section.id }}.active .factory-lightbox-content-{{ section.id }} {
    transform: translate(-50%, -50%) scale(1);
  }
  
  .factory-lightbox-image-{{ section.id }} {
    width: 100%;
    height: 100%;
    object-fit: contain;
    max-width: 90vw;
    max-height: 90vh;
    border-radius: 8px;
  }

  .factory-lightbox-video-{{ section.id }} {
    width: 100%;
    height: 100%;
    object-fit: contain;
    max-width: 90vw;
    max-height: 90vh;
    border-radius: 8px;
    background: rgba(0, 0, 0, 0.1);
  }

  .factory-lightbox-video-{{ section.id }}::-webkit-media-controls-panel {
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    border-radius: 6px;
  }

  .factory-lightbox-video-{{ section.id }}::-webkit-media-controls-play-button,
  .factory-lightbox-video-{{ section.id }}::-webkit-media-controls-volume-slider,
  .factory-lightbox-video-{{ section.id }}::-webkit-media-controls-timeline {
    filter: brightness(0) invert(1);
    opacity: 0.9;
  }
  
  .factory-lightbox-close-{{ section.id }} {
    position: absolute;
    top: 2rem;
    right: 2rem;
    width: 50px;
    height: 50px;
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: none;
    border-radius: 8px;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    z-index: 10;
    box-shadow: 0 15px 40px rgba(0,0,0,0.4);
  }
  
  .factory-lightbox-close-{{ section.id }}:hover {
    background: rgba(255, 255, 255, 0.25);
    transform: scale(1.1);
    box-shadow: 0 20px 50px rgba(255,255,255,0.1);
  }
  
  /* Loading Spinner */
  .factory-spinner-{{ section.id }} {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }
  
  .factory-spinner-{{ section.id }}::after {
    content: '';
    width: 40px;
    height: 40px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-top-color: white;
    border-radius: 50%;
    animation: factorySpinnerRotate-{{ section.id }} 1s linear infinite;
  }
  
  @keyframes factorySpinnerRotate-{{ section.id }} {
    to { transform: rotate(360deg); }
  }
  
  /* Mobile Responsiveness */
  @media (max-width: 768px) {
    .factory-section-{{ section.id }} {
      overflow-x: hidden;
    }
    
    .factory-filter-tabs-{{ section.id }} {
      flex-direction: column;
      width: 100%;
      max-width: 320px;
      margin: 0 auto;
      padding: 6px;
    }
    
    .factory-filter-tab-{{ section.id }} {
      justify-content: center;
      padding: 14px 24px;
      font-size: 0.9rem;
    }
    
    .factory-gallery-wrapper-{{ section.id }} {
      flex-direction: column;
      gap: 2rem;
      padding: 0 1rem;
    }
    
    .factory-info-{{ section.id }} {
      position: static;
      padding: 2rem;
      min-height: auto;
    }
    
    .factory-main-container-{{ section.id }} {
      aspect-ratio: 3/2;
    }
    
    .factory-nav-{{ section.id }} {
      width: 50px;
      height: 50px;
    }
    
    .factory-thumb-image-{{ section.id }} {
      width: 80px;
      height: 60px;
    }
    
    .factory-thumbnails-{{ section.id }} {
      padding: 2rem;
      margin-top: 2rem;
    }
    
    .factory-zoom-btn-{{ section.id }},
    .factory-slide-overlay-{{ section.id }} {
      display: none !important;
    }
  }
  
  @media (max-width: 480px) {
    .factory-filter-{{ section.id }} {
      padding: 3rem 0 1.5rem;
    }
    
    .factory-info-{{ section.id }} {
      padding: 1.5rem;
    }
    
    .factory-nav-{{ section.id }} {
      width: 45px;
      height: 45px;
    }
    
    .factory-thumb-image-{{ section.id }} {
      width: 70px;
      height: 52px;
    }
    
    .factory-thumbnails-{{ section.id }} {
      padding: 1.5rem;
    }
    
    .factory-thumb-container-{{ section.id }} {
      padding: 0 2.5rem;
    }
  }
  
  /* Accessibility */
  .factory-filter-tab-{{ section.id }}:focus,
  .factory-nav-{{ section.id }}:focus,
  .factory-zoom-btn-{{ section.id }}:focus,
  .factory-thumb-slide-{{ section.id }}:focus {
    outline: 2px solid rgba(255,255,255,0.8);
    outline-offset: 3px;
  }
  
  /* High contrast mode */
  @media (prefers-contrast: high) {
    .factory-main-container-{{ section.id }},
    .factory-info-{{ section.id }},
    .factory-thumbnails-{{ section.id }} {
      background-blend-mode: multiply;
    }
    
    .factory-filter-tab-{{ section.id }}.active,
    .factory-nav-{{ section.id }},
    .factory-zoom-btn-{{ section.id }} {
      border-color: rgba(255,255,255,0.8);
      background: rgba(255,255,255,0.2);
    }
  }
  
  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .factory-section-{{ section.id }} *,
    .factory-section-{{ section.id }} *::before,
    .factory-section-{{ section.id }} *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }
</style>

<div class="factory-section-{{ section.id }}">
  
  <!-- Main Content -->
  <div class="factory-main-{{ section.id }}">
    
    <!-- Filter Navigation -->
    {% if section.settings.show_collection_filter %}
      <div class="factory-filter-{{ section.id }}">
        <div class="factory-filter-tabs-{{ section.id }}">
          <button class="factory-filter-tab-{{ section.id }} active" data-filter="products">
            <span class="factory-filter-icon-{{ section.id }}">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                <path d="M10 2L3 7V18H8V13H12V18H17V7L10 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </span>
            <span class="factory-filter-text-{{ section.id }}">Our Products</span>
          </button>
          <button class="factory-filter-tab-{{ section.id }}" data-filter="factory">
            <span class="factory-filter-icon-{{ section.id }}">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                <path d="M3 17H17V9L10 3L3 9V17Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </span>
            <span class="factory-filter-text-{{ section.id }}">Our Factory</span>
          </button>
          <button class="factory-filter-tab-{{ section.id }}" data-filter="team">
            <span class="factory-filter-icon-{{ section.id }}">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                <path d="M16 7C16 9.20914 14.2091 11 12 11C9.79086 11 8 9.20914 8 7C8 4.79086 9.79086 3 12 3C14.2091 3 16 4.79086 16 7Z" stroke="currentColor" stroke-width="1.5"/>
                <path d="M12 14C8.13401 14 5 17.134 5 21H19C19 17.134 15.866 14 12 14Z" stroke="currentColor" stroke-width="1.5"/>
              </svg>
            </span>
            <span class="factory-filter-text-{{ section.id }}">Our Team</span>
          </button>
        </div>
      </div>
    {% endif %}
    
    <!-- Gallery Section -->
    {% if section.blocks.size > 0 %}
      <div class="factory-gallery-{{ section.id }}">
        <div class="factory-gallery-wrapper-{{ section.id }}">
          
          <!-- Main Image Display -->
          <div class="factory-main-display-{{ section.id }}">
            <div class="factory-main-container-{{ section.id }}">
              
              {% assign slide_index = 0 %}
              {% for block in section.blocks %}
                {% assign block_filter = block.settings.collection_type | default: 'products' %}
                {% assign block_index = forloop.index0 %}

                {% comment %} Render Images {% endcomment %}
                {% for i in (1..15) %}
                  {% assign image_key = 'image_' | append: i %}
                  {% assign current_image = block.settings[image_key] %}
                  {% if current_image != blank %}
                    <div class="factory-slide-{{ section.id }}"
                         data-filter="{{ block_filter }}"
                         data-product="{{ block_index }}"
                         data-slide-index="{{ slide_index }}"
                         data-media-type="image">
                      <img src="{{ current_image | image_url: width: 1200 }}"
                           class="factory-image-{{ section.id }}"
                           loading="lazy"
                           alt="{{ block.settings.product_name | escape }}"
                           width="1200"
                           height="900"
                           draggable="false"
                           oncontextmenu="return false;"
                           onselectstart="return false;"
                           ondragstart="return false;">
                      <div class="factory-slide-overlay-{{ section.id }}">
                        <button class="factory-zoom-btn-{{ section.id }}"
                                data-image="{{ current_image | image_url: width: 1600 }}"
                                data-media-type="image">
                          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M21 21L16.514 16.506M19 10.5C19 15.194 15.194 19 10.5 19S2 15.194 2 10.5 5.806 2 10.5 2 19 5.806 19 10.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </button>
                      </div>
                    </div>
                    {% assign slide_index = slide_index | plus: 1 %}
                  {% endif %}
                {% endfor %}

                {% comment %} Render Videos {% endcomment %}
                {% for i in (1..15) %}
                  {% assign video_key = 'video_' | append: i %}
                  {% assign current_video = block.settings[video_key] %}
                  {% if current_video != blank %}
                    <div class="factory-slide-{{ section.id }}"
                         data-filter="{{ block_filter }}"
                         data-product="{{ block_index }}"
                         data-slide-index="{{ slide_index }}"
                         data-media-type="video">
                      <video class="factory-video-{{ section.id }}"
                             {% if section.settings.video_autoplay %}autoplay{% endif %}
                             {% if section.settings.video_muted %}muted{% endif %}
                             {% if section.settings.video_loop %}loop{% endif %}
                             {% if section.settings.video_controls %}controls{% endif %}
                             playsinline
                             preload="metadata"
                             draggable="false"
                             oncontextmenu="return false;"
                             onselectstart="return false;"
                             ondragstart="return false;">
                        <source src="{{ current_video.sources[0].url }}" type="{{ current_video.sources[0].mime_type }}">
                        {% if current_video.sources[1] %}
                          <source src="{{ current_video.sources[1].url }}" type="{{ current_video.sources[1].mime_type }}">
                        {% endif %}
                        {% if current_video.sources[2] %}
                          <source src="{{ current_video.sources[2].url }}" type="{{ current_video.sources[2].mime_type }}">
                        {% endif %}
                        <p>Your browser doesn't support video playback.</p>
                      </video>
                      <div class="factory-slide-overlay-{{ section.id }}">
                        <button class="factory-zoom-btn-{{ section.id }}"
                                data-video="{{ current_video.sources[0].url }}"
                                data-media-type="video">
                          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M8 5V19L19 12L8 5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </button>
                      </div>
                    </div>
                    {% assign slide_index = slide_index | plus: 1 %}
                  {% endif %}
                {% endfor %}
              {% endfor %}
              
              <!-- Navigation -->
              {% if section.settings.show_navigation %}
                <div class="factory-navigation-{{ section.id }}">
                  <button class="factory-nav-{{ section.id }} factory-nav-prev-{{ section.id }}">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                      <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </button>
                  <button class="factory-nav-{{ section.id }} factory-nav-next-{{ section.id }}">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                      <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </button>
                </div>
              {% endif %}
            </div>
          </div>
          
          <!-- Information Panel -->
          <div class="factory-info-{{ section.id }}">
            {% for block in section.blocks %}
              <div class="factory-item-info-{{ section.id }}" 
                   data-product="{{ forloop.index0 }}"
                   data-filter="{{ block.settings.collection_type | default: 'products' }}">
                
                {% if block.settings.product_name != blank %}
                  <h3 class="factory-item-title-{{ section.id }}">{{ block.settings.product_name }}</h3>
                {% endif %}

                {% if block.settings.product_description != blank %}
                  <div class="factory-item-description-{{ section.id }}">
                    {{ block.settings.product_description }}
                  </div>
                {% endif %}

                {% if block.settings.details != blank %}
                  <div class="factory-item-details-{{ section.id }}">
                    <h4 class="factory-details-title-{{ section.id }}">
                      {% case block.settings.collection_type %}
                        {% when 'factory' %}
                          Facility Details
                        {% when 'team' %}
                          Team Member Info
                        {% else %}
                          Product Details
                      {% endcase %}
                    </h4>
                    <div class="factory-details-content-{{ section.id }}">
                      {{ block.settings.details }}
                    </div>
                  </div>
                {% endif %}
              </div>
            {% endfor %}
          </div>
        </div>
        
        <!-- Thumbnails -->
        {% if section.settings.show_thumbnails %}
          <div class="factory-thumbnails-{{ section.id }}">
            <div class="factory-thumb-navigation-{{ section.id }}">
              <button class="factory-thumb-nav-{{ section.id }} factory-thumb-prev-{{ section.id }}">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                  <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
              <button class="factory-thumb-nav-{{ section.id }} factory-thumb-next-{{ section.id }}">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                  <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
            <div class="factory-thumb-container-{{ section.id }}">
              {% assign thumb_index = 0 %}
              {% for block in section.blocks %}
                {% assign block_filter = block.settings.collection_type | default: 'products' %}
                {% assign block_index = forloop.index0 %}

                {% comment %} Image Thumbnails {% endcomment %}
                {% for i in (1..15) %}
                  {% assign image_key = 'image_' | append: i %}
                  {% assign current_image = block.settings[image_key] %}
                  {% if current_image != blank %}
                    <div class="factory-thumb-slide-{{ section.id }}"
                         data-filter="{{ block_filter }}"
                         data-product="{{ block_index }}"
                         data-thumb-index="{{ thumb_index }}"
                         data-media-type="image">
                      <img src="{{ current_image | image_url: width: 200 }}"
                           class="factory-thumb-image-{{ section.id }}"
                           loading="lazy"
                           width="200"
                           height="150"
                           draggable="false"
                           oncontextmenu="return false;"
                           onselectstart="return false;"
                           ondragstart="return false;">
                    </div>
                    {% assign thumb_index = thumb_index | plus: 1 %}
                  {% endif %}
                {% endfor %}

                {% comment %} Video Thumbnails {% endcomment %}
                {% for i in (1..15) %}
                  {% assign video_key = 'video_' | append: i %}
                  {% assign current_video = block.settings[video_key] %}
                  {% if current_video != blank %}
                    <div class="factory-thumb-slide-{{ section.id }}"
                         data-filter="{{ block_filter }}"
                         data-product="{{ block_index }}"
                         data-thumb-index="{{ thumb_index }}"
                         data-media-type="video">
                      <div class="factory-thumb-video-wrapper-{{ section.id }}">
                        {% if current_video.preview_image %}
                          <img src="{{ current_video.preview_image | image_url: width: 200 }}"
                               class="factory-thumb-image-{{ section.id }}"
                               loading="lazy"
                               width="200"
                               height="150"
                               draggable="false"
                               oncontextmenu="return false;"
                               onselectstart="return false;"
                               ondragstart="return false;">
                        {% else %}
                          <video class="factory-thumb-video-{{ section.id }}"
                                 muted
                                 preload="metadata"
                                 draggable="false"
                                 oncontextmenu="return false;"
                                 onselectstart="return false;"
                                 ondragstart="return false;">
                            <source src="{{ current_video.sources[0].url }}" type="{{ current_video.sources[0].mime_type }}">
                          </video>
                        {% endif %}
                        <div class="factory-thumb-video-icon-{{ section.id }}">
                          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M8 5V19L19 12L8 5Z" fill="currentColor"/>
                          </svg>
                        </div>
                      </div>
                    </div>
                    {% assign thumb_index = thumb_index | plus: 1 %}
                  {% endif %}
                {% endfor %}
              {% endfor %}
            </div>
          </div>
        {% endif %}
      </div>
      
      <!-- Lightbox -->
      <div class="factory-lightbox-{{ section.id }}">
        <div class="factory-lightbox-backdrop-{{ section.id }}"></div>
        <div class="factory-lightbox-content-{{ section.id }}">
          <button class="factory-lightbox-close-{{ section.id }}">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
              <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          <img src="" alt="" class="factory-lightbox-image-{{ section.id }}" style="display: none;">
          <video class="factory-lightbox-video-{{ section.id }}"
                 style="display: none;"
                 controls
                 playsinline
                 preload="metadata">
            <p>Your browser doesn't support video playback.</p>
          </video>
        </div>
      </div>
      
      <!-- Loading Spinner -->
      <div class="factory-spinner-{{ section.id }}"></div>
      
    {% else %}
      <div class="factory-empty-{{ section.id }}">
        <div class="factory-empty-content-{{ section.id }}">
          <svg width="80" height="80" viewBox="0 0 64 64" fill="none">
            <path d="M32 8L8 20V52H24V36H40V52H56V20L32 8Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <h3>No Factory Content Available</h3>
          <p>Add blocks in the theme editor to showcase your factory, products, and team.</p>
        </div>
      </div>
    {% endif %}
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const sectionId = '{{ section.id }}';
  const section = document.querySelector('.factory-section-' + sectionId);
  
  if (!section) return;
  
  let currentSlideIndex = 0;
  let currentFilter = 'products';
  let allSlides = [];
  let categoryMap = [];
  let categoryRanges = {
    products: { start: null, end: null },
    factory: { start: null, end: null },
    team: { start: null, end: null }
  };
  
  // Build category mapping
  function buildCategoryMapping() {
    const slides = section.querySelectorAll('.factory-slide-' + sectionId);
    categoryMap = [];
    
    // Reset category ranges
    categoryRanges = {
      products: { start: null, end: null },
      factory: { start: null, end: null },
      team: { start: null, end: null }
    };
    
    slides.forEach((slide, index) => {
      const filter = slide.getAttribute('data-filter');
      const productIndex = slide.getAttribute('data-product');
      
      categoryMap.push({
        index: index,
        filter: filter,
        productIndex: parseInt(productIndex),
        element: slide
      });
      
      allSlides.push(slide);
      
      // Track category ranges
      if (categoryRanges[filter].start === null) {
        categoryRanges[filter].start = index;
      }
      categoryRanges[filter].end = index;
    });
  }
  
  // Video management functions
  function pauseAllVideos() {
    const videos = section.querySelectorAll('.factory-video-' + sectionId);
    videos.forEach(video => {
      if (!video.paused) {
        video.pause();
      }
    });
  }

  function playCurrentVideo(slideIndex) {
    const currentSlide = allSlides[slideIndex];
    if (currentSlide && currentSlide.dataset.mediaType === 'video') {
      const video = currentSlide.querySelector('.factory-video-' + sectionId);
      if (video && video.paused && section.settings?.video_autoplay) {
        // Small delay to ensure slide transition is complete
        setTimeout(() => {
          video.play().catch(err => {
            console.log('Video autoplay failed:', err);
          });
        }, 300);
      }
    }
  }

  // Show specific slide
  function showSlide(slideIndex) {
    // Pause all videos first
    pauseAllVideos();

    allSlides.forEach((slide, index) => {
      slide.style.opacity = index === slideIndex ? '1' : '0';
      slide.classList.toggle('active', index === slideIndex);
    });

    // Update thumbnails
    const thumbSlides = section.querySelectorAll('.factory-thumb-slide-' + sectionId);
    thumbSlides.forEach((thumb, index) => {
      thumb.classList.toggle('active', index === slideIndex);
    });

    currentSlideIndex = slideIndex;
    updateProductInfo(slideIndex);
    updateActiveFilterTab(slideIndex);

    // Play video if current slide is a video
    playCurrentVideo(slideIndex);
  }
  
  // Update product information
  function updateProductInfo(slideIndex) {
    if (!categoryMap[slideIndex]) return;
    
    const currentSlide = categoryMap[slideIndex];
    const productIndex = currentSlide.productIndex;
    const category = currentSlide.filter;
    
    // Hide all product info
    section.querySelectorAll('.factory-item-info-' + sectionId).forEach(info => {
      info.style.display = 'none';
      info.classList.remove('active');
    });
    
    // Show correct product info
    const targetInfo = section.querySelector(`.factory-item-info-${sectionId}[data-product="${productIndex}"][data-filter="${category}"]`);
    if (targetInfo) {
      targetInfo.style.display = 'block';
      targetInfo.classList.add('active');
    }
  }
  
  // Update active filter tab
  function updateActiveFilterTab(slideIndex) {
    const category = categoryMap[slideIndex]?.filter || 'products';
    currentFilter = category;
    
    section.querySelectorAll('.factory-filter-tab-' + sectionId).forEach(tab => {
      tab.classList.remove('active');
    });
    
    const activeTab = section.querySelector(`[data-filter="${category}"]`);
    if (activeTab) {
      activeTab.classList.add('active');
    }
  }
  
  // Jump to category
  function jumpToCategory(category) {
    const firstSlideIndex = categoryMap.findIndex(item => item.filter === category);
    if (firstSlideIndex !== -1) {
      showSlide(firstSlideIndex);
    }
  }
  
  // Navigation functions
  function nextSlide() {
    const nextIndex = (currentSlideIndex + 1) % allSlides.length;
    showSlide(nextIndex);
  }
  
  function prevSlide() {
    const prevIndex = (currentSlideIndex - 1 + allSlides.length) % allSlides.length;
    showSlide(prevIndex);
  }
  
  // Thumbnail navigation
  function scrollThumbnails(direction) {
    const container = section.querySelector('.factory-thumb-container-' + sectionId);
    const scrollAmount = 120;
    
    if (direction === 'next') {
      container.scrollLeft += scrollAmount;
    } else {
      container.scrollLeft -= scrollAmount;
    }
  }
  
  // Image protection
  function addImageProtection() {
    section.addEventListener('contextmenu', function(e) {
      e.preventDefault();
      return false;
    });
    
    section.addEventListener('dragstart', function(e) {
      e.preventDefault();
      return false;
    });
    
    section.addEventListener('selectstart', function(e) {
      e.preventDefault();
      return false;
    });
    
    document.addEventListener('keydown', function(e) {
      if (e.keyCode === 123 || 
          (e.ctrlKey && e.shiftKey && e.keyCode === 73) ||
          (e.ctrlKey && e.keyCode === 85) ||
          (e.ctrlKey && e.keyCode === 83)) {
        e.preventDefault();
        return false;
      }
    });
  }
  
  // Lightbox functionality
  function openLightbox(src, mediaType = 'image') {
    const lightbox = section.querySelector('.factory-lightbox-' + sectionId);
    const lightboxImage = section.querySelector('.factory-lightbox-image-' + sectionId);
    const lightboxVideo = section.querySelector('.factory-lightbox-video-' + sectionId);
    const spinner = section.querySelector('.factory-spinner-' + sectionId);

    // Hide both elements initially
    lightboxImage.style.display = 'none';
    lightboxVideo.style.display = 'none';
    lightboxImage.src = '';
    lightboxVideo.src = '';

    spinner.style.display = 'flex';

    if (mediaType === 'video') {
      lightboxVideo.style.display = 'block';
      lightboxVideo.src = src;
      lightboxVideo.load();

      const handleVideoLoad = function() {
        spinner.style.display = 'none';
        lightbox.classList.add('active');
        document.body.style.overflow = 'hidden';
        lightboxVideo.removeEventListener('loadedmetadata', handleVideoLoad);
      };

      lightboxVideo.addEventListener('loadedmetadata', handleVideoLoad);

      // Fallback timeout in case metadata doesn't load
      setTimeout(() => {
        if (spinner.style.display === 'flex') {
          handleVideoLoad();
        }
      }, 3000);
    } else {
      const preload = new Image();
      preload.onload = function() {
        spinner.style.display = 'none';
        lightboxImage.src = src;
        lightboxImage.style.display = 'block';
        lightbox.classList.add('active');
        document.body.style.overflow = 'hidden';
      };
      preload.src = src;
    }
  }
  
  function closeLightbox() {
    const lightbox = section.querySelector('.factory-lightbox-' + sectionId);
    const lightboxVideo = section.querySelector('.factory-lightbox-video-' + sectionId);
    const spinner = section.querySelector('.factory-spinner-' + sectionId);

    // Pause and reset video if it's playing
    if (lightboxVideo && lightboxVideo.style.display !== 'none') {
      lightboxVideo.pause();
      lightboxVideo.currentTime = 0;
    }

    lightbox.classList.remove('active');
    spinner.style.display = 'none';
    document.body.style.overflow = '';
  }
  
  // Event listeners
  
  // Filter tabs
  section.querySelectorAll('.factory-filter-tab-' + sectionId).forEach(tab => {
    tab.addEventListener('click', function() {
      const category = this.getAttribute('data-filter');
      jumpToCategory(category);
    });
  });
  
  // Navigation buttons
  const prevBtn = section.querySelector('.factory-nav-prev-' + sectionId);
  const nextBtn = section.querySelector('.factory-nav-next-' + sectionId);
  
  if (prevBtn) prevBtn.addEventListener('click', prevSlide);
  if (nextBtn) nextBtn.addEventListener('click', nextSlide);
  
  // Thumbnail navigation
  const thumbPrevBtn = section.querySelector('.factory-thumb-prev-' + sectionId);
  const thumbNextBtn = section.querySelector('.factory-thumb-next-' + sectionId);
  
  if (thumbPrevBtn) thumbPrevBtn.addEventListener('click', () => scrollThumbnails('prev'));
  if (thumbNextBtn) thumbNextBtn.addEventListener('click', () => scrollThumbnails('next'));
  
  // Thumbnail clicks
  section.querySelectorAll('.factory-thumb-slide-' + sectionId).forEach(thumb => {
    thumb.addEventListener('click', function() {
      const thumbIndex = parseInt(this.dataset.thumbIndex);
      if (!isNaN(thumbIndex)) {
        showSlide(thumbIndex);
      }
    });
  });
  
  // Zoom buttons
  section.addEventListener('click', function(e) {
    const zoomBtn = e.target.closest('.factory-zoom-btn-' + sectionId);
    if (zoomBtn) {
      e.preventDefault();
      e.stopPropagation();

      const mediaType = zoomBtn.dataset.mediaType || 'image';
      const imageUrl = zoomBtn.dataset.image;
      const videoUrl = zoomBtn.dataset.video;

      if (mediaType === 'video' && videoUrl) {
        openLightbox(videoUrl, 'video');
      } else if (mediaType === 'image' && imageUrl) {
        openLightbox(imageUrl, 'image');
      }
    }
  });
  
  // Lightbox close events
  const lightboxClose = section.querySelector('.factory-lightbox-close-' + sectionId);
  const lightboxBackdrop = section.querySelector('.factory-lightbox-backdrop-' + sectionId);
  
  if (lightboxClose) lightboxClose.addEventListener('click', closeLightbox);
  if (lightboxBackdrop) lightboxBackdrop.addEventListener('click', closeLightbox);
  
  // ESC key to close lightbox
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      const lightbox = section.querySelector('.factory-lightbox-' + sectionId);
      if (lightbox && lightbox.classList.contains('active')) {
        closeLightbox();
      }
    }
  });
  
  // Keyboard navigation
  document.addEventListener('keydown', function(e) {
    const lightbox = section.querySelector('.factory-lightbox-' + sectionId);
    if (lightbox && lightbox.classList.contains('active')) return;
    
    if (e.key === 'ArrowLeft') {
      prevSlide();
    } else if (e.key === 'ArrowRight') {
      nextSlide();
    }
  });
  
  // Touch/swipe support
  let touchStartX = 0;
  let touchEndX = 0;
  
  const mainContainer = section.querySelector('.factory-main-container-' + sectionId);
  if (mainContainer) {
    mainContainer.addEventListener('touchstart', function(e) {
      touchStartX = e.changedTouches[0].screenX;
    });
    
    mainContainer.addEventListener('touchend', function(e) {
      touchEndX = e.changedTouches[0].screenX;
      handleSwipe();
    });
  }
  
  function handleSwipe() {
    const swipeThreshold = 50;
    const diff = touchStartX - touchEndX;
    
    if (Math.abs(diff) > swipeThreshold) {
      if (diff > 0) {
        nextSlide();
      } else {
        prevSlide();
      }
    }
  }
  
  // Pause videos when page visibility changes
  document.addEventListener('visibilitychange', function() {
    if (document.hidden) {
      pauseAllVideos();
    } else {
      // Resume current video if autoplay is enabled
      if (typeof playCurrentVideo === 'function') {
        playCurrentVideo(currentSlideIndex);
      }
    }
  });

  // Initialize
  buildCategoryMapping();
  addImageProtection();

  // Set initial state
  setTimeout(() => {
    showSlide(0);
  }, 100);
  
  // Auto-play functionality (optional)
  {% if section.settings.autoplay %}
    let autoplayInterval;
    
    function startAutoplay() {
      autoplayInterval = setInterval(() => {
        nextSlide();
      }, {{ section.settings.autoplay_speed | times: 1000 }});
    }
    
    function stopAutoplay() {
      if (autoplayInterval) {
        clearInterval(autoplayInterval);
        autoplayInterval = null;
      }
    }
    
    // Start autoplay
    startAutoplay();
    
    // Pause on hover
    section.addEventListener('mouseenter', stopAutoplay);
    section.addEventListener('mouseleave', startAutoplay);
    
    // Pause on interaction
    section.addEventListener('click', function() {
      stopAutoplay();
      setTimeout(startAutoplay, 5000); // Restart after 5 seconds
    });
  {% endif %}
});
</script>

{% schema %}
{
  "name": "Know My Factory",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Typography Sizes"
    },
    {
      "type": "range",
      "id": "item_title_size",
      "min": 1.2,
      "max": 3,
      "step": 0.1,
      "unit": "rem",
      "label": "Item Title Size",
      "default": 2.2
    },
    {
      "type": "range",
      "id": "description_text_size",
      "min": 0.8,
      "max": 1.6,
      "step": 0.1,
      "unit": "rem",
      "label": "Description Text Size",
      "default": 1.1
    },
    {
      "type": "range",
      "id": "details_title_size",
      "min": 0.8,
      "max": 1.8,
      "step": 0.1,
      "unit": "rem",
      "label": "Details Title Size",
      "default": 1.2
    },
    {
      "type": "range",
      "id": "details_text_size",
      "min": 0.8,
      "max": 1.4,
      "step": 0.1,
      "unit": "rem",
      "label": "Details Text Size",
      "default": 1
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Main Text Color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Collection Filter"
    },
    {
      "type": "checkbox",
      "id": "show_collection_filter",
      "label": "Show collection type filter",
      "default": true,
      "info": "Allows filtering between Products, Factory, and Team"
    },
    {
      "type": "header",
      "content": "Display Options"
    },
    {
      "type": "checkbox",
      "id": "show_thumbnails",
      "label": "Show thumbnail navigation",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_navigation",
      "label": "Show arrow navigation",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Auto-rotate slides",
      "default": false
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "min": 3,
      "max": 15,
      "step": 1,
      "unit": "s",
      "label": "Auto-rotate speed",
      "default": 8
    }
  ],
  "blocks": [
    {
      "type": "item",
      "name": "Factory Item",
      "limit": 20,
      "settings": [
        {
          "type": "select",
          "id": "collection_type",
          "label": "Collection Type",
          "options": [
            {
              "value": "products",
              "label": "Our Products"
            },
            {
              "value": "factory",
              "label": "Our Factory"
            },
            {
              "value": "team",
              "label": "Our Team"
            }
          ],
          "default": "factory"
        },
        {
          "type": "text",
          "id": "product_name",
          "label": "Item Name",
          "default": "Production Floor"
        },
        {
          "type": "richtext",
          "id": "product_description",
          "label": "Description",
          "default": "<p>State-of-the-art manufacturing facility with cutting-edge technology and quality control processes that ensure every product meets our exacting standards.</p>"
        },
        {
          "type": "richtext",
          "id": "details",
          "label": "Details",
          "default": "<p><strong>Capacity:</strong> 50,000+ pieces/month<br><strong>Equipment:</strong> Industrial sewing machines<br><strong>Quality:</strong> ISO 9001 certified<br><strong>Workforce:</strong> 150+ skilled professionals</p>"
        },
        {
          "type": "header",
          "content": "Images (up to 15)"
        },
        {
          "type": "image_picker",
          "id": "image_1",
          "label": "Image 1"
        },
        {
          "type": "image_picker",
          "id": "image_2",
          "label": "Image 2"
        },
        {
          "type": "image_picker",
          "id": "image_3",
          "label": "Image 3"
        },
        {
          "type": "image_picker",
          "id": "image_4",
          "label": "Image 4"
        },
        {
          "type": "image_picker",
          "id": "image_5",
          "label": "Image 5"
        },
        {
          "type": "image_picker",
          "id": "image_6",
          "label": "Image 6"
        },
        {
          "type": "image_picker",
          "id": "image_7",
          "label": "Image 7"
        },
        {
          "type": "image_picker",
          "id": "image_8",
          "label": "Image 8"
        },
        {
          "type": "image_picker",
          "id": "image_9",
          "label": "Image 9"
        },
        {
          "type": "image_picker",
          "id": "image_10",
          "label": "Image 10"
        },
        {
          "type": "image_picker",
          "id": "image_11",
          "label": "Image 11"
        },
        {
          "type": "image_picker",
          "id": "image_12",
          "label": "Image 12"
        },
        {
          "type": "image_picker",
          "id": "image_13",
          "label": "Image 13"
        },
        {
          "type": "image_picker",
          "id": "image_14",
          "label": "Image 14"
        },
        {
          "type": "image_picker",
          "id": "image_15",
          "label": "Image 15"
        },
        {
          "type": "header",
          "content": "Videos (up to 15)"
        },
        {
          "type": "video",
          "id": "video_1",
          "label": "Video 1"
        },
        {
          "type": "video",
          "id": "video_2",
          "label": "Video 2"
        },
        {
          "type": "video",
          "id": "video_3",
          "label": "Video 3"
        },
        {
          "type": "video",
          "id": "video_4",
          "label": "Video 4"
        },
        {
          "type": "video",
          "id": "video_5",
          "label": "Video 5"
        },
        {
          "type": "video",
          "id": "video_6",
          "label": "Video 6"
        },
        {
          "type": "video",
          "id": "video_7",
          "label": "Video 7"
        },
        {
          "type": "video",
          "id": "video_8",
          "label": "Video 8"
        },
        {
          "type": "video",
          "id": "video_9",
          "label": "Video 9"
        },
        {
          "type": "video",
          "id": "video_10",
          "label": "Video 10"
        },
        {
          "type": "video",
          "id": "video_11",
          "label": "Video 11"
        },
        {
          "type": "video",
          "id": "video_12",
          "label": "Video 12"
        },
        {
          "type": "video",
          "id": "video_13",
          "label": "Video 13"
        },
        {
          "type": "video",
          "id": "video_14",
          "label": "Video 14"
        },
        {
          "type": "video",
          "id": "video_15",
          "label": "Video 15"
        },
        {
          "type": "header",
          "content": "Video Settings"
        },
        {
          "type": "checkbox",
          "id": "video_autoplay",
          "label": "Auto-play videos",
          "default": true,
          "info": "Videos will play automatically when they come into view"
        },
        {
          "type": "checkbox",
          "id": "video_muted",
          "label": "Mute videos by default",
          "default": true,
          "info": "Videos will start muted (recommended for autoplay)"
        },
        {
          "type": "checkbox",
          "id": "video_loop",
          "label": "Loop videos",
          "default": true,
          "info": "Videos will repeat continuously"
        },
        {
          "type": "checkbox",
          "id": "video_controls",
          "label": "Show video controls",
          "default": true,
          "info": "Display play/pause, volume, and progress controls"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Know My Factory",
      "blocks": [
        {
          "type": "item",
          "settings": {
            "collection_type": "factory",
            "product_name": "Production Floor",
            "product_description": "<p>Our state-of-the-art manufacturing facility spans over 50,000 square feet and houses the latest in textile production technology. Every corner is designed for efficiency, quality, and worker safety.</p>",
            "details": "<p><strong>Capacity:</strong> 50,000+ pieces per month<br><strong>Equipment:</strong> 200+ industrial sewing machines<br><strong>Quality Control:</strong> ISO 9001:2015 certified<br><strong>Workforce:</strong> 150+ skilled professionals<br><strong>Specialization:</strong> Premium apparel manufacturing</p>"
          }
        },
        {
          "type": "item",
          "settings": {
            "collection_type": "factory",
            "product_name": "Quality Control Department",
            "product_description": "<p>Our dedicated quality control department ensures that every single product meets our rigorous standards before leaving the facility. Multiple checkpoints guarantee consistent excellence.</p>",
            "details": "<p><strong>Inspection Points:</strong> 7 quality checkpoints<br><strong>Standards:</strong> International quality protocols<br><strong>Testing:</strong> Fabric strength & colorfastness<br><strong>Approval Rate:</strong> 99.2% first-pass quality<br><strong>Certifications:</strong> OEKO-TEX Standard 100</p>"
          }
        },
        {
          "type": "item",
          "settings": {
            "collection_type": "team",
            "product_name": "Master Craftspeople",
            "product_description": "<p>Meet our highly skilled team of master craftspeople who bring decades of experience to every piece. Their expertise and attention to detail are what make our products exceptional.</p>",
            "details": "<p><strong>Average Experience:</strong> 12+ years<br><strong>Training:</strong> Continuous skill development<br><strong>Specializations:</strong> Precision stitching, pattern making<br><strong>Team Size:</strong> 25 master craftspeople<br><strong>Achievement:</strong> Zero-defect production specialists</p>"
          }
        },
        {
          "type": "item",
          "settings": {
            "collection_type": "products",
            "product_name": "Premium Cotton Hoodie",
            "product_description": "<p>Expertly crafted premium hoodie featuring our signature cotton blend, reinforced construction, and superior comfort. Each piece represents the pinnacle of our manufacturing capabilities.</p>",
            "details": "<p><strong>Material:</strong> 80% Premium Cotton, 20% Polyester<br><strong>Weight:</strong> 320 GSM heavyweight construction<br><strong>Features:</strong> Kangaroo pocket, ribbed cuffs & hem<br><strong>Colors:</strong> 25+ premium colorways available<br><strong>Sizes:</strong> XS - 3XL (unisex sizing)</p>"
          }
        }
      ]
    }
  ]
}
{% endschema %}