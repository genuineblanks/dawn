{% comment %}
Tech-Pack Step 3: Garment Specifications Section
{% endcomment %}

{{ 'techpack-unified-styles.css' | asset_url | stylesheet_tag }}

<section id="techpack-step-3" class="techpack-step" data-step="3" style="display: none;">
  <div class="techpack-container">
    <div class="techpack-progress">
      <div class="techpack-progress__bar">
        <div class="techpack-progress__fill" style="width: 75%"></div>
      </div>
      <div class="techpack-progress__steps">
        <div class="techpack-progress__step techpack-progress__step--completed">
          <div class="techpack-progress__step-circle techpack-progress__step-circle--completed">✓</div>
          <div class="techpack-progress__step-label">Client Info</div>
        </div>
        <div class="techpack-progress__step techpack-progress__step--completed">
          <div class="techpack-progress__step-circle techpack-progress__step-circle--completed">✓</div>
          <div class="techpack-progress__step-label">File Upload</div>
        </div>
        <div class="techpack-progress__step techpack-progress__step--active">
          <div class="techpack-progress__step-circle techpack-progress__step-circle--active">3</div>
          <div class="techpack-progress__step-label">Garment Details</div>
        </div>
        <div class="techpack-progress__step">
          <div class="techpack-progress__step-circle">4</div>
          <div class="techpack-progress__step-label">Review</div>
        </div>
      </div>
    </div>

    <div class="techpack-content">
      <h2 class="techpack-title">Garment Specifications</h2>
      <p class="techpack-subtitle" id="step-3-subtitle">Define your garment details and quantity requirements</p>

      <div class="techpack-quantity-tracker">
        <div class="techpack-quantity-tracker__content">
          <span class="techpack-quantity-tracker__label">Total Quantity:</span>
          <span class="techpack-quantity-tracker__value" id="total-quantity">0</span>
          <span class="techpack-quantity-tracker__minimum">
            / <span id="min-text">75 minimum</span>
          </span>
        </div>
        <div class="techpack-quantity-tracker__bar">
          <div class="techpack-quantity-tracker__fill" id="quantity-progress" style="width: 0%"></div>
        </div>
      </div>

      <div class="techpack-garments" id="garments-container">
        <!-- Garments will be dynamically added here -->
      </div>

      <button type="button" class="techpack-btn techpack-btn--secondary techpack-btn--add-garment" id="add-garment">
        <svg class="techpack-btn__icon" width="16" height="16" viewBox="0 0 16 16">
          <path d="M8 2v12m-6-6h12" stroke="currentColor" stroke-width="2"/>
        </svg>
        Add Garment
      </button>

      <div class="techpack-form__actions">
        <button type="button" class="techpack-btn techpack-btn--ghost" id="step-3-prev">
          <svg class="techpack-btn__icon techpack-btn__icon--left" width="16" height="16" viewBox="0 0 16 16">
            <path d="M10 4L6 8l4 4" stroke="currentColor" stroke-width="2" fill="none"/>
          </svg>
          Previous
        </button>
        <button type="button" class="techpack-btn techpack-btn--primary" id="step-3-next" disabled>
          Next Step
          <svg class="techpack-btn__icon" width="16" height="16" viewBox="0 0 16 16">
            <path d="M6 12l4-4-4-4" stroke="currentColor" stroke-width="2" fill="none"/>
          </svg>
        </button>
      </div>
    </div>
  </div>
</section>

<!-- Garment Template -->
<template id="garment-template">
  <div class="techpack-garment" data-garment-id="">
    <div class="techpack-garment__header">
      <h3 class="techpack-garment__title">Garment <span class="techpack-garment__number"></span></h3>
      <button type="button" class="techpack-garment__remove" aria-label="Remove garment">
        <svg width="16" height="16" viewBox="0 0 16 16">
          <path d="M12 4L4 12m0-8l8 8" stroke="currentColor" stroke-width="2"/>
        </svg>
      </button>
    </div>

    <div class="techpack-garment__content">
      <div class="techpack-form__row">
        <div class="techpack-form__group techpack-form__group--required">
          <label class="techpack-form__label">Garment Type</label>
          <select class="techpack-form__select" name="garmentType" required>
            <option value="">Select garment type...</option>
            <option value="Zip-Up Hoodie">Zip-Up Hoodie</option>
            <option value="Hoodie">Hoodie</option>
            <option value="T-Shirt">T-Shirt</option>
            <option value="Sweatshirt">Sweatshirt</option>
            <option value="Sweatpants">Sweatpants</option>
            <option value="Shorts">Shorts</option>
            <option value="Long Sleeve T-Shirt">Long Sleeve T-Shirt</option>
            <option value="Shirt">Shirt</option>
            <option value="Polo Shirt">Polo Shirt</option>
            <option value="Tank Top">Tank Top</option>
            <option value="Hat/Cap">Hat/Cap</option>
            <option value="Beanie">Beanie</option>
            <option value="Other">Other (Specify in Notes)</option>
          </select>
          <div class="techpack-form__error" role="alert"></div>
        </div>

        <div class="techpack-form__group techpack-form__group--required">
          <label class="techpack-form__label">Fabric Type</label>
          <select class="techpack-form__select" name="fabricType" required>
            <option value="" selected>Select fabric type...</option>
            <!-- Fabric options will be populated dynamically based on garment type -->
          </select>
          <div class="techpack-form__error" role="alert"></div>
        </div>
      </div>

      <div class="techpack-form__group techpack-form__group--required">
        <label class="techpack-form__label">Printing Methods (Select at least one) *</label>
        <div class="techpack-form__checkboxes techpack-form__checkboxes--compact">
          <label class="techpack-form__checkbox">
            <input type="checkbox" name="printingMethods[]" value="None">
            <span class="techpack-form__checkbox-mark"></span>
            None
          </label>
          <label class="techpack-form__checkbox">
            <input type="checkbox" name="printingMethods[]" value="Embroidery">
            <span class="techpack-form__checkbox-mark"></span>
            Embroidery
          </label>
          <label class="techpack-form__checkbox">
            <input type="checkbox" name="printingMethods[]" value="Screen Print">
            <span class="techpack-form__checkbox-mark"></span>
            Screen Print
          </label>
          <label class="techpack-form__checkbox">
            <input type="checkbox" name="printingMethods[]" value="Digital Print">
            <span class="techpack-form__checkbox-mark"></span>
            Digital Print
          </label>
          <label class="techpack-form__checkbox">
            <input type="checkbox" name="printingMethods[]" value="Other">
            <span class="techpack-form__checkbox-mark"></span>
            Other
          </label>
        </div>
        <div class="techpack-form__error" role="alert"></div>
      </div>

      <!-- Sample Options for this Garment (shown only for sample requests) -->
      <div class="techpack-garment-samples" data-sample-request-only="true" style="display: none;">
        <h5 class="techpack-garment-samples__title">
          Sample Options for this Garment
          <button type="button" class="techpack-tooltip-trigger" data-tooltip="garment-samples">
            <svg width="14" height="14" viewBox="0 0 16 16">
              <circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="1.5" fill="none"/>
              <circle cx="8" cy="6" r="1" fill="currentColor"/>
              <path d="M8 8.5v3" stroke="currentColor" stroke-width="1.5"/>
            </svg>
          </button>
        </h5>
        
        <div class="techpack-sample-compact-grid">
          <!-- Black/Raw Sample Option - Enhanced -->
          <div class="techpack-sample-compact-option techpack-sample-expandable">
            <label class="techpack-sample-compact-header">
              <input type="checkbox" class="techpack-sample-compact-checkbox" name="sample-black-raw">
              <div class="techpack-sample-compact-content">
                <span class="techpack-sample-compact-title">Black/Raw Sample</span>
                <span class="techpack-sample-compact-info">1-2 weeks • €35</span>
                <span class="techpack-sample-compact-desc">Fast fit validation</span>
              </div>
            </label>
            
            <!-- Expandable fabric color options -->
            <div class="techpack-sample-sub-options" style="display: none;">
              <label class="techpack-form__label">Fabric Color Options:</label>
              <div class="techpack-sample-fabric-options">
                <label class="techpack-radio-option">
                  <input type="radio" name="blackraw-fabric-color" value="black" checked>
                  <span class="techpack-radio-mark"></span>
                  Black
                </label>
                <label class="techpack-radio-option">
                  <input type="radio" name="blackraw-fabric-color" value="off-white">
                  <span class="techpack-radio-mark"></span>
                  Off-White
                </label>
                <label class="techpack-radio-option">
                  <input type="radio" name="blackraw-fabric-color" value="stock-color">
                  <span class="techpack-radio-mark"></span>
                  Stock Color (Random)
                </label>
              </div>
            </div>
          </div>
          
          <!-- Lab Dip Option - Enhanced -->
          <div class="techpack-sample-compact-option techpack-sample-expandable">
            <label class="techpack-sample-compact-header">
              <input type="checkbox" class="techpack-sample-compact-checkbox" name="sample-lab-dip">
              <div class="techpack-sample-compact-content">
                <span class="techpack-sample-compact-title">Lab Dip Swatch</span>
                <span class="techpack-sample-compact-info">Parallel • €<span class="labdip-cost">25</span></span>
                <span class="techpack-sample-compact-desc">Color confirmation</span>
              </div>
            </label>
            
            <!-- Dynamic PANTONE addition system -->
            <div class="techpack-sample-sub-options" style="display: none;">
              <label class="techpack-form__label">PANTONE TPX Colors:</label>
              <div class="techpack-labdip-pantone-system">
                <div class="techpack-labdip-colors-list">
                  <!-- First PANTONE color (default) -->
                  <div class="techpack-labdip-color-item" data-color-index="0">
                    <input type="text" placeholder="e.g., 18-3949 TPX" class="techpack-pantone-input" data-pantone-index="0">
                    <button type="button" class="techpack-btn techpack-btn--small remove-labdip-color" style="display: none;">×</button>
                  </div>
                </div>
                <button type="button" class="techpack-btn techpack-btn--small techpack-btn--secondary add-labdip-pantone">
                  <svg width="12" height="12" viewBox="0 0 16 16">
                    <path d="M8 2v12m-6-6h12" stroke="currentColor" stroke-width="2"/>
                  </svg>
                  Add PANTONE Color (+€25)
                </button>
                <div class="techpack-labdip-total">
                  <strong>Total: €<span class="labdip-total-cost">25</span></strong>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Custom Color Sample Option - Enhanced -->
          <div class="techpack-sample-compact-option techpack-sample-expandable">
            <label class="techpack-sample-compact-header">
              <input type="checkbox" class="techpack-sample-compact-checkbox" name="sample-custom-color">
              <div class="techpack-sample-compact-content">
                <span class="techpack-sample-compact-title">Custom Color Sample</span>
                <span class="techpack-sample-compact-info">+3 weeks • €65</span>
                <span class="techpack-sample-compact-desc">Exact final color</span>
              </div>
            </label>
            
            <!-- PANTONE selection system -->
            <div class="techpack-sample-sub-options" style="display: none;">
              <label class="techpack-form__label">Select PANTONE TPX Color:</label>
              <div class="techpack-custom-color-pantone">
                <input type="text" placeholder="Enter PANTONE TPX (e.g. 18-3949 TPX)" class="techpack-pantone-input custom-color-pantone">
                <div class="techpack-pantone-preview">
                  <div class="techpack-color-swatch" style="background-color: #ffffff; border: 1px solid #ddd;"></div>
                  <span class="techpack-pantone-name">Color Preview</span>
                </div>
              </div>
              <div class="techpack-custom-color-note">
                <svg width="16" height="16" viewBox="0 0 16 16">
                  <circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="1.5" fill="none"/>
                  <path d="M8 5v3" stroke="currentColor" stroke-width="1.5"/>
                  <circle cx="8" cy="11" r="1" fill="currentColor"/>
                </svg>
                <span>Note: Requires lab dip confirmation before production</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Sample Options Detail (expandable) -->
        <div class="techpack-sample-details" style="display: none;">
          <div class="techpack-sample-detail-row">
            <div class="techpack-form__group">
              <label class="techpack-form__label">Sample Size</label>
              <select class="techpack-form__select techpack-garment-sample-size">
                <option value="">Select size...</option>
                <option value="xxs">XXS</option>
                <option value="xs">XS</option>
                <option value="s">S</option>
                <option value="m">M</option>
                <option value="l">L</option>
                <option value="xl">XL</option>
                <option value="xxl">XXL</option>
              </select>
            </div>
            <div class="techpack-form__group">
              <label class="techpack-form__label">Type of Fit</label>
              <select class="techpack-form__select techpack-garment-fit-type">
                <option value="">Select fit type...</option>
                <option value="measurements-inside-techpack">Measurements inside Tech-Pack</option>
                <option value="oversized-fit">Oversized Fit</option>
                <option value="relaxed-fit">Relaxed Fit</option>
              </select>
            </div>
          </div>
          
          <div class="techpack-sample-summary-line">
            <span class="techpack-sample-summary-text">Selected: <span class="techpack-garment-sample-summary">None</span></span>
            <span class="techpack-sample-summary-cost">Cost: €<span class="techpack-garment-sample-cost">0</span></span>
          </div>
        </div>
      </div>

      <div class="techpack-colorways">
        <div class="techpack-colorways__header">
          <h4 class="techpack-colorways__title">Colorways</h4>
          <button type="button" class="techpack-btn techpack-btn--small techpack-btn--secondary add-colorway">
            <svg class="techpack-btn__icon" width="14" height="14" viewBox="0 0 16 16">
              <path d="M8 2v12m-6-6h12" stroke="currentColor" stroke-width="2"/>
            </svg>
            Add Colorway
          </button>
        </div>
        <div class="techpack-colorways__list">
          <!-- Colorways will be added here -->
        </div>
      </div>


      <div class="techpack-garment__total" data-bulk-request-only="true" style="display: none;">
        <span class="techpack-garment__total-label">Garment Total:</span>
        <span class="techpack-garment__total-value">0</span>
      </div>
    </div>
  </div>
</template>

<!-- Colorway Template -->
<template id="colorway-template">
  <div class="techpack-colorway" data-colorway-id="">
    <!-- Perfect Single Line Layout: Color → Sample → Pantone → X -->
    <div class="techpack-colorway__header-line">
      <!-- Column 1: Color Picker -->
      <div class="techpack-colorway__color">
        <label class="techpack-form__label">Color</label>
        <input type="color" class="techpack-color-picker__input" value="#000000" data-color-picker>
      </div>
      
      <!-- Column 3: Pantone Options (Takes remaining space) -->
      <div class="techpack-colorway__pantone">
        <label class="techpack-form__label">
          PANTONE Options <span class="techpack-form__required">*</span>
        </label>
        <div class="techpack-pantone-buttons" style="display: none;">
          <div class="techpack-pantone-grid">
            <button type="button" class="techpack-btn techpack-btn--pantone-compact" data-pantone-index="0" data-pantone-code="" data-pantone-hex="" style="--pantone-hex: #000000;">
              <div class="techpack-pantone-circle" style="background-color: var(--pantone-hex)"></div>
              <span class="techpack-pantone-text">Select color</span>
              <div class="techpack-pantone-radio"></div>
            </button>
            <button type="button" class="techpack-btn techpack-btn--pantone-compact" data-pantone-index="1" data-pantone-code="" data-pantone-hex="" style="--pantone-hex: #000000;">
              <div class="techpack-pantone-circle" style="background-color: var(--pantone-hex)"></div>
              <span class="techpack-pantone-text">Select color</span>
              <div class="techpack-pantone-radio"></div>
            </button>
          </div>
        </div>
        <div class="techpack-pantone-validation-message" style="display: none;"></div>
      </div>
      
      <!-- Column 4: Remove Button (Original position) -->
      <button type="button" class="techpack-colorway__remove" aria-label="Remove colorway">
        <svg width="16" height="16" viewBox="0 0 16 16">
          <path d="M12 4L4 12m0-8l8 8" stroke="currentColor" stroke-width="2"/>
        </svg>
      </button>
    </div>

    <div class="techpack-size-grid" style="display: none;" data-requires-pantone="true">
      <div class="techpack-size-grid__header">
        <div class="techpack-size-grid__label">Size</div>
        <div class="techpack-size-grid__label">XXS</div>
        <div class="techpack-size-grid__label">XS</div>
        <div class="techpack-size-grid__label">S</div>
        <div class="techpack-size-grid__label">M</div>
        <div class="techpack-size-grid__label">L</div>
        <div class="techpack-size-grid__label">XL</div>
        <div class="techpack-size-grid__label">XXL</div>
      </div>
      <div class="techpack-size-grid__row">
        <div class="techpack-size-grid__label">Qty</div>
        <input type="number" class="techpack-size-grid__input" name="qty-xxs" min="0" value="0" data-size="xxs">
        <input type="number" class="techpack-size-grid__input" name="qty-xs" min="0" value="0" data-size="xs">
        <input type="number" class="techpack-size-grid__input" name="qty-s" min="0" value="0" data-size="s">
        <input type="number" class="techpack-size-grid__input" name="qty-m" min="0" value="0" data-size="m">
        <input type="number" class="techpack-size-grid__input" name="qty-l" min="0" value="0" data-size="l">
        <input type="number" class="techpack-size-grid__input" name="qty-xl" min="0" value="0" data-size="xl">
        <input type="number" class="techpack-size-grid__input" name="qty-xxl" min="0" value="0" data-size="xxl">
      </div>
    </div>

    <div class="techpack-colorway__total">
      <span class="techpack-colorway__total-label">Colorway Total:</span>
      <span class="techpack-colorway__total-value">0</span>
    </div>
  </div>
</template>

<!-- Lab Dip Template -->
<template id="lab-dip-template">
  <div class="techpack-lab-dip-item" data-lab-dip-id="">
    <div class="techpack-lab-dip-item__content">
      <div class="techpack-form__group">
        <label class="techpack-form__label">Pantone TCX Code</label>
        <input 
          type="text" 
          class="techpack-form__input techpack-lab-dip-pantone" 
          placeholder="e.g., 18-3949 TPX"
          data-validate="pantone"
        >
        <div class="techpack-form__error" role="alert"></div>
      </div>
      
      <div class="techpack-form__group">
        <label class="techpack-form__label">Color Preview</label>
        <div class="techpack-lab-dip-color-preview">
          <input type="color" class="techpack-color-picker__input techpack-lab-dip-color" value="#000000">
          <span class="techpack-lab-dip-color-text">Click to select color</span>
        </div>
      </div>
      
      <div class="techpack-lab-dip-cost">
        <span class="techpack-lab-dip-cost-label">Cost:</span>
        <span class="techpack-lab-dip-cost-value">€25</span>
      </div>
      
      <button type="button" class="techpack-lab-dip-remove" aria-label="Remove lab dip">
        <svg width="16" height="16" viewBox="0 0 16 16">
          <path d="M12 4L4 12m0-8l8 8" stroke="currentColor" stroke-width="2"/>
        </svg>
      </button>
    </div>
  </div>
</template>

{% schema %}
{
  "name": "Tech-Pack Step 3",
  "settings": [
    {
      "type": "header",
      "content": "Garment Specifications Step"
    },
    {
      "type": "text",
      "id": "step_title",
      "label": "Step Title",
      "default": "Garment Specifications"
    },
    {
      "type": "text",
      "id": "step_subtitle",
      "label": "Step Subtitle",
      "default": "Define your garment details and quantity requirements"
    },
    {
      "type": "number",
      "id": "minimum_quantity",
      "label": "Minimum Total Quantity",
      "default": 75
    }
  ],
  "presets": [
    {
      "name": "Tech-Pack Step 3"
    }
  ]
}
{% endschema %}

<!-- Educational Tooltip for Per-Garment Samples -->
<div class="techpack-tooltips">
  <div class="techpack-tooltip" id="tooltip-garment-samples" style="display: none;">
    <div class="techpack-tooltip__content">
      <h5 class="techpack-tooltip__title">Per-Garment Sample Options</h5>
      <p>For sample requests, you can choose different sample types for each garment:</p>
      <ul>
        <li><strong>Black/Raw Sample:</strong> Quick fit and construction validation using stock fabric</li>
        <li><strong>Lab Dip:</strong> Color swatch to confirm Pantone accuracy before production</li>
        <li><strong>Custom Color Sample:</strong> Full garment in your exact color (requires lab dip first)</li>
      </ul>
      <div class="techpack-tooltip__highlight">
        <strong>💡 Pro tip:</strong> Mix and match options - get a black sample for quick fit validation while waiting for your custom color sample!
      </div>
    </div>
  </div>
</div>